<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/collision/Broadphase.js - p2.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="p2.js"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Body.html">Body</a></li>
            
                <li><a href="../classes/Broadphase.html">Broadphase</a></li>
            
                <li><a href="../classes/Capsule.html">Capsule</a></li>
            
                <li><a href="../classes/Circle.html">Circle</a></li>
            
                <li><a href="../classes/Constraint.html">Constraint</a></li>
            
                <li><a href="../classes/ContactEquation.html">ContactEquation</a></li>
            
                <li><a href="../classes/Convex.html">Convex</a></li>
            
                <li><a href="../classes/DistanceConstraint.html">DistanceConstraint</a></li>
            
                <li><a href="../classes/Equation.html">Equation</a></li>
            
                <li><a href="../classes/FrictionEquation.html">FrictionEquation</a></li>
            
                <li><a href="../classes/GridBroadphase.html">GridBroadphase</a></li>
            
                <li><a href="../classes/GSSolver.html">GSSolver</a></li>
            
                <li><a href="../classes/Island.html">Island</a></li>
            
                <li><a href="../classes/IslandSolver.html">IslandSolver</a></li>
            
                <li><a href="../classes/mat2.html">mat2</a></li>
            
                <li><a href="../classes/NaiveBroadphase.html">NaiveBroadphase</a></li>
            
                <li><a href="../classes/Nearphase.html">Nearphase</a></li>
            
                <li><a href="../classes/Particle.html">Particle</a></li>
            
                <li><a href="../classes/Plane.html">Plane</a></li>
            
                <li><a href="../classes/PointToPointConstraint.html">PointToPointConstraint</a></li>
            
                <li><a href="../classes/Rectangle.html">Rectangle</a></li>
            
                <li><a href="../classes/Shape.html">Shape</a></li>
            
                <li><a href="../classes/Solver.html">Solver</a></li>
            
                <li><a href="../classes/Spring.html">Spring</a></li>
            
                <li><a href="../classes/vec2.html">vec2</a></li>
            
                <li><a href="../classes/World.html">World</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/collision/Broadphase.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var vec2 = require(&#x27;../math/vec2&#x27;)
,   Nearphase = require(&#x27;./Nearphase&#x27;)

module.exports = Broadphase;

/**
 * Base class for broadphase implementations.
 * @class Broadphase
 * @constructor
 */
function Broadphase(){

};

/**
 * Get all potential intersecting body pairs.
 * @method getCollisionPairs
 * @param  {World} world The world to search in.
 * @return {Array} An array of the bodies, ordered in pairs. Example: A result of [a,b,c,d] means that the potential pairs are: (a,b), (c,d).
 */
Broadphase.prototype.getCollisionPairs = function(world){
    throw new Error(&quot;getCollisionPairs must be implemented in a subclass!&quot;);
};

// Temp things
var dist = vec2.create();
var worldNormal = vec2.create();
var yAxis = vec2.fromValues(0,1);

/**
 * Check whether a circle and a convex intersects
 * @method circleConvex
 * @static
 * @param  {Circle}     circle
 * @param  {Array}      circleOffset
 * @param  {Convex}     convex
 * @param  {Array}      convexOffset
 * @return {Boolean}                    Whether they intersect
 */
Broadphase.circleConvex = function(circle, circleOffset, convex, convexOffset){
    return true; // For now
};

/**
 * Capsule/plane intersection test
 * @method capsulePlane
 * @static
 * @param  {Capsule}    capsule
 * @param  {Array}      circleOffset
 * @param  {Plane}      plane
 * @param  {Array}      convexOffset
 * @return {Boolean}                    Whether they intersect
 */
Broadphase.capsulePlane = function(capsule, capsuleOffset, capsuleAngle, plane, planeOffset, planeAngle){
    return true; // For now
};

/**
 * circleLine
 * @method circleLine
 * @static
 * @param  {Circle}     circle
 * @param  {Array}      circleOffset
 * @param  {Line}       line
 * @param  {Array}      lineOffset
 * @param  {Number}     lineAngle
 * @return {Boolean}
 */
Broadphase.circleLine = function(circle, circleOffset, line, lineOffset, lineAngle){
    // bounding sphere check
    vec2.sub(dist, lineOffset, circleOffset);
    var R = circle.radius;
    var L = line.length;

    return vec2.squaredLength(dist) &lt; Math.pow(L+R,2);
};

/**
 * Plane/line intersection test
 * @method planeLine
 * @static
 * @param  {Plane}  plane
 * @param  {Array}  planeOffset
 * @param  {Number} planeAngle
 * @param  {Line}   line
 * @param  {Array}  lineOffset
 * @param  {Number} lineAngle
 * @return {Boolean}
 */
Broadphase.planeLine = function(plane, planeOffset, planeAngle, line, lineOffset, lineAngle){
    // bounding sphere check
    vec2.sub(dist, lineOffset, planeOffset);
    vec2.rotate(worldNormal, yAxis, planeAngle);
    var L = line.length;
    return vec2.dot(dist, worldNormal) &lt; L;
};

/**
 * Rectangle/rectangle intersection test
 * @method rectangleRectangle
 * @static
 * @param  {Rectangle} r1
 * @param  {Array} offset1
 * @param  {Number} angle1
 * @param  {Rectangle} r2
 * @param  {Array} offset2
 * @param  {Number} angle2
 * @return {Boolean}
 */
Broadphase.rectangleRectangle = function(r1, offset1, angle1, r2, offset2, angle2){
    vec2.sub(dist,offset2,offset1);
    var w1 = r1.width,
        h1 = r1.height,
        D1 = Math.sqrt(w1*w1 + h1*h1) / 2,
        w2 = r2.width,
        h2 = r2.height,
        D2 = Math.sqrt(w2*w2 + h2*h2) / 2;
    var result = vec2.sqrLen(dist) &lt; (D1 + D2)*(D1 + D2);
    return result;
};

/**
 * Convex/convex intersection test
 * @method convexConvex
 * @static
 * @param  {Convex} convex
 * @param  {Array}  convexOffset
 * @param  {Convex} convex
 * @param  {Array}  convexOffset
 * @return {Boolean}
 */
Broadphase.convexConvex = function(convex, convexOffset, convex, convexOffset){
    return true; // For now
};

/**
 * Circle/rectangle intersection test
 * @method circleRectangle
 * @static
 * @param  {Circle} circle
 * @param  {Array} circleOffset
 * @param  {Rectangle} rectangle
 * @param  {Array} rectangleOffset
 * @return {Boolean}
 */
Broadphase.circleRectangle = function(circle, circleOffset, rectangle, rectangleOffset){
    vec2.sub(dist,circleOffset,rectangleOffset);
    var R = circle.radius;
    var w = rectangle.width,
        h = rectangle.height;
    var D = Math.sqrt(w*w + h*h) / 2;
    var result = vec2.sqrLen(dist) &lt; (R+D)*(R+D);
    return result;
};

/**
 * Circle/Circle intersection test
 * @method circleCircle
 * @static
 * @param  {Circle} c1
 * @param  {Array}  offset1
 * @param  {Circle} c2
 * @param  {Array}  offset2
 * @return {Boolean}
 */
Broadphase.circleCircle = function(c1, offset1, c2, offset2){
    vec2.sub(dist,offset1,offset2);
    var R1 = c1.radius;
    var R2 = c2.radius;
    return vec2.sqrLen(dist) &lt; (R1+R2)*(R1+R2);
};

var convexPlane_convexSpan = vec2.create();

/**
 * Convex/Plane
 * @method convexPlane
 * @static
 * @param  {Convex} convexShape
 * @param  {Array}  convexOffset
 * @param  {Number} convexAngle
 * @param  {Plane}  planeShape
 * @param  {Array}  planeOffset
 * @param  {Number} planeAngle
 * @return {Boolean}
 */
Broadphase.convexPlane = function( convexShape,
                                        convexOffset,
                                        convexAngle,
                                        planeShape,
                                        planeOffset,
                                        planeAngle){
    var convexSpan = convexPlane_convexSpan;

    vec2.rotate(worldNormal, yAxis, planeAngle);
    Nearphase.projectConvexOntoAxis(convexShape, convexOffset, convexAngle, worldNormal, convexSpan);

    // Project the plane position
    var planePos = vec2.dot(planeOffset,worldNormal);

    return convexSpan[0] &lt; planePos;
};

/**
 * Particle/Plane intersection test
 * @method particlePlane
 * @static
 * @param  {Particle} particleShape
 * @param  {Array} particleOffset
 * @param  {Plane} planeShape
 * @param  {Array} planeOffset
 * @param  {Number} planeAngle
 * @return {Boolean}
 */
Broadphase.particlePlane = function(   particleShape,
                                            particleOffset,
                                            planeShape,
                                            planeOffset,
                                            planeAngle){
    planeAngle = planeAngle || 0;

    vec2.sub(dist, particleOffset, planeOffset);

    vec2.rotate(worldNormal, yAxis, planeAngle);
    if(vec2.dot(dist,worldNormal) &lt; 0){
        return true;
    }
    return false;
};

/**
 * Circle/Particle intersection test
 * @method circleParticle
 * @static
 * @param  {Circle} circleShape
 * @param  {Array} circleOffset
 * @param  {Particle} particleShape
 * @param  {Array} particleOffset
 * @return {Boolean}
 */
Broadphase.circleParticle = function(  circleShape,
                                            circleOffset,
                                            particleShape,
                                            particleOffset ){
    var r = circleShape.radius;
    vec2.sub(dist, circleOffset, particleOffset);
    return vec2.squaredLength(dist) &lt; r*r;
};

/**
 * Rectangle/Particle intersection test
 * @method rectangleParticle
 * @static
 * @param  {Rectangle} rectangleShape
 * @param  {Array} rectangleOffset
 * @param  {Particle} particleShape
 * @param  {Array} particleOffset
 * @return {Boolean}
 */
Broadphase.rectangleParticle = function(rectangleShape,
                                        rectangleOffset,
                                        particleShape,
                                        particleOffset ){
    vec2.sub(dist,particleOffset,rectangleOffset);
    var w = rectangleShape.width,
        h = rectangleShape.height;
    var D = Math.sqrt(w*w + h*h) / 2;
    var result = vec2.sqrLen(dist) &lt; D*D;
    return result;
};

/**
 * Convex/Particle intersection test
 * @method convexParticle
 * @static
 * @param  {convex}     convexShape
 * @param  {Array}      convexOffset
 * @param  {Particle}   particleShape
 * @param  {Array}      particleOffset
 * @return {Boolean}
 */
Broadphase.convexParticle = function(   convexShape,
                                        convexOffset,
                                        particleShape,
                                        particleOffset ){
    vec2.sub(dist,particleOffset,convexOffset);
    var D = convexShape.boundingRadius;
    var result = vec2.sqrLen(dist) &lt; D*D;
    return result;
};

/**
 * Check whether a circle and a plane collides. See nearphaseCirclePlane() for param details.
 * @method circlePlane
 * @static
 * @param  {Circle}  circleShape
 * @param  {Array}   circleOffset
 * @param  {Plane}   planeShape
 * @param  {Array}   planeOffset
 * @param  {Number}  planeAngle
 * @return {Boolean} True if collision.
 */
Broadphase.circlePlane = function( circleShape,
                                        circleOffset, // Rotated offset!
                                        planeShape,
                                        planeOffset,
                                        planeAngle ){
    planeAngle = planeAngle || 0;

    // Compute distance vector between plane center and circle center
    vec2.sub(dist, circleOffset, planeOffset);

    // Collision normal is the plane normal in world coords
    vec2.rotate(worldNormal, yAxis, planeAngle);
    if(vec2.dot(dist,worldNormal) &lt;= circleShape.radius){
        //result.push(circleBody, planeBody);
        return true;
    }
    return false;
};



    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
