<!DOCTYPE html>
<html lang="en">
  <head>
    <title>p2.js Canvas example</title>
    <meta charset="utf-8">
    <script src="../../build/p2.js"></script>
  </head>
  <body>

    <!-- The canvas, where we draw stuff -->
    <canvas width="500" height="220" id="myCanvas"></canvas>

    <script>
      var w,h,fixedTimeStep=0.5,maxSubSteps=10,
          canvas, ctx, world, circleBody;

      init();
      animate();

      function init(){

        // Init canvas
        canvas = document.getElementById("myCanvas");
        w = canvas.width;
        h = canvas.height;

        ctx = canvas.getContext("2d");
        ctx.lineWidth = 0.05;

        // Init p2.js
        world = new p2.World({ gravity:[0,0] });

        // Add a circle
        circleShape = new p2.Circle(1);
        var velo = [1,0],
            pos  = [-4,0];
        circleBody = new p2.Body({ mass:1, velocity:velo, position:pos });
        circleBody.damping = 0;
        circleBody.addShape(circleShape);
        world.addBody(circleBody);
      }

      function drawCircle(ctx,circleBody){
        ctx.beginPath();
        var x = circleBody.interpolatedPosition[0],
            y = circleBody.interpolatedPosition[1],
            radius = circleShape.radius;
        ctx.arc(x,y-radius*1.1,radius,0,2*Math.PI);
        ctx.stroke();
        ctx.beginPath();

        ctx.arc(circleBody.position[0],y+radius*1.1,radius,0,2*Math.PI);
        ctx.stroke();
      }

      function render(ctx,circleBody){
        // Clear the canvas
        ctx.clearRect(0,0,w,h);

        // Transform the canvas
        // Note that we need to flip the y axis since Canvas pixel coordinates
        // goes from top to bottom, while physics does the opposite.
        ctx.save();
        ctx.translate(w/2, h/2);  // Translate to the center
        ctx.scale(50, -50);       // Zoom in and flip y axis

        // Draw all bodies
        drawCircle(ctx,circleBody);

        // Restore transform
        ctx.restore();
      }

      // Animation loop
      var lastCallTime = time();
      function animate(){

        requestAnimationFrame(animate);

        // Move physics bodies forward in time
        var timeSinceLastCall = time()-lastCallTime;
        world.step(fixedTimeStep,timeSinceLastCall,maxSubSteps);
        lastCallTime = time();

        // Render scene
        render(ctx,circleBody);
      }

      function time(){
        return new Date().getTime() / 1000;
      }
    </script>

  </body>
</html>
