(function(t){if("function"==typeof bootstrap)bootstrap("p2",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeP2=t}else"undefined"!=typeof window?window.p2=t():self.p2=t()})(function(){var t;return function(t,r,n){function e(n,i){if(!r[n]){if(!t[n]){var a="function"==typeof require&&require;if(!i&&a)return a(n,!0);if(o)return o(n,!0);throw Error("Cannot find module '"+n+"'")}var s=r[n]={exports:{}};t[n][0].call(s.exports,function(r){var o=t[n][1][r];return e(o?o:r)},s,s.exports)}return r[n].exports}for(var o="function"==typeof require&&require,i=0;n.length>i;i++)e(n[i]);return e}({1:[function(t,r,n){n.Shape=function(){},n.Particle=function(){p2.Shape.apply(this)},n.Circle=function(t){p2.Shape.apply(this),this.radius=t||1},n.Plane=function(){p2.Shape.apply(this)}},{}],2:[function(t,r,n){function e(t,r){this.equations=[],this.bodyA=t,this.bodyB=r}n.Constraint=e,e.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!")}},{}],3:[function(t,r,n){function e(t,r,n,e){this.id=-1,this.minForce=n===void 0?-1e6:n,this.maxForce=e===void 0?1e6:e,this.bi=t,this.bj=r}n.Equation=e,e.prototype.constructor=e},{}],4:[function(t,r,n){function e(){this.equations=[]}n.Solver=e,e.prototype.solve=function(t,r,n){return n()},e.prototype.addEquation=function(t){this.equations.push(t)},e.prototype.removeEquation=function(t){var r=this.equations.indexOf(t);-1!=r&&this.equations.splice(r,1)},e.prototype.removeAllEquations=function(){this.equations=[]}},{}],5:[function(t,r,n){n.Body=t("./objects/Body").Body,n.Broadphase=t("./collision/Broadphase").Broadphase,n.Circle=t("./objects/Shape").Circle,n.Constraint=t("./constraints/Constraint").Constraint,n.ContactEquation=t("./constraints/ContactEquation").ContactEquation,n.DistanceConstraint=t("./constraints/DistanceConstraint").DistanceConstraint,n.Equation=t("./constraints/Equation").Equation,n.GridBroadphase=t("./collision/GridBroadphase").GridBroadphase,n.GSSolver=t("./solver/GSSolver").GSSolver,n.NaiveBroadphase=t("./collision/NaiveBroadphase").NaiveBroadphase,n.Plane=t("./objects/Shape").Plane,n.ParallelIslandSolver=t("./solver/ParallelIslandSolver").ParallelIslandSolver,n.Island=t("./solver/ParallelIslandSolver").Island,n.IslandGroup=t("./solver/ParallelIslandSolver").IslandGroup,n.Shape=t("./objects/Shape").Shape,n.Solver=t("./solver/Solver").Solver,n.Spring=t("./objects/Body").Spring,n.World=t("./world/World").World;var e=t("gl-matrix");n.vec2=e.vec2,n.mat2=e.mat2},{"./objects/Body":6,"./collision/Broadphase":7,"./objects/Shape":1,"./constraints/Constraint":2,"./constraints/ContactEquation":8,"./constraints/DistanceConstraint":9,"./collision/GridBroadphase":10,"./constraints/Equation":3,"./solver/GSSolver":11,"./collision/NaiveBroadphase":12,"./solver/ParallelIslandSolver":13,"./solver/Solver":4,"./world/World":14,"gl-matrix":15}],15:[function(r,n,e){(function(){(function(){"use strict";var r={};e===void 0?"function"==typeof t&&"object"==typeof t.amd&&t.amd?(r.exports={},t(function(){return r.exports})):r.exports=window:r.exports=e,function(t){var r={};if(!n)var n=1e-6;r.create=function(){return new Float32Array(2)},r.clone=function(t){var r=new Float32Array(2);return r[0]=t[0],r[1]=t[1],r},r.fromValues=function(t,r){var n=new Float32Array(2);return n[0]=t,n[1]=r,n},r.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t},r.set=function(t,r,n){return t[0]=r,t[1]=n,t},r.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t},r.sub=r.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t},r.mul=r.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t},r.div=r.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t},r.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t},r.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t},r.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t},r.dist=r.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return Math.sqrt(n*n+e*e)},r.sqrDist=r.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return n*n+e*e},r.len=r.length=function(t){var r=t[0],n=t[1];return Math.sqrt(r*r+n*n)},r.sqrLen=r.squaredLength=function(t){var r=t[0],n=t[1];return r*r+n*n},r.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t},r.normalize=function(t,r){var n=r[0],e=r[1],o=n*n+e*e;return o>0&&(o=1/Math.sqrt(o),t[0]=r[0]*o,t[1]=r[1]*o),t},r.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]},r.cross=function(t,r,n){var e=r[0]*n[1]-r[1]*n[0];return t[0]=t[1]=0,t[2]=e,t},r.lerp=function(t,r,n,e){var o=r[0],i=r[1];return t[0]=o+e*(n[0]-o),t[1]=i+e*(n[1]-i),t},r.transformMat2=function(t,r,n){var e=r[0],o=r[1];return t[0]=e*n[0]+o*n[1],t[1]=e*n[2]+o*n[3],t},r.forEach=function(){var t=new Float32Array(2);return function(r,n,e,o,i,a){var s,c;for(n||(n=2),e||(e=0),c=o?Math.min(o*n+e,r.length):r.length,s=e;c>s;s+=n)t[0]=r[s],t[1]=r[s+1],i(t,t,a),r[s]=t[0],r[s+1]=t[1];return r}}(),r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},t!==void 0&&(t.vec2=r);var e={};if(!n)var n=1e-6;e.create=function(){return new Float32Array(3)},e.clone=function(t){var r=new Float32Array(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},e.fromValues=function(t,r,n){var e=new Float32Array(3);return e[0]=t,e[1]=r,e[2]=n,e},e.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},e.set=function(t,r,n,e){return t[0]=r,t[1]=n,t[2]=e,t},e.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t},e.sub=e.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t[2]=r[2]-n[2],t},e.mul=e.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t[2]=r[2]*n[2],t},e.div=e.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t[2]=r[2]/n[2],t},e.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t},e.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t},e.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t},e.dist=e.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],o=r[2]-t[2];return Math.sqrt(n*n+e*e+o*o)},e.sqrDist=e.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],o=r[2]-t[2];return n*n+e*e+o*o},e.len=e.length=function(t){var r=t[0],n=t[1],e=t[2];return Math.sqrt(r*r+n*n+e*e)},e.sqrLen=e.squaredLength=function(t){var r=t[0],n=t[1],e=t[2];return r*r+n*n+e*e},e.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t},e.normalize=function(t,r){var n=r[0],e=r[1],o=r[2],i=n*n+e*e+o*o;return i>0&&(i=1/Math.sqrt(i),t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i),t},e.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},e.cross=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=n[0],s=n[1],c=n[2];return t[0]=o*c-i*s,t[1]=i*a-e*c,t[2]=e*s-o*a,t},e.lerp=function(t,r,n,e){var o=r[0],i=r[1],a=r[2];return t[0]=o+e*(n[0]-o),t[1]=i+e*(n[1]-i),t[2]=a+e*(n[2]-a),t},e.transformMat4=function(t,r,n){var e=r[0],o=r[1],i=r[2];return t[0]=n[0]*e+n[4]*o+n[8]*i+n[12],t[1]=n[1]*e+n[5]*o+n[9]*i+n[13],t[2]=n[2]*e+n[6]*o+n[10]*i+n[14],t},e.transformQuat=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=n[0],s=n[1],c=n[2],u=n[3],l=u*e+s*i-c*o,h=u*o+c*e-a*i,f=u*i+a*o-s*e,p=-a*e-s*o-c*i;return t[0]=l*u+p*-a+h*-c-f*-s,t[1]=h*u+p*-s+f*-a-l*-c,t[2]=f*u+p*-c+l*-s-h*-a,t},e.forEach=function(){var t=new Float32Array(3);return function(r,n,e,o,i,a){var s,c;for(n||(n=3),e||(e=0),c=o?Math.min(o*n+e,r.length):r.length,s=e;c>s;s+=n)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],i(t,t,a),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}(),e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t!==void 0&&(t.vec3=e);var o={};if(!n)var n=1e-6;o.create=function(){return new Float32Array(4)},o.clone=function(t){var r=new Float32Array(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},o.fromValues=function(t,r,n,e){var o=new Float32Array(4);return o[0]=t,o[1]=r,o[2]=n,o[3]=e,o},o.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},o.set=function(t,r,n,e,o){return t[0]=r,t[1]=n,t[2]=e,t[3]=o,t},o.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t},o.sub=o.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t[2]=r[2]-n[2],t[3]=r[3]-n[3],t},o.mul=o.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t[2]=r[2]*n[2],t[3]=r[3]*n[3],t},o.div=o.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t[2]=r[2]/n[2],t[3]=r[3]/n[3],t},o.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t[3]=Math.min(r[3],n[3]),t},o.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t[3]=Math.max(r[3],n[3]),t},o.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t},o.dist=o.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],o=r[2]-t[2],i=r[3]-t[3];return Math.sqrt(n*n+e*e+o*o+i*i)},o.sqrDist=o.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],o=r[2]-t[2],i=r[3]-t[3];return n*n+e*e+o*o+i*i},o.len=o.length=function(t){var r=t[0],n=t[1],e=t[2],o=t[3];return Math.sqrt(r*r+n*n+e*e+o*o)},o.sqrLen=o.squaredLength=function(t){var r=t[0],n=t[1],e=t[2],o=t[3];return r*r+n*n+e*e+o*o},o.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t},o.normalize=function(t,r){var n=r[0],e=r[1],o=r[2],i=r[3],a=n*n+e*e+o*o+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a,t[3]=r[3]*a),t},o.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]},o.lerp=function(t,r,n,e){var o=r[0],i=r[1],a=r[2],s=r[3];return t[0]=o+e*(n[0]-o),t[1]=i+e*(n[1]-i),t[2]=a+e*(n[2]-a),t[3]=s+e*(n[3]-s),t},o.transformMat4=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=r[3];return t[0]=n[0]*e+n[4]*o+n[8]*i+n[12]*a,t[1]=n[1]*e+n[5]*o+n[9]*i+n[13]*a,t[2]=n[2]*e+n[6]*o+n[10]*i+n[14]*a,t[3]=n[3]*e+n[7]*o+n[11]*i+n[15]*a,t},o.transformQuat=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=n[0],s=n[1],c=n[2],u=n[3],l=u*e+s*i-c*o,h=u*o+c*e-a*i,f=u*i+a*o-s*e,p=-a*e-s*o-c*i;return t[0]=l*u+p*-a+h*-c-f*-s,t[1]=h*u+p*-s+f*-a-l*-c,t[2]=f*u+p*-c+l*-s-h*-a,t},o.forEach=function(){var t=new Float32Array(4);return function(r,n,e,o,i,a){var s,c;for(n||(n=4),e||(e=0),c=o?Math.min(o*n+e,r.length):r.length,s=e;c>s;s+=n)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],i(t,t,a),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}(),o.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.vec4=o);var i={},a=new Float32Array([1,0,0,1]);if(!n)var n=1e-6;i.create=function(){return new Float32Array(a)},i.clone=function(t){var r=new Float32Array(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},i.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},i.transpose=function(t,r){if(t===r){var n=r[1];t[1]=r[2],t[2]=n}else t[0]=r[0],t[1]=r[2],t[2]=r[1],t[3]=r[3];return t},i.invert=function(t,r){var n=r[0],e=r[1],o=r[2],i=r[3],a=n*i-o*e;return a?(a=1/a,t[0]=i*a,t[1]=-e*a,t[2]=-o*a,t[3]=n*a,t):null},i.adjoint=function(t,r){var n=r[0];return t[0]=r[3],t[1]=-r[1],t[2]=-r[2],t[3]=n,t},i.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},i.mul=i.multiply=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=r[3],s=n[0],c=n[1],u=n[2],l=n[3];return t[0]=e*s+o*u,t[1]=e*c+o*l,t[2]=i*s+a*u,t[3]=i*c+a*l,t},i.rotate=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=r[3],s=Math.sin(n),c=Math.cos(n);return t[0]=e*c+o*s,t[1]=e*-s+o*c,t[2]=i*c+a*s,t[3]=i*-s+a*c,t},i.scale=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=r[3],s=n[0],c=n[1];return t[0]=e*s,t[1]=o*c,t[2]=i*s,t[3]=a*c,t},i.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.mat2=i);var s={},c=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!n)var n=1e-6;s.create=function(){return new Float32Array(c)},s.clone=function(t){var r=new Float32Array(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},s.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.transpose=function(t,r){if(t===r){var n=r[1],e=r[2],o=r[5];t[1]=r[3],t[2]=r[6],t[3]=n,t[5]=r[7],t[6]=e,t[7]=o}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t},s.invert=function(t,r){var n=r[0],e=r[1],o=r[2],i=r[3],a=r[4],s=r[5],c=r[6],u=r[7],l=r[8],h=l*a-s*u,f=-l*i+s*c,p=u*i-a*c,v=n*h+e*f+o*p;return v?(v=1/v,t[0]=h*v,t[1]=(-l*e+o*u)*v,t[2]=(s*e-o*a)*v,t[3]=f*v,t[4]=(l*n-o*c)*v,t[5]=(-s*n+o*i)*v,t[6]=p*v,t[7]=(-u*n+e*c)*v,t[8]=(a*n-e*i)*v,t):null},s.adjoint=function(t,r){var n=r[0],e=r[1],o=r[2],i=r[3],a=r[4],s=r[5],c=r[6],u=r[7],l=r[8];return t[0]=a*l-s*u,t[1]=o*u-e*l,t[2]=e*s-o*a,t[3]=s*c-i*l,t[4]=n*l-o*c,t[5]=o*i-n*s,t[6]=i*u-a*c,t[7]=e*c-n*u,t[8]=n*a-e*i,t},s.determinant=function(t){var r=t[0],n=t[1],e=t[2],o=t[3],i=t[4],a=t[5],s=t[6],c=t[7],u=t[8];return r*(u*i-a*c)+n*(-u*o+a*s)+e*(c*o-i*s)},s.mul=s.multiply=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=r[3],s=r[4],c=r[5],u=r[6],l=r[7],h=r[8],f=n[0],p=n[1],v=n[2],d=n[3],m=n[4],y=n[5],g=n[6],b=n[7],q=n[8];return t[0]=f*e+p*a+v*u,t[1]=f*o+p*s+v*l,t[2]=f*i+p*c+v*h,t[3]=d*e+m*a+y*u,t[4]=d*o+m*s+y*l,t[5]=d*i+m*c+y*h,t[6]=g*e+b*a+q*u,t[7]=g*o+b*s+q*l,t[8]=g*i+b*c+q*h,t},s.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t!==void 0&&(t.mat3=s);var u={},l=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!n)var n=1e-6;u.create=function(){return new Float32Array(l)},u.clone=function(t){var r=new Float32Array(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},u.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.transpose=function(t,r){if(t===r){var n=r[1],e=r[2],o=r[3],i=r[6],a=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=n,t[6]=r[9],t[7]=r[13],t[8]=e,t[9]=i,t[11]=r[14],t[12]=o,t[13]=a,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},u.invert=function(t,r){var n=r[0],e=r[1],o=r[2],i=r[3],a=r[4],s=r[5],c=r[6],u=r[7],l=r[8],h=r[9],f=r[10],p=r[11],v=r[12],d=r[13],m=r[14],y=r[15],g=n*s-e*a,b=n*c-o*a,q=n*u-i*a,w=e*c-o*s,C=e*u-i*s,M=o*u-i*c,S=l*d-h*v,x=l*m-f*v,B=l*y-p*v,E=h*m-f*d,P=h*y-p*d,A=f*y-p*m,j=g*A-b*P+q*E+w*B-C*x+M*S;return j?(j=1/j,t[0]=(s*A-c*P+u*E)*j,t[1]=(o*P-e*A-i*E)*j,t[2]=(d*M-m*C+y*w)*j,t[3]=(f*C-h*M-p*w)*j,t[4]=(c*B-a*A-u*x)*j,t[5]=(n*A-o*B+i*x)*j,t[6]=(m*q-v*M-y*b)*j,t[7]=(l*M-f*q+p*b)*j,t[8]=(a*P-s*B+u*S)*j,t[9]=(e*B-n*P-i*S)*j,t[10]=(v*C-d*q+y*g)*j,t[11]=(h*q-l*C-p*g)*j,t[12]=(s*x-a*E-c*S)*j,t[13]=(n*E-e*x+o*S)*j,t[14]=(d*b-v*w-m*g)*j,t[15]=(l*w-h*b+f*g)*j,t):null},u.adjoint=function(t,r){var n=r[0],e=r[1],o=r[2],i=r[3],a=r[4],s=r[5],c=r[6],u=r[7],l=r[8],h=r[9],f=r[10],p=r[11],v=r[12],d=r[13],m=r[14],y=r[15];return t[0]=s*(f*y-p*m)-h*(c*y-u*m)+d*(c*p-u*f),t[1]=-(e*(f*y-p*m)-h*(o*y-i*m)+d*(o*p-i*f)),t[2]=e*(c*y-u*m)-s*(o*y-i*m)+d*(o*u-i*c),t[3]=-(e*(c*p-u*f)-s*(o*p-i*f)+h*(o*u-i*c)),t[4]=-(a*(f*y-p*m)-l*(c*y-u*m)+v*(c*p-u*f)),t[5]=n*(f*y-p*m)-l*(o*y-i*m)+v*(o*p-i*f),t[6]=-(n*(c*y-u*m)-a*(o*y-i*m)+v*(o*u-i*c)),t[7]=n*(c*p-u*f)-a*(o*p-i*f)+l*(o*u-i*c),t[8]=a*(h*y-p*d)-l*(s*y-u*d)+v*(s*p-u*h),t[9]=-(n*(h*y-p*d)-l*(e*y-i*d)+v*(e*p-i*h)),t[10]=n*(s*y-u*d)-a*(e*y-i*d)+v*(e*u-i*s),t[11]=-(n*(s*p-u*h)-a*(e*p-i*h)+l*(e*u-i*s)),t[12]=-(a*(h*m-f*d)-l*(s*m-c*d)+v*(s*f-c*h)),t[13]=n*(h*m-f*d)-l*(e*m-o*d)+v*(e*f-o*h),t[14]=-(n*(s*m-c*d)-a*(e*m-o*d)+v*(e*c-o*s)),t[15]=n*(s*f-c*h)-a*(e*f-o*h)+l*(e*c-o*s),t},u.determinant=function(t){var r=t[0],n=t[1],e=t[2],o=t[3],i=t[4],a=t[5],s=t[6],c=t[7],u=t[8],l=t[9],h=t[10],f=t[11],p=t[12],v=t[13],d=t[14],m=t[15],y=r*a-n*i,g=r*s-e*i,b=r*c-o*i,q=n*s-e*a,w=n*c-o*a,C=e*c-o*s,M=u*v-l*p,S=u*d-h*p,x=u*m-f*p,B=l*d-h*v,E=l*m-f*v,P=h*m-f*d;return y*P-g*E+b*B+q*x-w*S+C*M},u.mul=u.multiply=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=r[3],s=r[4],c=r[5],u=r[6],l=r[7],h=r[8],f=r[9],p=r[10],v=r[11],d=r[12],m=r[13],y=r[14],g=r[15],b=n[0],q=n[1],w=n[2],C=n[3];return t[0]=b*e+q*s+w*h+C*d,t[1]=b*o+q*c+w*f+C*m,t[2]=b*i+q*u+w*p+C*y,t[3]=b*a+q*l+w*v+C*g,b=n[4],q=n[5],w=n[6],C=n[7],t[4]=b*e+q*s+w*h+C*d,t[5]=b*o+q*c+w*f+C*m,t[6]=b*i+q*u+w*p+C*y,t[7]=b*a+q*l+w*v+C*g,b=n[8],q=n[9],w=n[10],C=n[11],t[8]=b*e+q*s+w*h+C*d,t[9]=b*o+q*c+w*f+C*m,t[10]=b*i+q*u+w*p+C*y,t[11]=b*a+q*l+w*v+C*g,b=n[12],q=n[13],w=n[14],C=n[15],t[12]=b*e+q*s+w*h+C*d,t[13]=b*o+q*c+w*f+C*m,t[14]=b*i+q*u+w*p+C*y,t[15]=b*a+q*l+w*v+C*g,t},u.translate=function(t,r,n){var e,o,i,a,s,c,u,l,h,f,p,v,d=n[0],m=n[1],y=n[2];return r===t?(t[12]=r[0]*d+r[4]*m+r[8]*y+r[12],t[13]=r[1]*d+r[5]*m+r[9]*y+r[13],t[14]=r[2]*d+r[6]*m+r[10]*y+r[14],t[15]=r[3]*d+r[7]*m+r[11]*y+r[15]):(e=r[0],o=r[1],i=r[2],a=r[3],s=r[4],c=r[5],u=r[6],l=r[7],h=r[8],f=r[9],p=r[10],v=r[11],t[0]=e,t[1]=o,t[2]=i,t[3]=a,t[4]=s,t[5]=c,t[6]=u,t[7]=l,t[8]=h,t[9]=f,t[10]=p,t[11]=v,t[12]=e*d+s*m+h*y+r[12],t[13]=o*d+c*m+f*y+r[13],t[14]=i*d+u*m+p*y+r[14],t[15]=a*d+l*m+v*y+r[15]),t},u.scale=function(t,r,n){var e=n[0],o=n[1],i=n[2];return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=r[7]*o,t[8]=r[8]*i,t[9]=r[9]*i,t[10]=r[10]*i,t[11]=r[11]*i,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},u.rotate=function(t,r,e,o){var i,a,s,c,u,l,h,f,p,v,d,m,y,g,b,q,w,C,M,S,x,B,E,P,A=o[0],j=o[1],k=o[2],F=Math.sqrt(A*A+j*j+k*k);return n>Math.abs(F)?null:(F=1/F,A*=F,j*=F,k*=F,i=Math.sin(e),a=Math.cos(e),s=1-a,c=r[0],u=r[1],l=r[2],h=r[3],f=r[4],p=r[5],v=r[6],d=r[7],m=r[8],y=r[9],g=r[10],b=r[11],q=A*A*s+a,w=j*A*s+k*i,C=k*A*s-j*i,M=A*j*s-k*i,S=j*j*s+a,x=k*j*s+A*i,B=A*k*s+j*i,E=j*k*s-A*i,P=k*k*s+a,t[0]=c*q+f*w+m*C,t[1]=u*q+p*w+y*C,t[2]=l*q+v*w+g*C,t[3]=h*q+d*w+b*C,t[4]=c*M+f*S+m*x,t[5]=u*M+p*S+y*x,t[6]=l*M+v*S+g*x,t[7]=h*M+d*S+b*x,t[8]=c*B+f*E+m*P,t[9]=u*B+p*E+y*P,t[10]=l*B+v*E+g*P,t[11]=h*B+d*E+b*P,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},u.rotateX=function(t,r,n){var e=Math.sin(n),o=Math.cos(n),i=r[4],a=r[5],s=r[6],c=r[7],u=r[8],l=r[9],h=r[10],f=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=i*o+u*e,t[5]=a*o+l*e,t[6]=s*o+h*e,t[7]=c*o+f*e,t[8]=u*o-i*e,t[9]=l*o-a*e,t[10]=h*o-s*e,t[11]=f*o-c*e,t},u.rotateY=function(t,r,n){var e=Math.sin(n),o=Math.cos(n),i=r[0],a=r[1],s=r[2],c=r[3],u=r[8],l=r[9],h=r[10],f=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=i*o-u*e,t[1]=a*o-l*e,t[2]=s*o-h*e,t[3]=c*o-f*e,t[8]=i*e+u*o,t[9]=a*e+l*o,t[10]=s*e+h*o,t[11]=c*e+f*o,t},u.rotateZ=function(t,r,n){var e=Math.sin(n),o=Math.cos(n),i=r[0],a=r[1],s=r[2],c=r[3],u=r[4],l=r[5],h=r[6],f=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=i*o+u*e,t[1]=a*o+l*e,t[2]=s*o+h*e,t[3]=c*o+f*e,t[4]=u*o-i*e,t[5]=l*o-a*e,t[6]=h*o-s*e,t[7]=f*o-c*e,t},u.fromRotationTranslation=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=r[3],s=e+e,c=o+o,u=i+i,l=e*s,h=e*c,f=e*u,p=o*c,v=o*u,d=i*u,m=a*s,y=a*c,g=a*u;return t[0]=1-(p+d),t[1]=h+g,t[2]=f-y,t[3]=0,t[4]=h-g,t[5]=1-(l+d),t[6]=v+m,t[7]=0,t[8]=f+y,t[9]=v-m,t[10]=1-(l+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},u.frustum=function(t,r,n,e,o,i,a){var s=1/(n-r),c=1/(o-e),u=1/(i-a);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*c,t[6]=0,t[7]=0,t[8]=(n+r)*s,t[9]=(o+e)*c,t[10]=(a+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*i*u,t[15]=0,t},u.perspective=function(t,r,n,e,o){var i=1/Math.tan(r/2),a=1/(e-o);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+e)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*e*a,t[15]=0,t},u.ortho=function(t,r,n,e,o,i,a){var s=1/(r-n),c=1/(e-o),u=1/(i-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(r+n)*s,t[13]=(o+e)*c,t[14]=(a+i)*u,t[15]=1,t},u.lookAt=function(t,r,e,o){var i,a,s,c,l,h,f,p,v,d,m=r[0],y=r[1],g=r[2],b=o[0],q=o[1],w=o[2],C=e[0],M=e[1],S=e[2];return n>Math.abs(m-C)&&n>Math.abs(y-M)&&n>Math.abs(g-S)?u.identity(t):(f=m-C,p=y-M,v=g-S,d=1/Math.sqrt(f*f+p*p+v*v),f*=d,p*=d,v*=d,i=q*v-w*p,a=w*f-b*v,s=b*p-q*f,d=Math.sqrt(i*i+a*a+s*s),d?(d=1/d,i*=d,a*=d,s*=d):(i=0,a=0,s=0),c=p*s-v*a,l=v*i-f*s,h=f*a-p*i,d=Math.sqrt(c*c+l*l+h*h),d?(d=1/d,c*=d,l*=d,h*=d):(c=0,l=0,h=0),t[0]=i,t[1]=c,t[2]=f,t[3]=0,t[4]=a,t[5]=l,t[6]=p,t[7]=0,t[8]=s,t[9]=h,t[10]=v,t[11]=0,t[12]=-(i*m+a*y+s*g),t[13]=-(c*m+l*y+h*g),t[14]=-(f*m+p*y+v*g),t[15]=1,t)},u.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t!==void 0&&(t.mat4=u);var h={},f=new Float32Array([0,0,0,1]);if(!n)var n=1e-6;h.create=function(){return new Float32Array(f)},h.clone=o.clone,h.fromValues=o.fromValues,h.copy=o.copy,h.set=o.set,h.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.setAxisAngle=function(t,r,n){n=.5*n;var e=Math.sin(n);return t[0]=e*r[0],t[1]=e*r[1],t[2]=e*r[2],t[3]=Math.cos(n),t},h.add=o.add,h.mul=h.multiply=function(t,r,n){var e=r[0],o=r[1],i=r[2],a=r[3],s=n[0],c=n[1],u=n[2],l=n[3];return t[0]=e*l+a*s+o*u-i*c,t[1]=o*l+a*c+i*s-e*u,t[2]=i*l+a*u+e*c-o*s,t[3]=a*l-e*s-o*c-i*u,t},h.scale=o.scale,h.rotateX=function(t,r,n){n*=.5;var e=r[0],o=r[1],i=r[2],a=r[3],s=Math.sin(n),c=Math.cos(n);return t[0]=e*c+a*s,t[1]=o*c+i*s,t[2]=i*c-o*s,t[3]=a*c-e*s,t},h.rotateY=function(t,r,n){n*=.5;var e=r[0],o=r[1],i=r[2],a=r[3],s=Math.sin(n),c=Math.cos(n);return t[0]=e*c-i*s,t[1]=o*c+a*s,t[2]=i*c+e*s,t[3]=a*c-o*s,t},h.rotateZ=function(t,r,n){n*=.5;var e=r[0],o=r[1],i=r[2],a=r[3],s=Math.sin(n),c=Math.cos(n);return t[0]=e*c+o*s,t[1]=o*c-e*s,t[2]=i*c+a*s,t[3]=a*c-i*s,t},h.calculateW=function(t,r){var n=r[0],e=r[1],o=r[2];return t[0]=n,t[1]=e,t[2]=o,t[3]=-Math.sqrt(Math.abs(1-n*n-e*e-o*o)),t},h.dot=o.dot,h.lerp=o.lerp,h.slerp=function(t,r,n,e){var o,i,a,s,c=r[0],u=r[1],l=r[2],h=r[3],f=n[0],p=n[1],v=n[2],d=r[3],m=c*f+u*p+l*v+h*d;return Math.abs(m)>=1?(t!==r&&(t[0]=c,t[1]=u,t[2]=l,t[3]=h),t):(o=Math.acos(m),i=Math.sqrt(1-m*m),.001>Math.abs(i)?(t[0]=.5*c+.5*f,t[1]=.5*u+.5*p,t[2]=.5*l+.5*v,t[3]=.5*h+.5*d,t):(a=Math.sin((1-e)*o)/i,s=Math.sin(e*o)/i,t[0]=c*a+f*s,t[1]=u*a+p*s,t[2]=l*a+v*s,t[3]=h*a+d*s,t))},h.invert=function(t,r){var n=r[0],e=r[1],o=r[2],i=r[3],a=n*n+e*e+o*o+i*i,s=a?1/a:0;return t[0]=-n*s,t[1]=-e*s,t[2]=-o*s,t[3]=i*s,t},h.conjugate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t},h.len=h.length=o.length,h.sqrLen=h.squaredLength=o.squaredLength,h.normalize=o.normalize,h.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.quat=h)}(r.exports)})()})()},{}],16:[function(t,r,n){n.vec2={getX:function(t){return t[0]},getY:function(t){return t[1]},crossLength:function(t,r){return t[0]*r[1]-t[1]*r[0]},rotate:function(t,r,n){var e=Math.cos(n),o=Math.sin(n);t[0]=e*r[0]-o*r[1],t[1]=o*r[0]+e*r[1]}}},{}],6:[function(t,r,n){function e(t,r,n){n=n||{},this.restLength=n.restLength||1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=r}function o(t){t=t||{},this.id=++o._idCounter,this.shape=t.shape,this.mass=t.mass||0,this.invMass=this.mass>0?1/this.mass:0,this.inertia=t.inertia||this.mass,this.invInertia=this.invMass,this.position=a.create(),t.position&&a.copy(this.position,t.position),this.velocity=a.create(),t.velocity&&a.copy(this.velocity,t.velocity),this.vlambda=a.create(),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=a.create(),t.force&&a.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.motionState=0==this.mass?o.MotionState.STATIC:o.MotionState.DYNAMIC}var i=t("gl-matrix"),a=i.vec2;n.Body=o,n.Spring=e,o._idCounter=0;var s=a.create();o.prototype.applyForce=function(t,r){var n=s;a.sub(n,r,this.position),a.add(this.force,this.force,t);var e=a.crossLength(n,t);this.angularForce+=e},o.MotionState={DYNAMIC:1,STATIC:2,KINEMATIC:4}},{"gl-matrix":15}],8:[function(t,r,n){function e(t,r){o.call(this,t,r,0,1e6),this.penetration=0,this.ri=a.create(),this.penetrationVec=a.create(),this.rj=a.create(),this.ni=a.create(),this.rixn=a.create(),this.rjxn=a.create(),this.rixw=a.create(),this.rjxw=a.create(),this.relVel=a.create(),this.relForce=a.create()}var o=t("./Equation").Equation,i=t("gl-matrix"),a=i.vec2,s=t("../gl-matrix-extensions"),c=s.vec2;n.ContactEquation=e,e.prototype=new o,e.prototype.constructor=e,e.prototype.computeB=function(t,r,n){var e=this.bi,o=this.bj,i=this.ri,s=this.rj,u=e.position,l=o.position,h=e.velocity,f=e.angularVelocity,p=e.force,v=e.angularForce,d=o.velocity,m=o.angularVelocity,y=o.force,g=o.angularForce,b=(this.relVel,this.relForce,this.penetrationVec),q=e.invMass,w=o.invMass,C=e.invInertia,M=o.invInertia,S=this.ni,x=this.rixn=c.crossLength(i,S),B=this.rjxn=c.crossLength(s,S);a.set(b,0,0),a.add(b,l,s),a.sub(b,b,u),a.sub(b,b,i);var E=a.dot(S,b),P=a.dot(d,S)-a.dot(h,S)+m*B-f*x,A=a.dot(y,S)*w-a.dot(p,S)*q+M*g*B-C*v*x,j=-E*t-P*r-n*A;return j},e.prototype.computeC=function(t){var r=this.bi,n=this.bj,e=this.rixn,o=this.rjxn,i=r.invMass,a=n.invMass,s=i+a+t,c=r.invInertia,u=n.invInertia;return s+=c*e*e,s+=u*o*o};var u=a.create();e.prototype.computeGWlambda=function(){var t=this.bi,r=this.bj,n=u,e=0;return a.sub(n,r.vlambda,t.vlambda),e+=a.dot(n,this.ni),e-=t.wlambda*this.rixn,e+=r.wlambda*this.rjxn};var l=a.create();e.prototype.addToWlambda=function(t){var r=this.bi,n=this.bj,e=this.rixn,o=this.rjxn,i=r.invMass,s=n.invMass,c=this.ni,u=l;a.scale(u,c,i*t),a.sub(r.vlambda,r.vlambda,u),a.scale(u,c,s*t),a.add(n.vlambda,n.vlambda,u),r.wlambda-=r.invInertia*e*t,n.wlambda+=n.invInertia*o*t}},{"./Equation":3,"../gl-matrix-extensions":16,"gl-matrix":15}],7:[function(t,r,n){var e=t("gl-matrix"),o=t("../gl-matrix-extensions"),i=o.vec2,a=e.vec2,s=e.mat2,c=a.create();s.create();var u=a.create(),l=a.fromValues(0,1);n.checkCircleCircle=function(t,r,n){a.sub(c,t.position,r.position);var e=t.shape.radius,o=r.shape.radius;(e+o)*(e+o)>a.sqrLen(c)&&(n.push(t),n.push(r))},n.checkCirclePlane=function(t,r,n){a.sub(c,t.position,r.position),i.rotate(u,l,r.angle),a.dot(c,u)<=t.shape.radius&&(n.push(t),n.push(r))},n.checkCircleParticle=function(t,r,n){n.push(t),n.push(r)},n.nearphaseCircleCircle=function(t,r,n,e){var o=e.length?e.pop():new p2.ContactEquation(t,r);o.bi=t,o.bj=r,a.sub(o.ni,r.position,t.position),a.normalize(o.ni,o.ni),a.scale(o.ri,o.ni,t.shape.radius),a.scale(o.rj,o.ni,-r.shape.radius),n.push(o)},n.nearphaseCircleParticle=function(){};var h=(s.create(),a.create()),f=a.create();n.nearphaseCirclePlane=function(t,r,n,e){var o=e.length?e.pop():new p2.ContactEquation(r,t);o.bi=r,o.bj=t;var s=h,c=f;i.rotate(o.ni,l,r.angle),a.scale(o.rj,o.ni,-t.shape.radius),a.sub(s,t.position,r.position);var u=a.dot(o.ni,s);a.scale(c,o.ni,u),a.sub(o.ri,s,c),n.push(o)},n.Broadphase=function(){},n.Broadphase.prototype.getCollisionPairs=function(){throw Error("getCollisionPairs must be implemented in a subclass!")}},{"../gl-matrix-extensions":16,"gl-matrix":15}],9:[function(t,r,n){function e(t,r,n,e){o.call(this,t,r),e===void 0&&(e=1e6);var s=this.equations=[new i(t,r)],c=s[0];c.minForce=-e,c.maxForce=e,this.update=function(){a.subtract(c.ni,r.position,t.position),a.normalize(c.ni,c.ni),a.scale(c.ri,c.ni,.5*n),a.scale(c.rj,c.ni,.5*-n)}}var o=t("./Constraint").Constraint,i=t("./ContactEquation").ContactEquation,a=t("gl-matrix").vec2;n.DistanceConstraint=e,e.prototype=new o},{"./Constraint":2,"./ContactEquation":8,"gl-matrix":15}],11:[function(t,r,n){function e(t){a.call(this),t=t||{},this.iterations=t.iterations||10,this.h=t.timeStep||1/60,this.k=t.stiffness||1e7,this.d=t.relaxation||6,this.a=0,this.b=0,this.eps=0,this.tolerance=t.tolerance||0,this.setSpookParams(this.k,this.d),this.debug=t.debug||!1,this.arrayStep=30,this.lambda=new s(this.arrayStep),this.Bs=new s(this.arrayStep),this.invCs=new s(this.arrayStep)}var o=t("gl-matrix"),i=o.vec2,a=t("./Solver").Solver;n.GSSolver=e;var s=Float32Array||Array;e.prototype=new a,e.prototype.setSpookParams=function(t,r){var n=this.h;this.k=t,this.d=r,this.a=4/(n*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(n*n*t*(1+4*r))},e.prototype.solve=function(t,r,n){var e=(this.d,this.k,0),o=this.iterations,a=this.tolerance*this.tolerance,c=this.a,u=this.b,l=this.eps,h=this.equations,f=h.length,p=r.bodies,v=r.bodies.length,d=t;f>this.lambda.length&&(this.lambda=new s(f+this.arrayStep),this.Bs=new s(f+this.arrayStep),this.invCs=new s(f+this.arrayStep));for(var m=this.invCs,y=this.Bs,g=this.lambda,b=0;b!==f;b++){var q=h[b];g[b]=0,y[b]=q.computeB(c,u,d),m[b]=1/q.computeC(l)}var w,q,C,M,S,x,B;if(0!==f){var b,E,P,A,j;for(b=0;b!==v;b++){var u=p[b],k=u.vlambda;i.set(k,0,0),u.wlambda=0}for(e=0;e!==o;e++){for(S=0,E=0;E!==f;E++)q=h[E],A=q.maxForce,P=q.minForce,w=y[E],C=m[E],B=g[E],x=q.computeGWlambda(l),M=C*(w-x-l*B),j=B+M,P>j?M=P-B:j>A&&(M=A-B),g[E]+=M,S+=Math.abs(M),q.addToWlambda(M);if(a>=S*S)break}for(b=0;b!==v;b++){var u=p[b],F=u.velocity;i.add(F,F,u.vlambda),u.angularVelocity+=u.wlambda}}errorTot=S,n()}},{"./Solver":4,"gl-matrix":15}],10:[function(t,r,n){var e=t("../objects/Shape").Circle,o=t("../objects/Shape").Plane,i=t("../objects/Shape").Particle,a=t("../collision/Broadphase"),s=a.Broadphase,c=t("gl-matrix");c.vec2,n.GridBroadphase=function(t,r,n,c,u,l){s.apply(this),u=u||10,l=l||10;var h=(r-t)/u,f=(c-n)/l;this.getCollisionPairs=function(s){for(var p=[],v=s.collidingBodies,d=d=v.length,m=[],y=u*l,g=0;y>g;g++)m.push([]);for(var b=u/(r-t),q=l/(c-n),g=0;g!==d;g++){var w=v[g],C=w.shape;if(void 0!==C)if(C instanceof e)for(var M=w.position[0],S=w.position[1],x=C.radius,B=Math.floor(b*(M-x-t)),E=Math.floor(q*(S-x-n)),P=Math.floor(b*(M+x-t)),A=Math.floor(q*(S+x-n)),j=B;P>=j;j++)for(var k=E;A>=k;k++){var F=j,_=k;F*(l-1)+_>=0&&y>F*(l-1)+_&&m[F*(l-1)+_].push(w)}else{if(!(C instanceof o))throw Error("Shape not supported in GridBroadphase!");if(0==w.angle)for(var S=w.position[1],j=0;j!==y&&S>n+f*(j-1);j++)for(var k=0;u>k;k++){var F=k,_=Math.floor(q*(f*j-n));m[F*(l-1)+_].push(w)}else if(w.angle==.5*Math.PI)for(var M=w.position[0],j=0;j!==y&&M>t+h*(j-1);j++)for(var k=0;l>k;k++){var _=k,F=Math.floor(b*(h*j-t));m[F*(l-1)+_].push(w)}else for(var j=0;j!==y;j++)m[j].push(w)}}for(var g=0;g!==y;g++)for(var I=m[g],j=0,T=I.length;j!==T;j++)for(var w=I[j],C=w.shape,k=0;k!==j;k++){var G=I[k],N=G.shape;C instanceof e?N instanceof e?a.checkCircleCircle(w,G,p):N instanceof i?a.checkCircleParticle(w,G,p):N instanceof o&&a.checkCirclePlane(w,G,p):C instanceof i?N instanceof e&&a.checkCircleParticle(G,w,p):C instanceof o&&N instanceof e&&a.checkCirclePlane(G,w,p)}return p}},n.GridBroadphase.prototype=new s},{"../objects/Shape":1,"../collision/Broadphase":7,"gl-matrix":15}],12:[function(t,r,n){var e=t("../objects/Shape").Circle,o=t("../objects/Shape").Plane,i=t("../collision/Broadphase"),a=i.Broadphase,s=t("gl-matrix");s.vec2,n.NaiveBroadphase=function(){a.apply(this),this.getCollisionPairs=function(t){for(var r=t.collidingBodies,n=[],a=0,s=r.length;a!==s;a++){var c=r[a],u=c.shape;if(void 0!==u)for(var l=0;l!==a;l++){var h=r[l],f=h.shape;void 0!==f&&(u instanceof e?f instanceof e?i.checkCircleCircle(c,h,n):f instanceof Particle?i.checkCircleParticle(c,h,n):f instanceof o&&i.checkCirclePlane(c,h,n):u instanceof Particle?f instanceof e&&i.checkCircleParticle(h,c,n):u instanceof o&&f instanceof e&&i.checkCirclePlane(h,c,n))}}return n}},n.NaiveBroadphase.prototype=new a},{"../objects/Shape":1,"../collision/Broadphase":7,"gl-matrix":15}],13:[function(t,r,n){function e(t,r,n){function e(t){var r=o._workers.indexOf(this),n=o._workerIslandGroups[r];
n.applyResult(t.data),n.reset(),o._workerData[r]=t.data,o._numWorking--,0==o._numWorking&&o._stepDoneCallback()}u.call(this),r=r||2,n=n||"p2.js";var o=this;this.subsolver=t,this.numIslands=0,this._nodePool=[],this._workers=[],this._workerData=[],this._workerBodies=[],this._workerIslandGroups=[],this._numWorking=0,this._stepDoneCallback=function(){};for(var i=new Blob([['importScripts("'+n+'");',"var id = 0; // Worker id","var dt = 1/60; // Solve timestep","var islandGroup = new p2.IslandGroup();","var solver;","this.onmessage = function(e){","    var that=this;",'    if(typeof(e.data.id)!="undefined"){',"        id = parseInt(e.data.id);","        dt = e.data.timeStep;","        solver = new p2.GSSolver(); // Todo: user picked solver","        solver.setSpookParams(1e10,3);","        solver.iterations = 20; // and other params","        return;","    } else {","        // Parse islands and solve","        var array = e.data;","        islandGroup.fromArray(array);","        islandGroup.solve(dt,solver,function(){","            islandGroup.resultToArray(array);","            that.postMessage(array,[array.buffer]);","            islandGroup.reset();","        });","    }","};"].join("\n")],{type:"text/javascript"}),a=window.URL.createObjectURL(i),s=0;r>s;s++){var l=new Worker(a);l.onmessage=e,l.postMessage({id:s,timeStep:1/60});var h=new Float32Array(100);this._workers.push(l),this._workerData.push(h),this._workerIslandGroups.push(new c)}}function o(t){for(var r=t.length,n=0;n!==r;n++){var e=t[n];if(!(e.visited||e.body.motionState&p))return e}return!1}function i(t,r){var n=[];for(n.push(t),t.visited=!0,r(t);n.length;)for(var e,i=n.pop();e=o(i.children);)e.visited=!0,r(e),n.push(e)}function a(t,r){return r>t.length?new Float32Array(r+s.ARRAY_CHUNK):t}function s(){this.equations=[],this.bodies=[],this._contactEquationPool=[],this._bodyPool=[]}function c(){this.islands=[],this._islandPool=[]}var u=t("./Solver").Solver,l=t("../constraints/ContactEquation").ContactEquation,h=t("gl-matrix").vec2,f=t("../objects/Body").Body,p=f.MotionState.STATIC;n.ParallelIslandSolver=e,n.Island=s,n.IslandGroup=c,e.prototype=new u,e.prototype.solve=function(t,r,n){function e(t){B.push(t.body);for(var r=t.eqs.length,n=0;n!==r;n++){var e=t.eqs[n];-1===x.indexOf(e)&&x.push(e)}}var c=[],u=r.bodies,l=this.equations,h=l.length,f=u.length,p=(this.subsolver,this._workers),v=this._workerData,d=this._workerIslandGroups;this._stepDoneCallback=n;for(var m=0;m!==f;m++)this._nodePool.length?c.push(this._nodePool.pop()):c.push({body:u[m],children:[],eqs:[],visited:!1});for(var m=0;m!==f;m++){var y=c[m];y.body=u[m],y.children.length=0,y.eqs.length=0,y.visited=!1}for(var g=0;g!==h;g++){var b=l[g],m=u.indexOf(b.bi),q=u.indexOf(b.bj),w=c[m],C=c[q];w.children.push(C),w.eqs.push(b),C.children.push(w),C.eqs.push(b)}for(var M,S=0,x=[],B=[],m=0;d.length>m;m++)d[m].reset();for(var E=[];M=o(c);){var P=new s;x.length=0,B.length=0,i(M,e);for(var A=x.length,m=0;m!==A;m++){var b=x[m];P.equations.push(b)}S++,E.push(P)}this.numIslands=S;for(var j=[],k=[],m=0;p.length>m;m++)j[m]=0,k.push([]);for(;E.length;){for(var P=E.pop(),F=1/0,_=0,m=0;p.length>m;m++){var I=d[m].numEquations();F>I&&(F=I,_=m)}d[_].islands.push(P)}for(var m=0;m!==p.length;m++){var T=d[m];if(T.islands.length){var G=T.storageSize();v[m]=a(v[m],G),T.toArray(v[m]),this._numWorking++,p[m].postMessage(v[m],[v[m].buffer])}}},s.ARRAY_CHUNK=0,s.EquationTypes={CONTACT:1},s.getEquationTypes=function(){var t=[];for(var r in s.EquationTypes)t.push(s.EquationTypes[r]);return t},s.NUMBERS_PER_BODY=12,s.NUMBERS_PER_EQUATION={1:11},s.prototype.reset=function(){for(;this.bodies.length;)this._bodyPool.push(this.bodies.pop());for(;this.equations.length;)this._contactEquationPool.push(this.equations.pop())},s.prototype.fromArray=function(t,r){r=r||0,this.reset();for(var n=r,e=t[n++],o=t[n++],i={},a=0;o>a;a++){var c=this._bodyPool.pop()||new f;c.id=t[n++],h.set(c.position,t[n++],t[n++]),h.set(c.velocity,t[n++],t[n++]),c.angle=t[n++],c.angularVelocity=t[n++],c.mass=t[n++],c.inertia=t[n++],0>c.mass&&(c.mass=0),0>c.inertia&&(c.inertia=0),h.set(c.force,t[n++],t[n++]),c.angularForce=t[n++],c.invMass=c.mass>0?1/c.mass:0,c.invInertia=c.inertia>0?1/c.inertia:0,this.bodies.push(c),i[c.id+""]=c}var u=s.getEquationTypes();if(n>t.length)throw Error("Trying to read element "+n+" of an array of length "+t.length+" ("+o+" bodies, "+e+" eqs)");for(var a=0;e>a;a++){var p=t[n++];if(-1===u.indexOf(p))throw Error("Equation "+a+" (out of "+e+") type not recognized: "+p);var v,d=t[n++],m=t[n++],y=t[n++],g=t[n++];switch(p){case s.EquationTypes.CONTACT:v=this._contactEquationPool.pop()||new l,h.set(v.ri,t[n++],t[n++]),h.set(v.rj,t[n++],t[n++]),h.set(v.ni,t[n++],t[n++]);break;default:throw Error("Equation type not recognized: "+p)}if(v.bi=i[d+""],v.bj=i[m+""],!v.bi)throw Error("Body "+d+" not found");if(!v.bj)throw Error("Body "+m+" not found");v.minForce=y,v.maxForce=g,this.equations.push(v)}return n},s.prototype.toArray=function(t,r){var n=r,e=this.getBodies(),o=e.length,i=this.equations.length;t[n++]=i,t[n++]=o;for(var a=0;o>a;a++){var c=e[a],u=c.position,h=c.velocity;t[n++]=c.id,t[n++]=u[0],t[n++]=u[1],t[n++]=h[0],t[n++]=h[1],t[n++]=c.angle,t[n++]=c.angularVelocity,t[n++]=c.mass,t[n++]=c.inertia,t[n++]=c.force[0],t[n++]=c.force[1],t[n++]=c.angularForce}for(var a=0;i>a;a++){var f,p=this.equations[a];if(!(p instanceof l))throw Error("Equation type not recognized");switch(f=s.EquationTypes.CONTACT,t[n++]=f,t[n++]=p.bi.id,t[n++]=p.bj.id,t[n++]=p.minForce,t[n++]=p.maxForce,f){case s.EquationTypes.CONTACT:t[n++]=p.ri[0],t[n++]=p.ri[1],t[n++]=p.rj[0],t[n++]=p.rj[1],t[n++]=p.ni[0],t[n++]=p.ni[1];break;default:throw Error("Equation type not recognized: "+f)}}return n},s.prototype.storageSize=function(){var t=2;t+=s.NUMBERS_PER_BODY*this.getBodies().length;for(var r=this.equations,n=r.length,e=0;e!==n;e++){var o=r[e];if(!(o instanceof l))throw Error("Equation type not recognized!");t+=s.NUMBERS_PER_EQUATION[s.EquationTypes.CONTACT]}return t},s.prototype.getBodies=function(){for(var t=[],r=[],n=this.equations,e=0;e!==n.length;e++){var o=n[e];-1===r.indexOf(o.bi.id)&&(t.push(o.bi),r.push(o.bi.id)),-1===r.indexOf(o.bj.id)&&(t.push(o.bj),r.push(o.bj.id))}return t},c.prototype.reset=function(){for(;this.islands.length;){var t=this.islands.pop();t.reset(),this._islandPool.push(t)}},c.prototype.numEquations=function(){for(var t=this.islands,r=t.length,n=0,e=0;e!==r;e++)n+=t[e].equations.length;return n},c.prototype.storageSize=function(){for(var t=this.islands,r=1,n=0;t.length>n;n++){var e=t[n].storageSize();r+=e}return r},c.prototype.toArray=function(t){var r=this.islands,n=0;t[n++]=this.islands.length;for(var e=0;r.length>e;e++){var o=r[e];n=o.toArray(t,n)}},c.prototype.fromArray=function(t){var r=this.islands;this.reset();for(var n=0,e=t[n++];e>r.length;)this.islands.push(this._islandPool.pop()||new s);for(var o=0;e>o;o++){var i=this.islands[o];n=i.fromArray(t,n)}},c.prototype.solve=function(t,r,n){var e=this.islands,o=e.length,i=[];r.removeAllEquations();for(var a=0;a!==o;a++){for(var s=e[a],c=s.equations.length,u=0;u!==c;u++)r.addEquation(s.equations[u]);for(var l=s.getBodies(),h=l.length,u=0;u!==h;u++)i.push(l[u])}r.solve(t,{bodies:i},n)},c.prototype.resultToArray=function(t){for(var r=this.islands,n=r.length,e=0,o=0;o!==n;o++)for(var i=r[o].getBodies(),a=i.length,s=0;s!==a;s++){var c=i[s],u=c.vlambda;t[e++]=u[0],t[e++]=u[1],t[e++]=c.wlambda}},c.prototype.applyResult=function(t){for(var r=this.islands,n=r.length,e=0,o=0;o!==n;o++)for(var i=r[o].getBodies(),a=i.length,s=0;s!==a;s++){var c=i[s],u=c.velocity,l=t[e++],f=t[e++],p=t[e++];h.set(c.vlambda,l,f),h.add(u,u,c.vlambda),c.wlambda=p,c.angularVelocity+=p}}},{"./Solver":4,"../constraints/ContactEquation":8,"../objects/Body":6,"gl-matrix":15}],14:[function(t,r,n){function e(){return performance.now?performance.now():performance.webkitNow?performance.webkitNow():(new Date).getTime()}function o(t){t=t||{},this.springs=[],this.bodies=[],this.solver=t.solver||new i,this.contacts=[],this.oldContacts=[],this.collidingBodies=[],this.gravity=t.gravity||c.fromValues(0,-9.78),this.doProfiling=t.doProfiling||!1,this.lastStepTime=0,this.broadphase=t.broadphase||new a,this.constraints=[],this._constraintIdCounter=0,this._bodyIdCounter=0}var i=t("../solver/GSSolver").GSSolver,a=t("../collision/NaiveBroadphase").NaiveBroadphase,s=t("gl-matrix"),c=s.vec2,u=t("../objects/Shape").Circle,l=t("../objects/Shape").Plane,h=t("../objects/Shape").Particle,f=t("../objects/Body").Body,p=t("../collision/Broadphase");p.Broadphase,n.World=o,o.prototype.addConstraint=function(t){this.constraints.push(t),t.id=this._constraintIdCounter++},o.prototype.removeConstraint=function(t){var r=this.constraints.indexOf(t);-1!==r&&this.constraints.splice(r,1)};var v=c.create(),d=c.create(),m=c.create(),y=c.create(),g=c.create(),b=c.create();o.prototype.step=function(t,r){var n,o,i=this,a=this.doProfiling,s=this.springs.length,f=this.springs,q=this.bodies,w=(this.collidingBodies,this.gravity),C=this.solver,M=this.bodies.length,S=this.broadphase,x=this.constraints;a&&(n=e());for(var B=0;B!==M;B++){var E=q[B].force;c.add(E,E,w)}for(var B=0;B!==s;B++){var P=f[B],A=P.stiffness,j=P.damping,k=P.restLength,F=P.bodyA,_=P.bodyB,I=v,T=d,G=m,N=y;c.sub(I,F.position,_.position),c.sub(G,F.velocity,_.velocity);var V=c.len(I);c.normalize(T,I),c.scale(N,T,A*(V-k)+j*c.dot(G,T)),c.sub(F.force,F.force,N),c.add(_.force,_.force,N)}for(var D=S.getCollisionPairs(this),O=this.contacts.concat(this.oldContacts),L=this.contacts=[],B=0,z=D.length;B!==z;B+=2){var R=D[B],W=D[B+1],U=R.shape,Y=W.shape;U instanceof u?Y instanceof u?p.nearphaseCircleCircle(R,W,L,O):Y instanceof h?p.nearphaseCircleParticle(R,W,L,O):Y instanceof l&&p.nearphaseCirclePlane(R,W,L,O):U instanceof h?Y instanceof u&&p.nearphaseCircleParticle(W,R,L,O):U instanceof l&&Y instanceof u&&p.nearphaseCirclePlane(W,R,L,O)}this.oldContacts=O;for(var B=0,Q=L.length;B!==Q;B++)C.addEquation(L[B]);var K=x.length;for(B=0;B!==K;B++){var X=x[B];X.update();for(var H=0,J=X.equations.length;H!==J;H++){var Z=X.equations[H];C.addEquation(Z)}}C.solve(t,this,function(){C.removeAllEquations();for(var s=g,u=b,l=0;l!==M;l++){var h=q[l];if(h.mass>0){var f=1/h.mass,p=h.force,v=h.position,d=h.velocity;h.angularVelocity+=h.angularForce*h.invInertia*t,h.angle+=h.angularVelocity*t,c.scale(s,p,t*f),c.add(d,s,d),c.scale(u,d,t),c.add(v,v,u)}}for(var l=0;l!==M;l++){var m=q[l];c.set(m.force,0,0),m.angularForce=0}a&&(o=e(),i.lastStepTime=o-n),r()})},o.prototype.addSpring=function(t){this.springs.push(t)},o.prototype.removeSpring=function(t){var r=this.springs.indexOf(t);-1===r&&this.springs.splice(r,1)},o.prototype.addBody=function(t){this.bodies.push(t),this.collidingBodies.push(t)},o.prototype.removeBody=function(t){var r=this.bodies.indexOf(t);-1===r&&this.bodies.splice(r,1)},o.prototype.toJSON=function(){function t(t){return[t[0],t[1]]}for(var r={p2:"0.1.0",bodies:[],springs:[],solver:{},gravity:t(this.gravity),broadphase:{},constraints:[]},n=0;this.bodies.length>n;n++){var e=this.bodies[n];r.bodies.push({mass:e.mass,angle:e.angle,position:t(e.position),velocity:t(e.velocity),angularVelocity:e.angularVelocity,force:t(e.force)})}return r},o.prototype.fromJSON=function(t){if(this.clear(),!t.p2)return!1;switch(t.p2){case"0.1.0":for(var r=0;t.bodies.length>r;r++){var n=t.bodies[r],e=new f({mass:n.mass,position:n.position,angle:n.angle,velocity:n.velocity,angularVelocity:n.angularVelocity,force:n.force});this.addBody(e)}break;default:return!1}return!0},o.prototype.clear=function(){for(var t=this.constraints,r=0;t.length>r;r++)this.removeConstraint(t[r]);for(var n=this.bodies,r=0;n.length>r;r++)this.removeBody(n[r]);for(var e=this.springs,r=0;e.length>r;r++)this.removeSpring(e[r])}},{"../solver/GSSolver":11,"../collision/NaiveBroadphase":12,"../objects/Shape":1,"../objects/Body":6,"../collision/Broadphase":7,"gl-matrix":15}]},{},[5])(5)});