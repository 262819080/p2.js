/**
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013 p2.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
(function(t){if("function"==typeof bootstrap)bootstrap("p2",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeP2=t}else"undefined"!=typeof window?window.p2=t():self.p2=t()})(function(){var t;return function(t,n,r){function e(r,o){if(!n[r]){if(!t[r]){var a="function"==typeof require&&require;if(!o&&a)return a(r,!0);if(i)return i(r,!0);throw Error("Cannot find module '"+r+"'")}var s=n[r]={exports:{}};t[r][0].call(s.exports,function(n){var i=t[r][1][n];return e(i?i:n)},s,s.exports)}return n[r].exports}for(var i="function"==typeof require&&require,o=0;r.length>o;o++)e(r[o]);return e}({1:[function(t,n,r){function e(){}function i(t){e.apply(this),this.vertices=t}r.Shape=e,r.Particle=function(){e.apply(this)},r.Circle=function(t){e.apply(this),this.radius=t||1},r.Plane=function(){e.apply(this)},r.Convex=i},{}],2:[function(t,n,r){function e(t,n){this.equations=[],this.bodyA=t,this.bodyB=n}r.Constraint=e,e.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!")}},{}],3:[function(t,n,r){function e(t,n,r,e){this.id=-1,this.minForce=r===void 0?-1e6:r,this.maxForce=e===void 0?1e6:e,this.bi=t,this.bj=n}r.Equation=e,e.prototype.constructor=e},{}],4:[function(t,n,r){var e=function(){};r.EventEmitter=e,e.prototype={constructor:e,on:function(t,n){void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(n)&&r[t].push(n),this},has:function(t,n){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(n)?!0:!1},off:function(t,n){if(void 0!==this._listeners){var r=this._listeners,e=r[t].indexOf(n);-1!==e&&r[t].splice(e,1)}},emit:function(t){if(void 0!==this._listeners){var n=this._listeners,r=n[t.type];if(void 0!==r){t.target=this;for(var e=0,i=r.length;i>e;e++)r[e].call(this,t)}return this}}}},{}],5:[function(t,n,r){function e(){this.equations=[]}r.Solver=e,e.prototype.solve=function(){throw Error("Solver.solve should be implemented by subclasses!")},e.prototype.addEquation=function(t){this.equations.push(t)},e.prototype.removeEquation=function(t){var n=this.equations.indexOf(t);-1!=n&&this.equations.splice(n,1)},e.prototype.removeAllEquations=function(){this.equations=[]}},{}],6:[function(t,n,r){r.Body=t("./objects/Body").Body,r.Broadphase=t("./collision/Broadphase").Broadphase,r.Circle=t("./objects/Shape").Circle,r.Constraint=t("./constraints/Constraint").Constraint,r.ContactEquation=t("./constraints/ContactEquation").ContactEquation,r.DistanceConstraint=t("./constraints/DistanceConstraint").DistanceConstraint,r.Equation=t("./constraints/Equation").Equation,r.EventEmitter=t("./events/EventEmitter").EventEmitter,r.GridBroadphase=t("./collision/GridBroadphase").GridBroadphase,r.GSSolver=t("./solver/GSSolver").GSSolver,r.NaiveBroadphase=t("./collision/NaiveBroadphase").NaiveBroadphase,r.Plane=t("./objects/Shape").Plane,r.IslandSolver=t("./solver/IslandSolver").IslandSolver,r.Island=t("./solver/IslandSolver").Island,r.Shape=t("./objects/Shape").Shape,r.Solver=t("./solver/Solver").Solver,r.Spring=t("./objects/Body").Spring,r.World=t("./world/World").World;var e=t("gl-matrix");r.vec2=e.vec2,r.mat2=e.mat2},{"./objects/Body":7,"./collision/Broadphase":8,"./objects/Shape":1,"./constraints/Constraint":2,"./constraints/ContactEquation":9,"./constraints/DistanceConstraint":10,"./constraints/Equation":3,"./events/EventEmitter":4,"./collision/GridBroadphase":11,"./collision/NaiveBroadphase":12,"./solver/GSSolver":13,"./solver/IslandSolver":14,"./solver/Solver":5,"./world/World":15,"gl-matrix":16}],16:[function(n,r,e){(function(){(function(){"use strict";var n={};e===void 0?"function"==typeof t&&"object"==typeof t.amd&&t.amd?(n.exports={},t(function(){return n.exports})):n.exports=window:n.exports=e,function(t){var n={};if(!r)var r=1e-6;n.create=function(){return new Float32Array(2)},n.clone=function(t){var n=new Float32Array(2);return n[0]=t[0],n[1]=t[1],n},n.fromValues=function(t,n){var r=new Float32Array(2);return r[0]=t,r[1]=n,r},n.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t},n.set=function(t,n,r){return t[0]=n,t[1]=r,t},n.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t},n.sub=n.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t},n.mul=n.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t},n.div=n.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t},n.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t},n.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t},n.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t},n.dist=n.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1];return Math.sqrt(r*r+e*e)},n.sqrDist=n.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1];return r*r+e*e},n.len=n.length=function(t){var n=t[0],r=t[1];return Math.sqrt(n*n+r*r)},n.sqrLen=n.squaredLength=function(t){var n=t[0],r=t[1];return n*n+r*r},n.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t},n.normalize=function(t,n){var r=n[0],e=n[1],i=r*r+e*e;return i>0&&(i=1/Math.sqrt(i),t[0]=n[0]*i,t[1]=n[1]*i),t},n.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]},n.cross=function(t,n,r){var e=n[0]*r[1]-n[1]*r[0];return t[0]=t[1]=0,t[2]=e,t},n.lerp=function(t,n,r,e){var i=n[0],o=n[1];return t[0]=i+e*(r[0]-i),t[1]=o+e*(r[1]-o),t},n.transformMat2=function(t,n,r){var e=n[0],i=n[1];return t[0]=e*r[0]+i*r[1],t[1]=e*r[2]+i*r[3],t},n.forEach=function(){var t=new Float32Array(2);return function(n,r,e,i,o,a){var s,c;for(r||(r=2),e||(e=0),c=i?Math.min(i*r+e,n.length):n.length,s=e;c>s;s+=r)t[0]=n[s],t[1]=n[s+1],o(t,t,a),n[s]=t[0],n[s+1]=t[1];return n}}(),n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},t!==void 0&&(t.vec2=n);var e={};if(!r)var r=1e-6;e.create=function(){return new Float32Array(3)},e.clone=function(t){var n=new Float32Array(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},e.fromValues=function(t,n,r){var e=new Float32Array(3);return e[0]=t,e[1]=n,e[2]=r,e},e.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},e.set=function(t,n,r,e){return t[0]=n,t[1]=r,t[2]=e,t},e.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t},e.sub=e.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t},e.mul=e.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t},e.div=e.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t},e.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t},e.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t},e.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t},e.dist=e.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],i=n[2]-t[2];return Math.sqrt(r*r+e*e+i*i)},e.sqrDist=e.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],i=n[2]-t[2];return r*r+e*e+i*i},e.len=e.length=function(t){var n=t[0],r=t[1],e=t[2];return Math.sqrt(n*n+r*r+e*e)},e.sqrLen=e.squaredLength=function(t){var n=t[0],r=t[1],e=t[2];return n*n+r*r+e*e},e.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},e.normalize=function(t,n){var r=n[0],e=n[1],i=n[2],o=r*r+e*e+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o),t},e.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},e.cross=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=r[0],s=r[1],c=r[2];return t[0]=i*c-o*s,t[1]=o*a-e*c,t[2]=e*s-i*a,t},e.lerp=function(t,n,r,e){var i=n[0],o=n[1],a=n[2];return t[0]=i+e*(r[0]-i),t[1]=o+e*(r[1]-o),t[2]=a+e*(r[2]-a),t},e.transformMat4=function(t,n,r){var e=n[0],i=n[1],o=n[2];return t[0]=r[0]*e+r[4]*i+r[8]*o+r[12],t[1]=r[1]*e+r[5]*i+r[9]*o+r[13],t[2]=r[2]*e+r[6]*i+r[10]*o+r[14],t},e.transformQuat=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=r[0],s=r[1],c=r[2],u=r[3],l=u*e+s*o-c*i,h=u*i+c*e-a*o,f=u*o+a*i-s*e,v=-a*e-s*i-c*o;return t[0]=l*u+v*-a+h*-c-f*-s,t[1]=h*u+v*-s+f*-a-l*-c,t[2]=f*u+v*-c+l*-s-h*-a,t},e.forEach=function(){var t=new Float32Array(3);return function(n,r,e,i,o,a){var s,c;for(r||(r=3),e||(e=0),c=i?Math.min(i*r+e,n.length):n.length,s=e;c>s;s+=r)t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],o(t,t,a),n[s]=t[0],n[s+1]=t[1],n[s+2]=t[2];return n}}(),e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t!==void 0&&(t.vec3=e);var i={};if(!r)var r=1e-6;i.create=function(){return new Float32Array(4)},i.clone=function(t){var n=new Float32Array(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},i.fromValues=function(t,n,r,e){var i=new Float32Array(4);return i[0]=t,i[1]=n,i[2]=r,i[3]=e,i},i.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},i.set=function(t,n,r,e,i){return t[0]=n,t[1]=r,t[2]=e,t[3]=i,t},i.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t[3]=n[3]+r[3],t},i.sub=i.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t[3]=n[3]-r[3],t},i.mul=i.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t[3]=n[3]*r[3],t},i.div=i.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t[3]=n[3]/r[3],t},i.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t[3]=Math.min(n[3],r[3]),t},i.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t[3]=Math.max(n[3],r[3]),t},i.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t},i.dist=i.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],i=n[2]-t[2],o=n[3]-t[3];return Math.sqrt(r*r+e*e+i*i+o*o)},i.sqrDist=i.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],i=n[2]-t[2],o=n[3]-t[3];return r*r+e*e+i*i+o*o},i.len=i.length=function(t){var n=t[0],r=t[1],e=t[2],i=t[3];return Math.sqrt(n*n+r*r+e*e+i*i)},i.sqrLen=i.squaredLength=function(t){var n=t[0],r=t[1],e=t[2],i=t[3];return n*n+r*r+e*e+i*i},i.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},i.normalize=function(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=r*r+e*e+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a),t},i.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},i.lerp=function(t,n,r,e){var i=n[0],o=n[1],a=n[2],s=n[3];return t[0]=i+e*(r[0]-i),t[1]=o+e*(r[1]-o),t[2]=a+e*(r[2]-a),t[3]=s+e*(r[3]-s),t},i.transformMat4=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3];return t[0]=r[0]*e+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*e+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*e+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*e+r[7]*i+r[11]*o+r[15]*a,t},i.transformQuat=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=r[0],s=r[1],c=r[2],u=r[3],l=u*e+s*o-c*i,h=u*i+c*e-a*o,f=u*o+a*i-s*e,v=-a*e-s*i-c*o;return t[0]=l*u+v*-a+h*-c-f*-s,t[1]=h*u+v*-s+f*-a-l*-c,t[2]=f*u+v*-c+l*-s-h*-a,t},i.forEach=function(){var t=new Float32Array(4);return function(n,r,e,i,o,a){var s,c;for(r||(r=4),e||(e=0),c=i?Math.min(i*r+e,n.length):n.length,s=e;c>s;s+=r)t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],t[3]=n[s+3],o(t,t,a),n[s]=t[0],n[s+1]=t[1],n[s+2]=t[2],n[s+3]=t[3];return n}}(),i.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.vec4=i);var o={},a=new Float32Array([1,0,0,1]);if(!r)var r=1e-6;o.create=function(){return new Float32Array(a)},o.clone=function(t){var n=new Float32Array(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},o.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},o.transpose=function(t,n){if(t===n){var r=n[1];t[1]=n[2],t[2]=r}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t},o.invert=function(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=r*o-i*e;return a?(a=1/a,t[0]=o*a,t[1]=-e*a,t[2]=-i*a,t[3]=r*a,t):null},o.adjoint=function(t,n){var r=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=r,t},o.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},o.mul=o.multiply=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],s=r[0],c=r[1],u=r[2],l=r[3];return t[0]=e*s+i*u,t[1]=e*c+i*l,t[2]=o*s+a*u,t[3]=o*c+a*l,t},o.rotate=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],s=Math.sin(r),c=Math.cos(r);return t[0]=e*c+i*s,t[1]=e*-s+i*c,t[2]=o*c+a*s,t[3]=o*-s+a*c,t},o.scale=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],s=r[0],c=r[1];return t[0]=e*s,t[1]=i*c,t[2]=o*s,t[3]=a*c,t},o.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.mat2=o);var s={},c=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!r)var r=1e-6;s.create=function(){return new Float32Array(c)},s.clone=function(t){var n=new Float32Array(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},s.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.transpose=function(t,n){if(t===n){var r=n[1],e=n[2],i=n[5];t[1]=n[3],t[2]=n[6],t[3]=r,t[5]=n[7],t[6]=e,t[7]=i}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},s.invert=function(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],s=n[5],c=n[6],u=n[7],l=n[8],h=l*a-s*u,f=-l*o+s*c,v=u*o-a*c,p=r*h+e*f+i*v;return p?(p=1/p,t[0]=h*p,t[1]=(-l*e+i*u)*p,t[2]=(s*e-i*a)*p,t[3]=f*p,t[4]=(l*r-i*c)*p,t[5]=(-s*r+i*o)*p,t[6]=v*p,t[7]=(-u*r+e*c)*p,t[8]=(a*r-e*o)*p,t):null},s.adjoint=function(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],s=n[5],c=n[6],u=n[7],l=n[8];return t[0]=a*l-s*u,t[1]=i*u-e*l,t[2]=e*s-i*a,t[3]=s*c-o*l,t[4]=r*l-i*c,t[5]=i*o-r*s,t[6]=o*u-a*c,t[7]=e*c-r*u,t[8]=r*a-e*o,t},s.determinant=function(t){var n=t[0],r=t[1],e=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8];return n*(u*o-a*c)+r*(-u*i+a*s)+e*(c*i-o*s)},s.mul=s.multiply=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=n[5],u=n[6],l=n[7],h=n[8],f=r[0],v=r[1],p=r[2],d=r[3],m=r[4],y=r[5],g=r[6],b=r[7],C=r[8];return t[0]=f*e+v*a+p*u,t[1]=f*i+v*s+p*l,t[2]=f*o+v*c+p*h,t[3]=d*e+m*a+y*u,t[4]=d*i+m*s+y*l,t[5]=d*o+m*c+y*h,t[6]=g*e+b*a+C*u,t[7]=g*i+b*s+C*l,t[8]=g*o+b*c+C*h,t},s.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t!==void 0&&(t.mat3=s);var u={},l=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!r)var r=1e-6;u.create=function(){return new Float32Array(l)},u.clone=function(t){var n=new Float32Array(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},u.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.transpose=function(t,n){if(t===n){var r=n[1],e=n[2],i=n[3],o=n[6],a=n[7],s=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=r,t[6]=n[9],t[7]=n[13],t[8]=e,t[9]=o,t[11]=n[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},u.invert=function(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],s=n[5],c=n[6],u=n[7],l=n[8],h=n[9],f=n[10],v=n[11],p=n[12],d=n[13],m=n[14],y=n[15],g=r*s-e*a,b=r*c-i*a,C=r*u-o*a,M=e*c-i*s,q=e*u-o*s,x=i*u-o*c,S=l*d-h*p,w=l*m-f*p,B=l*y-v*p,E=h*m-f*d,j=h*y-v*d,P=f*y-v*m,A=g*P-b*j+C*E+M*B-q*w+x*S;return A?(A=1/A,t[0]=(s*P-c*j+u*E)*A,t[1]=(i*j-e*P-o*E)*A,t[2]=(d*x-m*q+y*M)*A,t[3]=(f*q-h*x-v*M)*A,t[4]=(c*B-a*P-u*w)*A,t[5]=(r*P-i*B+o*w)*A,t[6]=(m*C-p*x-y*b)*A,t[7]=(l*x-f*C+v*b)*A,t[8]=(a*j-s*B+u*S)*A,t[9]=(e*B-r*j-o*S)*A,t[10]=(p*q-d*C+y*g)*A,t[11]=(h*C-l*q-v*g)*A,t[12]=(s*w-a*E-c*S)*A,t[13]=(r*E-e*w+i*S)*A,t[14]=(d*b-p*M-m*g)*A,t[15]=(l*M-h*b+f*g)*A,t):null},u.adjoint=function(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],s=n[5],c=n[6],u=n[7],l=n[8],h=n[9],f=n[10],v=n[11],p=n[12],d=n[13],m=n[14],y=n[15];return t[0]=s*(f*y-v*m)-h*(c*y-u*m)+d*(c*v-u*f),t[1]=-(e*(f*y-v*m)-h*(i*y-o*m)+d*(i*v-o*f)),t[2]=e*(c*y-u*m)-s*(i*y-o*m)+d*(i*u-o*c),t[3]=-(e*(c*v-u*f)-s*(i*v-o*f)+h*(i*u-o*c)),t[4]=-(a*(f*y-v*m)-l*(c*y-u*m)+p*(c*v-u*f)),t[5]=r*(f*y-v*m)-l*(i*y-o*m)+p*(i*v-o*f),t[6]=-(r*(c*y-u*m)-a*(i*y-o*m)+p*(i*u-o*c)),t[7]=r*(c*v-u*f)-a*(i*v-o*f)+l*(i*u-o*c),t[8]=a*(h*y-v*d)-l*(s*y-u*d)+p*(s*v-u*h),t[9]=-(r*(h*y-v*d)-l*(e*y-o*d)+p*(e*v-o*h)),t[10]=r*(s*y-u*d)-a*(e*y-o*d)+p*(e*u-o*s),t[11]=-(r*(s*v-u*h)-a*(e*v-o*h)+l*(e*u-o*s)),t[12]=-(a*(h*m-f*d)-l*(s*m-c*d)+p*(s*f-c*h)),t[13]=r*(h*m-f*d)-l*(e*m-i*d)+p*(e*f-i*h),t[14]=-(r*(s*m-c*d)-a*(e*m-i*d)+p*(e*c-i*s)),t[15]=r*(s*f-c*h)-a*(e*f-i*h)+l*(e*c-i*s),t},u.determinant=function(t){var n=t[0],r=t[1],e=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8],l=t[9],h=t[10],f=t[11],v=t[12],p=t[13],d=t[14],m=t[15],y=n*a-r*o,g=n*s-e*o,b=n*c-i*o,C=r*s-e*a,M=r*c-i*a,q=e*c-i*s,x=u*p-l*v,S=u*d-h*v,w=u*m-f*v,B=l*d-h*p,E=l*m-f*p,j=h*m-f*d;return y*j-g*E+b*B+C*w-M*S+q*x},u.mul=u.multiply=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=n[5],u=n[6],l=n[7],h=n[8],f=n[9],v=n[10],p=n[11],d=n[12],m=n[13],y=n[14],g=n[15],b=r[0],C=r[1],M=r[2],q=r[3];return t[0]=b*e+C*s+M*h+q*d,t[1]=b*i+C*c+M*f+q*m,t[2]=b*o+C*u+M*v+q*y,t[3]=b*a+C*l+M*p+q*g,b=r[4],C=r[5],M=r[6],q=r[7],t[4]=b*e+C*s+M*h+q*d,t[5]=b*i+C*c+M*f+q*m,t[6]=b*o+C*u+M*v+q*y,t[7]=b*a+C*l+M*p+q*g,b=r[8],C=r[9],M=r[10],q=r[11],t[8]=b*e+C*s+M*h+q*d,t[9]=b*i+C*c+M*f+q*m,t[10]=b*o+C*u+M*v+q*y,t[11]=b*a+C*l+M*p+q*g,b=r[12],C=r[13],M=r[14],q=r[15],t[12]=b*e+C*s+M*h+q*d,t[13]=b*i+C*c+M*f+q*m,t[14]=b*o+C*u+M*v+q*y,t[15]=b*a+C*l+M*p+q*g,t},u.translate=function(t,n,r){var e,i,o,a,s,c,u,l,h,f,v,p,d=r[0],m=r[1],y=r[2];return n===t?(t[12]=n[0]*d+n[4]*m+n[8]*y+n[12],t[13]=n[1]*d+n[5]*m+n[9]*y+n[13],t[14]=n[2]*d+n[6]*m+n[10]*y+n[14],t[15]=n[3]*d+n[7]*m+n[11]*y+n[15]):(e=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=n[5],u=n[6],l=n[7],h=n[8],f=n[9],v=n[10],p=n[11],t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=c,t[6]=u,t[7]=l,t[8]=h,t[9]=f,t[10]=v,t[11]=p,t[12]=e*d+s*m+h*y+n[12],t[13]=i*d+c*m+f*y+n[13],t[14]=o*d+u*m+v*y+n[14],t[15]=a*d+l*m+p*y+n[15]),t},u.scale=function(t,n,r){var e=r[0],i=r[1],o=r[2];return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=n[11]*o,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},u.rotate=function(t,n,e,i){var o,a,s,c,u,l,h,f,v,p,d,m,y,g,b,C,M,q,x,S,w,B,E,j,P=i[0],A=i[1],F=i[2],I=Math.sqrt(P*P+A*A+F*F);return r>Math.abs(I)?null:(I=1/I,P*=I,A*=I,F*=I,o=Math.sin(e),a=Math.cos(e),s=1-a,c=n[0],u=n[1],l=n[2],h=n[3],f=n[4],v=n[5],p=n[6],d=n[7],m=n[8],y=n[9],g=n[10],b=n[11],C=P*P*s+a,M=A*P*s+F*o,q=F*P*s-A*o,x=P*A*s-F*o,S=A*A*s+a,w=F*A*s+P*o,B=P*F*s+A*o,E=A*F*s-P*o,j=F*F*s+a,t[0]=c*C+f*M+m*q,t[1]=u*C+v*M+y*q,t[2]=l*C+p*M+g*q,t[3]=h*C+d*M+b*q,t[4]=c*x+f*S+m*w,t[5]=u*x+v*S+y*w,t[6]=l*x+p*S+g*w,t[7]=h*x+d*S+b*w,t[8]=c*B+f*E+m*j,t[9]=u*B+v*E+y*j,t[10]=l*B+p*E+g*j,t[11]=h*B+d*E+b*j,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)},u.rotateX=function(t,n,r){var e=Math.sin(r),i=Math.cos(r),o=n[4],a=n[5],s=n[6],c=n[7],u=n[8],l=n[9],h=n[10],f=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=o*i+u*e,t[5]=a*i+l*e,t[6]=s*i+h*e,t[7]=c*i+f*e,t[8]=u*i-o*e,t[9]=l*i-a*e,t[10]=h*i-s*e,t[11]=f*i-c*e,t},u.rotateY=function(t,n,r){var e=Math.sin(r),i=Math.cos(r),o=n[0],a=n[1],s=n[2],c=n[3],u=n[8],l=n[9],h=n[10],f=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i-u*e,t[1]=a*i-l*e,t[2]=s*i-h*e,t[3]=c*i-f*e,t[8]=o*e+u*i,t[9]=a*e+l*i,t[10]=s*e+h*i,t[11]=c*e+f*i,t},u.rotateZ=function(t,n,r){var e=Math.sin(r),i=Math.cos(r),o=n[0],a=n[1],s=n[2],c=n[3],u=n[4],l=n[5],h=n[6],f=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i+u*e,t[1]=a*i+l*e,t[2]=s*i+h*e,t[3]=c*i+f*e,t[4]=u*i-o*e,t[5]=l*i-a*e,t[6]=h*i-s*e,t[7]=f*i-c*e,t},u.fromRotationTranslation=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],s=e+e,c=i+i,u=o+o,l=e*s,h=e*c,f=e*u,v=i*c,p=i*u,d=o*u,m=a*s,y=a*c,g=a*u;return t[0]=1-(v+d),t[1]=h+g,t[2]=f-y,t[3]=0,t[4]=h-g,t[5]=1-(l+d),t[6]=p+m,t[7]=0,t[8]=f+y,t[9]=p-m,t[10]=1-(l+v),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},u.frustum=function(t,n,r,e,i,o,a){var s=1/(r-n),c=1/(i-e),u=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*c,t[6]=0,t[7]=0,t[8]=(r+n)*s,t[9]=(i+e)*c,t[10]=(a+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*o*u,t[15]=0,t},u.perspective=function(t,n,r,e,i){var o=1/Math.tan(n/2),a=1/(e-i);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+e)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*e*a,t[15]=0,t},u.ortho=function(t,n,r,e,i,o,a){var s=1/(n-r),c=1/(e-i),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(n+r)*s,t[13]=(i+e)*c,t[14]=(a+o)*u,t[15]=1,t},u.lookAt=function(t,n,e,i){var o,a,s,c,l,h,f,v,p,d,m=n[0],y=n[1],g=n[2],b=i[0],C=i[1],M=i[2],q=e[0],x=e[1],S=e[2];return r>Math.abs(m-q)&&r>Math.abs(y-x)&&r>Math.abs(g-S)?u.identity(t):(f=m-q,v=y-x,p=g-S,d=1/Math.sqrt(f*f+v*v+p*p),f*=d,v*=d,p*=d,o=C*p-M*v,a=M*f-b*p,s=b*v-C*f,d=Math.sqrt(o*o+a*a+s*s),d?(d=1/d,o*=d,a*=d,s*=d):(o=0,a=0,s=0),c=v*s-p*a,l=p*o-f*s,h=f*a-v*o,d=Math.sqrt(c*c+l*l+h*h),d?(d=1/d,c*=d,l*=d,h*=d):(c=0,l=0,h=0),t[0]=o,t[1]=c,t[2]=f,t[3]=0,t[4]=a,t[5]=l,t[6]=v,t[7]=0,t[8]=s,t[9]=h,t[10]=p,t[11]=0,t[12]=-(o*m+a*y+s*g),t[13]=-(c*m+l*y+h*g),t[14]=-(f*m+v*y+p*g),t[15]=1,t)},u.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t!==void 0&&(t.mat4=u);var h={},f=new Float32Array([0,0,0,1]);if(!r)var r=1e-6;h.create=function(){return new Float32Array(f)},h.clone=i.clone,h.fromValues=i.fromValues,h.copy=i.copy,h.set=i.set,h.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.setAxisAngle=function(t,n,r){r=.5*r;var e=Math.sin(r);return t[0]=e*n[0],t[1]=e*n[1],t[2]=e*n[2],t[3]=Math.cos(r),t},h.add=i.add,h.mul=h.multiply=function(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],s=r[0],c=r[1],u=r[2],l=r[3];return t[0]=e*l+a*s+i*u-o*c,t[1]=i*l+a*c+o*s-e*u,t[2]=o*l+a*u+e*c-i*s,t[3]=a*l-e*s-i*c-o*u,t},h.scale=i.scale,h.rotateX=function(t,n,r){r*=.5;var e=n[0],i=n[1],o=n[2],a=n[3],s=Math.sin(r),c=Math.cos(r);return t[0]=e*c+a*s,t[1]=i*c+o*s,t[2]=o*c-i*s,t[3]=a*c-e*s,t},h.rotateY=function(t,n,r){r*=.5;var e=n[0],i=n[1],o=n[2],a=n[3],s=Math.sin(r),c=Math.cos(r);return t[0]=e*c-o*s,t[1]=i*c+a*s,t[2]=o*c+e*s,t[3]=a*c-i*s,t},h.rotateZ=function(t,n,r){r*=.5;var e=n[0],i=n[1],o=n[2],a=n[3],s=Math.sin(r),c=Math.cos(r);return t[0]=e*c+i*s,t[1]=i*c-e*s,t[2]=o*c+a*s,t[3]=a*c-o*s,t},h.calculateW=function(t,n){var r=n[0],e=n[1],i=n[2];return t[0]=r,t[1]=e,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-r*r-e*e-i*i)),t},h.dot=i.dot,h.lerp=i.lerp,h.slerp=function(t,n,r,e){var i,o,a,s,c=n[0],u=n[1],l=n[2],h=n[3],f=r[0],v=r[1],p=r[2],d=n[3],m=c*f+u*v+l*p+h*d;return Math.abs(m)>=1?(t!==n&&(t[0]=c,t[1]=u,t[2]=l,t[3]=h),t):(i=Math.acos(m),o=Math.sqrt(1-m*m),.001>Math.abs(o)?(t[0]=.5*c+.5*f,t[1]=.5*u+.5*v,t[2]=.5*l+.5*p,t[3]=.5*h+.5*d,t):(a=Math.sin((1-e)*i)/o,s=Math.sin(e*i)/o,t[0]=c*a+f*s,t[1]=u*a+v*s,t[2]=l*a+p*s,t[3]=h*a+d*s,t))},h.invert=function(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=r*r+e*e+i*i+o*o,s=a?1/a:0;return t[0]=-r*s,t[1]=-e*s,t[2]=-i*s,t[3]=o*s,t},h.conjugate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t},h.len=h.length=i.length,h.sqrLen=h.squaredLength=i.squaredLength,h.normalize=i.normalize,h.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.quat=h)}(n.exports)})()})()},{}],17:[function(t,n,r){r.vec2={getX:function(t){return t[0]},getY:function(t){return t[1]},crossLength:function(t,n){return t[0]*n[1]-t[1]*n[0]},rotate:function(t,n,r){var e=Math.cos(r),i=Math.sin(r);t[0]=e*n[0]-i*n[1],t[1]=i*n[0]+e*n[1]}}},{}],8:[function(t,n,r){function e(t,n,r){var e,i,o=null,a=null;c.rotate(m,n,t.angle);for(var s=u.dot(t.position,n),l=1;t.shape.vertices.length>l;l++)e=t.shape.vertices[l],i=u.dot(e,m),(null===o||i>o)&&(o=i),(null===a||a>i)&&(a=i);u.set(r,a+s,o+s)}function i(t,n,r){for(var i=null,o=!1,a=0;2>a;a++)for(var s=0==a?t:n,l=1;t.shape.vertices.length>l;l++){u.subtract(y,s.shape.vertices[l],s.shape.vertices[l-1]),c.rotate(g,y,-Math.PI/2),u.normalize(g,g),e(t,g,b),e(n,g,C);var h=b,f=C;b[0]>C[0]&&(f=b,h=C);var v=f[1]-h[0];(null===i||v>i)&&(u.copy(r,g),i=v,o=v>0)}return o}function o(t,n){c.rotate(m,n,t.angle);for(var r=-1,e=1;t.shape.vertices.length>e;e++){u.subtract(y,t.shape.vertices[e],t.shape.vertices[e-1]),c.rotate(g,y,-Math.PI/2),u.normalize(g,g);var i=u.dot(g,n);(-1==r||i>maxDot)&&(r=e-1,maxDot=i)}return r}var a=t("gl-matrix"),s=t("../gl-matrix-extensions"),c=s.vec2,u=a.vec2,l=a.mat2,h=u.create();l.create();var f=u.create(),v=u.fromValues(0,1);r.checkCircleCircle=function(t,n,r){u.sub(h,t.position,n.position);var e=t.shape.radius,i=n.shape.radius;(e+i)*(e+i)>u.sqrLen(h)&&(r.push(t),r.push(n))},r.checkCirclePlane=function(t,n,r){u.sub(h,t.position,n.position),c.rotate(f,v,n.angle),u.dot(h,f)<=t.shape.radius&&(r.push(t),r.push(n))},r.checkCircleParticle=function(t,n,r){r.push(t),r.push(n)},r.nearphaseCircleCircle=function(t,n,r,e){var i=e.length?e.pop():new p2.ContactEquation(t,n);i.bi=t,i.bj=n,u.sub(i.ni,n.position,t.position),u.normalize(i.ni,i.ni),u.scale(i.ri,i.ni,t.shape.radius),u.scale(i.rj,i.ni,-n.shape.radius),r.push(i)},r.nearphaseCircleParticle=function(){};var p=(l.create(),u.create()),d=u.create();r.nearphaseCirclePlane=function(t,n,r,e){var i=e.length?e.pop():new p2.ContactEquation(n,t);i.bi=n,i.bj=t;var o=p,a=d;c.rotate(i.ni,v,n.angle),u.scale(i.rj,i.ni,-t.shape.radius),u.sub(o,t.position,n.position);var s=u.dot(i.ni,o);u.scale(a,i.ni,s),u.sub(i.ri,o,a),r.push(i)};var m=u.create();r.projectConvexOntoAxis=e;var y=u.create(),g=u.create(),b=u.create(),C=u.create();r.findSeparatingAxis=i,r.nearphaseConvexConvex=function(t,n,r){var e=o(t,r),i=o(n,r);return-1==e||-1==i?!1:(u.create(),u.create(),u.create(),u.create(),u.create(),u.create(),void 0)},r.Broadphase=function(){},r.Broadphase.prototype.getCollisionPairs=function(){throw Error("getCollisionPairs must be implemented in a subclass!")}},{"../gl-matrix-extensions":17,"gl-matrix":16}],7:[function(t,n,r){function e(t,n,r){r=r||{},this.restLength=r.restLength||1,this.stiffness=r.stiffness||100,this.damping=r.damping||1,this.bodyA=t,this.bodyB=n}function i(t){t=t||{},this.id=++i._idCounter,this.shape=t.shape,this.mass=t.mass||0,this.invMass=this.mass>0?1/this.mass:0,this.inertia=t.inertia||this.mass,this.invInertia=this.invMass,this.position=a.create(),t.position&&a.copy(this.position,t.position),this.velocity=a.create(),t.velocity&&a.copy(this.velocity,t.velocity),this.vlambda=a.create(),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=a.create(),t.force&&a.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.motionState=0==this.mass?i.STATIC:i.DYNAMIC}var o=t("gl-matrix"),a=o.vec2;r.Body=i,r.Spring=e,i._idCounter=0;var s=a.create();i.prototype.applyForce=function(t,n){var r=s;a.sub(r,n,this.position),a.add(this.force,this.force,t);var e=a.crossLength(r,t);this.angularForce+=e},i.DYNAMIC=1,i.STATIC=2,i.KINEMATIC=4},{"gl-matrix":16}],11:[function(t,n,r){var e=t("../objects/Shape").Circle,i=t("../objects/Shape").Plane,o=t("../objects/Shape").Particle,a=t("../collision/Broadphase"),s=a.Broadphase,c=t("gl-matrix");c.vec2,r.GridBroadphase=function(t,n,r,c,u,l){s.apply(this),u=u||10,l=l||10;var h=(n-t)/u,f=(c-r)/l;this.getCollisionPairs=function(s){for(var v=[],p=s.collidingBodies,d=d=p.length,m=[],y=u*l,g=0;y>g;g++)m.push([]);for(var b=u/(n-t),C=l/(c-r),g=0;g!==d;g++){var M=p[g],q=M.shape;if(void 0!==q)if(q instanceof e)for(var x=M.position[0],S=M.position[1],w=q.radius,B=Math.floor(b*(x-w-t)),E=Math.floor(C*(S-w-r)),j=Math.floor(b*(x+w-t)),P=Math.floor(C*(S+w-r)),A=B;j>=A;A++)for(var F=E;P>=F;F++){var I=A,k=F;I*(l-1)+k>=0&&y>I*(l-1)+k&&m[I*(l-1)+k].push(M)}else{if(!(q instanceof i))throw Error("Shape not supported in GridBroadphase!");if(0==M.angle)for(var S=M.position[1],A=0;A!==y&&S>r+f*(A-1);A++)for(var F=0;u>F;F++){var I=F,k=Math.floor(C*(f*A-r));m[I*(l-1)+k].push(M)}else if(M.angle==.5*Math.PI)for(var x=M.position[0],A=0;A!==y&&x>t+h*(A-1);A++)for(var F=0;l>F;F++){var k=F,I=Math.floor(b*(h*A-t));m[I*(l-1)+k].push(M)}else for(var A=0;A!==y;A++)m[A].push(M)}}for(var g=0;g!==y;g++)for(var V=m[g],A=0,_=V.length;A!==_;A++)for(var M=V[A],q=M.shape,F=0;F!==A;F++){var G=V[F],O=G.shape;q instanceof e?O instanceof e?a.checkCircleCircle(M,G,v):O instanceof o?a.checkCircleParticle(M,G,v):O instanceof i&&a.checkCirclePlane(M,G,v):q instanceof o?O instanceof e&&a.checkCircleParticle(G,M,v):q instanceof i&&O instanceof e&&a.checkCirclePlane(G,M,v)}return v}},r.GridBroadphase.prototype=new s},{"../objects/Shape":1,"../collision/Broadphase":8,"gl-matrix":16}],9:[function(t,n,r){function e(t,n){i.call(this,t,n,0,1e6),this.penetration=0,this.ri=a.create(),this.penetrationVec=a.create(),this.rj=a.create(),this.ni=a.create(),this.rixn=a.create(),this.rjxn=a.create(),this.rixw=a.create(),this.rjxw=a.create(),this.relVel=a.create(),this.relForce=a.create()}var i=t("./Equation").Equation,o=t("gl-matrix"),a=o.vec2,s=t("../gl-matrix-extensions"),c=s.vec2;r.ContactEquation=e,e.prototype=new i,e.prototype.constructor=e,e.prototype.computeB=function(t,n,r){var e=this.bi,i=this.bj,o=this.ri,s=this.rj,u=e.position,l=i.position,h=e.velocity,f=e.angularVelocity,v=e.force,p=e.angularForce,d=i.velocity,m=i.angularVelocity,y=i.force,g=i.angularForce,b=(this.relVel,this.relForce,this.penetrationVec),C=e.invMass,M=i.invMass,q=e.invInertia,x=i.invInertia,S=this.ni,w=this.rixn=c.crossLength(o,S),B=this.rjxn=c.crossLength(s,S);a.set(b,0,0),a.add(b,l,s),a.sub(b,b,u),a.sub(b,b,o);var E=a.dot(S,b),j=a.dot(d,S)-a.dot(h,S)+m*B-f*w,P=a.dot(y,S)*M-a.dot(v,S)*C+x*g*B-q*p*w,A=-E*t-j*n-r*P;return A},e.prototype.computeC=function(t){var n=this.bi,r=this.bj,e=this.rixn,i=this.rjxn,o=n.invMass,a=r.invMass,s=o+a+t,c=n.invInertia,u=r.invInertia;return s+=c*e*e,s+=u*i*i};var u=a.create();e.prototype.computeGWlambda=function(){var t=this.bi,n=this.bj,r=u,e=0;return a.sub(r,n.vlambda,t.vlambda),e+=a.dot(r,this.ni),e-=t.wlambda*this.rixn,e+=n.wlambda*this.rjxn};var l=a.create();e.prototype.addToWlambda=function(t){var n=this.bi,r=this.bj,e=this.rixn,i=this.rjxn,o=n.invMass,s=r.invMass,c=this.ni,u=l;a.scale(u,c,o*t),a.sub(n.vlambda,n.vlambda,u),a.scale(u,c,s*t),a.add(r.vlambda,r.vlambda,u),n.wlambda-=n.invInertia*e*t,r.wlambda+=r.invInertia*i*t}},{"./Equation":3,"../gl-matrix-extensions":17,"gl-matrix":16}],10:[function(t,n,r){function e(t,n,r,e){i.call(this,t,n),e===void 0&&(e=1e6);var s=this.equations=[new o(t,n)],c=s[0];c.minForce=-e,c.maxForce=e,this.update=function(){a.subtract(c.ni,n.position,t.position),a.normalize(c.ni,c.ni),a.scale(c.ri,c.ni,.5*r),a.scale(c.rj,c.ni,.5*-r)}}var i=t("./Constraint").Constraint,o=t("./ContactEquation").ContactEquation,a=t("gl-matrix").vec2;r.DistanceConstraint=e,e.prototype=Object(i.prototype)},{"./Constraint":2,"./ContactEquation":9,"gl-matrix":16}],12:[function(t,n,r){var e=t("../objects/Shape").Circle,i=t("../objects/Shape").Plane,o=t("../objects/Shape").Particle,a=t("../collision/Broadphase"),s=a.Broadphase,c=t("gl-matrix");c.vec2,r.NaiveBroadphase=function(){s.apply(this),this.getCollisionPairs=function(t){for(var n=t.collidingBodies,r=[],s=0,c=n.length;s!==c;s++){var u=n[s],l=u.shape;if(void 0!==l)for(var h=0;h!==s;h++){var f=n[h],v=f.shape;void 0!==v&&(l instanceof e?v instanceof e?a.checkCircleCircle(u,f,r):v instanceof o?a.checkCircleParticle(u,f,r):v instanceof i&&a.checkCirclePlane(u,f,r):l instanceof o?v instanceof e&&a.checkCircleParticle(f,u,r):l instanceof i&&v instanceof e&&a.checkCirclePlane(f,u,r))
}}return r}},r.NaiveBroadphase.prototype=new s},{"../objects/Shape":1,"../collision/Broadphase":8,"gl-matrix":16}],13:[function(t,n,r){function e(t){a.call(this),t=t||{},this.iterations=t.iterations||10,this.h=t.timeStep||1/60,this.k=t.stiffness||1e7,this.d=t.relaxation||6,this.a=0,this.b=0,this.eps=0,this.tolerance=t.tolerance||0,this.setSpookParams(this.k,this.d),this.debug=t.debug||!1,this.arrayStep=30,this.lambda=new s(this.arrayStep),this.Bs=new s(this.arrayStep),this.invCs=new s(this.arrayStep)}var i=t("gl-matrix"),o=i.vec2,a=t("./Solver").Solver;r.GSSolver=e;var s=Float32Array||Array;e.prototype=new a,e.prototype.setSpookParams=function(t,n){var r=this.h;this.k=t,this.d=n,this.a=4/(r*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(r*r*t*(1+4*n))},e.prototype.solve=function(t,n){var r=(this.d,this.k,0),e=this.iterations,i=this.tolerance*this.tolerance,a=this.a,c=this.b,u=this.eps,l=this.equations,h=l.length,f=n.bodies,v=n.bodies.length,p=t;h>this.lambda.length&&(this.lambda=new s(h+this.arrayStep),this.Bs=new s(h+this.arrayStep),this.invCs=new s(h+this.arrayStep));for(var d=this.invCs,m=this.Bs,y=this.lambda,g=0;g!==h;g++){var b=l[g];y[g]=0,m[g]=b.computeB(a,c,p),d[g]=1/b.computeC(u)}var C,b,M,q,x,S,w;if(0!==h){var g,B,E,j,P;for(g=0;g!==v;g++){var c=f[g],A=c.vlambda;o.set(A,0,0),c.wlambda=0}for(r=0;r!==e;r++){for(x=0,B=0;B!==h;B++)b=l[B],j=b.maxForce,E=b.minForce,C=m[B],M=d[B],w=y[B],S=b.computeGWlambda(u),q=M*(C-S-u*w),P=w+q,E>P?q=E-w:P>j&&(q=j-w),y[B]+=q,x+=Math.abs(q),b.addToWlambda(q);if(i>=x*x)break}for(g=0;g!==v;g++){var c=f[g],F=c.velocity;o.add(F,F,c.vlambda),c.angularVelocity+=c.wlambda}}errorTot=x}},{"./Solver":5,"gl-matrix":16}],14:[function(t,n,r){function e(t){s.call(this),this.subsolver=t,this.numIslands=0,this._nodePool=[]}function i(t){for(var n=t.length,r=0;r!==n;r++){var e=t[r];if(!(e.visited||e.body.motionState&u))return e}return!1}function o(t,n){var r=[];for(r.push(t),t.visited=!0,n(t);r.length;)for(var e,o=r.pop();e=i(o.children);)e.visited=!0,n(e),r.push(e)}function a(){this.equations=[],this.bodies=[]}var s=t("./Solver").Solver,c=(t("../constraints/ContactEquation").ContactEquation,t("gl-matrix").vec2,t("../objects/Body").Body),u=c.STATIC;r.IslandSolver=e,r.Island=a,e.prototype=Object(s.prototype),e.prototype.solve=function(t,n){function r(t){M.push(t.body);for(var n=t.eqs.length,r=0;r!==n;r++){var e=t.eqs[r];-1===C.indexOf(e)&&C.push(e)}}var e=[],s=n.bodies,c=this.equations,u=c.length,l=s.length;this.subsolver,this._workers,this._workerData,this._workerIslandGroups;for(var h=0;h!==l;h++)this._nodePool.length?e.push(this._nodePool.pop()):e.push({body:s[h],children:[],eqs:[],visited:!1});for(var h=0;h!==l;h++){var f=e[h];f.body=s[h],f.children.length=0,f.eqs.length=0,f.visited=!1}for(var v=0;v!==u;v++){var p=c[v],h=s.indexOf(p.bi),d=s.indexOf(p.bj),m=e[h],y=e[d];m.children.push(y),m.eqs.push(p),y.children.push(m),y.eqs.push(p)}for(var g,b=0,C=[],M=[],q=[];g=i(e);){var x=new a;C.length=0,M.length=0,o(g,r);for(var S=C.length,h=0;h!==S;h++){var p=C[h];x.equations.push(p)}b++,q.push(x)}this.numIslands=b;for(var h=0;q.length>h;h++)q[h].solve(t,this.subsolver)},a.prototype.reset=function(){this.equations.length=this.bodies.length=0},a.prototype.getBodies=function(){for(var t=[],n=[],r=this.equations,e=0;e!==r.length;e++){var i=r[e];-1===n.indexOf(i.bi.id)&&(t.push(i.bi),n.push(i.bi.id)),-1===n.indexOf(i.bj.id)&&(t.push(i.bj),n.push(i.bj.id))}return t},a.prototype.solve=function(t,n){var r=[];n.removeAllEquations();for(var e=this.equations.length,i=0;i!==e;i++)n.addEquation(this.equations[i]);for(var o=this.getBodies(),a=o.length,i=0;i!==a;i++)r.push(o[i]);n.solve(t,{bodies:r})}},{"./Solver":5,"../constraints/ContactEquation":9,"../objects/Body":7,"gl-matrix":16}],15:[function(t,n,r){function e(){return performance.now?performance.now():performance.webkitNow?performance.webkitNow():(new Date).getTime()}function i(t){f.apply(this),t=t||{},this.springs=[],this.bodies=[],this.solver=t.solver||new o,this.contacts=[],this.oldContacts=[],this.collidingBodies=[],this.gravity=t.gravity||c.fromValues(0,-9.78),this.doProfiling=t.doProfiling||!1,this.lastStepTime=0,this.broadphase=t.broadphase||new a,this.constraints=[],this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.addSpringEvent={type:"addSpring",body:null}}var o=t("../solver/GSSolver").GSSolver,a=t("../collision/NaiveBroadphase").NaiveBroadphase,s=t("gl-matrix"),c=s.vec2,u=t("../objects/Shape").Circle,l=t("../objects/Shape").Plane,h=t("../objects/Shape").Particle,f=t("../events/EventEmitter").EventEmitter,v=t("../objects/Body").Body,p=t("../collision/Broadphase");p.Broadphase,r.World=i,i.prototype=Object(f.prototype),i.prototype.addConstraint=function(t){this.constraints.push(t),t.id=this._constraintIdCounter++},i.prototype.removeConstraint=function(t){var n=this.constraints.indexOf(t);-1!==n&&this.constraints.splice(n,1)};var d=c.create(),m=c.create(),y=c.create(),g=c.create(),b=c.create(),C=c.create();i.prototype.step=function(t){var n,r,i=this,o=this.doProfiling,a=this.springs.length,s=this.springs,f=this.bodies,v=(this.collidingBodies,this.gravity),M=this.solver,q=this.bodies.length,x=this.broadphase,S=this.constraints;o&&(n=e());for(var w=0;w!==q;w++){var B=f[w].force;c.add(B,B,v)}for(var w=0;w!==a;w++){var E=s[w],j=E.stiffness,P=E.damping,A=E.restLength,F=E.bodyA,I=E.bodyB,k=d,V=m,_=y,G=g;c.sub(k,F.position,I.position),c.sub(_,F.velocity,I.velocity);var O=c.len(k);c.normalize(V,k),c.scale(G,V,j*(O-A)+P*c.dot(_,V)),c.sub(F.force,F.force,G),c.add(I.force,I.force,G)}for(var D=x.getCollisionPairs(this),L=this.contacts.concat(this.oldContacts),N=this.contacts=[],w=0,T=D.length;w!==T;w+=2){var z=D[w],W=D[w+1],Y=z.shape,X=W.shape;Y instanceof u?X instanceof u?p.nearphaseCircleCircle(z,W,N,L):X instanceof h?p.nearphaseCircleParticle(z,W,N,L):X instanceof l&&p.nearphaseCirclePlane(z,W,N,L):Y instanceof h?X instanceof u&&p.nearphaseCircleParticle(W,z,N,L):Y instanceof l&&X instanceof u&&p.nearphaseCirclePlane(W,z,N,L)}this.oldContacts=L;for(var w=0,J=N.length;w!==J;w++)M.addEquation(N[w]);var Q=S.length;for(w=0;w!==Q;w++){var Z=S[w];Z.update();for(var K=0,R=Z.equations.length;K!==R;K++){var H=Z.equations[K];M.addEquation(H)}}M.solve(t,this),M.removeAllEquations();for(var U=b,$=C,w=0;w!==q;w++){var tn=f[w];if(tn.mass>0){var nn=1/tn.mass,G=tn.force,rn=tn.position,en=tn.velocity;tn.angularVelocity+=tn.angularForce*tn.invInertia*t,tn.angle+=tn.angularVelocity*t,c.scale(U,G,t*nn),c.add(en,U,en),c.scale($,en,t),c.add(rn,rn,$)}}for(var w=0;w!==q;w++){var z=f[w];c.set(z.force,0,0),z.angularForce=0}o&&(r=e(),i.lastStepTime=r-n),this.emit(this.postStepEvent)},i.prototype.addSpring=function(t){this.springs.push(t),this.addSpringEvent.spring=t,this.emit(this.addSpringEvent)},i.prototype.removeSpring=function(t){var n=this.springs.indexOf(t);-1===n&&this.springs.splice(n,1)},i.prototype.addBody=function(t){this.bodies.push(t),this.collidingBodies.push(t),this.addBodyEvent.body=t,this.emit(this.addBodyEvent)},i.prototype.removeBody=function(t){var n=this.bodies.indexOf(t);-1===n&&this.bodies.splice(n,1)},i.prototype.toJSON=function(){function t(t){return[t[0],t[1]]}for(var n={p2:"0.1.0",bodies:[],springs:[],solver:{},gravity:t(this.gravity),broadphase:{},constraints:[]},r=0;this.bodies.length>r;r++){var e=this.bodies[r];n.bodies.push({mass:e.mass,angle:e.angle,position:t(e.position),velocity:t(e.velocity),angularVelocity:e.angularVelocity,force:t(e.force)})}return n},i.prototype.fromJSON=function(t){if(this.clear(),!t.p2)return!1;switch(t.p2){case"0.1.0":for(var n=0;t.bodies.length>n;n++){var r=t.bodies[n],e=new v({mass:r.mass,position:r.position,angle:r.angle,velocity:r.velocity,angularVelocity:r.angularVelocity,force:r.force});this.addBody(e)}break;default:return!1}return!0},i.prototype.clear=function(){for(var t=this.constraints,n=0;t.length>n;n++)this.removeConstraint(t[n]);for(var r=this.bodies,n=0;r.length>n;n++)this.removeBody(r[n]);for(var e=this.springs,n=0;e.length>n;n++)this.removeSpring(e[n])}},{"../solver/GSSolver":13,"../collision/NaiveBroadphase":12,"../objects/Shape":1,"../events/EventEmitter":4,"../collision/Broadphase":8,"../objects/Body":7,"gl-matrix":16}]},{},[6])(6)});