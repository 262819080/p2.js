(function(t){if("function"==typeof bootstrap)bootstrap("p2",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeP2=t}else"undefined"!=typeof window?window.p2=t():self.p2=t()})(function(){var t;return function(t,r,n){function e(n,i){if(!r[n]){if(!t[n]){var o="function"==typeof require&&require;if(!i&&o)return o(n,!0);if(a)return a(n,!0);throw Error("Cannot find module '"+n+"'")}var s=r[n]={exports:{}};t[n][0].call(s.exports,function(r){var a=t[n][1][r];return e(a?a:r)},s,s.exports)}return r[n].exports}for(var a="function"==typeof require&&require,i=0;n.length>i;i++)e(n[i]);return e}({1:[function(t,r,n){n.Shape=function(){},n.Particle=function(){p2.Shape.apply(this)},n.Circle=function(t){p2.Shape.apply(this),this.radius=t||1},n.Plane=function(){p2.Shape.apply(this)}},{}],2:[function(t,r,n){function e(t,r){this.equations=[],this.bodyA=t,this.bodyB=r}n.Constraint=e,e.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!")}},{}],3:[function(t,r,n){function e(t,r,n,e){this.id=-1,this.minForce=n===void 0?-1e6:n,this.maxForce=e===void 0?1e6:e,this.bi=t,this.bj=r}n.Equation=e,e.prototype.constructor=e},{}],4:[function(t,r,n){function e(){this.equations=[]}n.Solver=e,e.prototype.solve=function(t,r,n){return n()},e.prototype.addEquation=function(t){this.equations.push(t)},e.prototype.removeEquation=function(t){var r=this.equations.indexOf(t);-1!=r&&this.equations.splice(r,1)},e.prototype.removeAllEquations=function(){this.equations=[]}},{}],5:[function(t,r,n){n.Body=t("./objects/Body").Body,n.Broadphase=t("./collision/Broadphase").Broadphase,n.Circle=t("./objects/Shape").Circle,n.Constraint=t("./constraints/Constraint").Constraint,n.ContactEquation=t("./constraints/ContactEquation").ContactEquation,n.DistanceConstraint=t("./constraints/DistanceConstraint").DistanceConstraint,n.Equation=t("./constraints/Equation").Equation,n.GridBroadphase=t("./collision/GridBroadphase").GridBroadphase,n.GSSolver=t("./solver/GSSolver").GSSolver,n.NaiveBroadphase=t("./collision/NaiveBroadphase").NaiveBroadphase,n.Plane=t("./objects/Shape").Plane,n.ParallelIslandSolver=t("./solver/ParallelIslandSolver").ParallelIslandSolver,n.Island=t("./solver/ParallelIslandSolver").Island,n.IslandGroup=t("./solver/ParallelIslandSolver").IslandGroup,n.Shape=t("./objects/Shape").Shape,n.Solver=t("./solver/Solver").Solver,n.Spring=t("./objects/Body").Spring,n.World=t("./world/World").World;var e=t("gl-matrix");n.vec2=e.vec2,n.mat2=e.mat2},{"./objects/Body":6,"./collision/Broadphase":7,"./objects/Shape":1,"./constraints/Constraint":2,"./constraints/ContactEquation":8,"./constraints/DistanceConstraint":9,"./constraints/Equation":3,"./collision/GridBroadphase":10,"./solver/GSSolver":11,"./collision/NaiveBroadphase":12,"./solver/ParallelIslandSolver":13,"./solver/Solver":4,"./world/World":14,"gl-matrix":15}],15:[function(r,n,e){(function(){(function(){"use strict";var r={};e===void 0?"function"==typeof t&&"object"==typeof t.amd&&t.amd?(r.exports={},t(function(){return r.exports})):r.exports=window:r.exports=e,function(t){var r={};if(!n)var n=1e-6;r.create=function(){return new Float32Array(2)},r.clone=function(t){var r=new Float32Array(2);return r[0]=t[0],r[1]=t[1],r},r.fromValues=function(t,r){var n=new Float32Array(2);return n[0]=t,n[1]=r,n},r.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t},r.set=function(t,r,n){return t[0]=r,t[1]=n,t},r.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t},r.sub=r.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t},r.mul=r.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t},r.div=r.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t},r.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t},r.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t},r.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t},r.dist=r.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return Math.sqrt(n*n+e*e)},r.sqrDist=r.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return n*n+e*e},r.len=r.length=function(t){var r=t[0],n=t[1];return Math.sqrt(r*r+n*n)},r.sqrLen=r.squaredLength=function(t){var r=t[0],n=t[1];return r*r+n*n},r.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t},r.normalize=function(t,r){var n=r[0],e=r[1],a=n*n+e*e;return a>0&&(a=1/Math.sqrt(a),t[0]=r[0]*a,t[1]=r[1]*a),t},r.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]},r.cross=function(t,r,n){var e=r[0]*n[1]-r[1]*n[0];return t[0]=t[1]=0,t[2]=e,t},r.lerp=function(t,r,n,e){var a=r[0],i=r[1];return t[0]=a+e*(n[0]-a),t[1]=i+e*(n[1]-i),t},r.transformMat2=function(t,r,n){var e=r[0],a=r[1];return t[0]=e*n[0]+a*n[1],t[1]=e*n[2]+a*n[3],t},r.forEach=function(){var t=new Float32Array(2);return function(r,n,e,a,i,o){var s,u;for(n||(n=2),e||(e=0),u=a?Math.min(a*n+e,r.length):r.length,s=e;u>s;s+=n)t[0]=r[s],t[1]=r[s+1],i(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}(),r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},t!==void 0&&(t.vec2=r);var e={};if(!n)var n=1e-6;e.create=function(){return new Float32Array(3)},e.clone=function(t){var r=new Float32Array(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},e.fromValues=function(t,r,n){var e=new Float32Array(3);return e[0]=t,e[1]=r,e[2]=n,e},e.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},e.set=function(t,r,n,e){return t[0]=r,t[1]=n,t[2]=e,t},e.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t},e.sub=e.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t[2]=r[2]-n[2],t},e.mul=e.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t[2]=r[2]*n[2],t},e.div=e.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t[2]=r[2]/n[2],t},e.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t},e.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t},e.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t},e.dist=e.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2];return Math.sqrt(n*n+e*e+a*a)},e.sqrDist=e.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2];return n*n+e*e+a*a},e.len=e.length=function(t){var r=t[0],n=t[1],e=t[2];return Math.sqrt(r*r+n*n+e*e)},e.sqrLen=e.squaredLength=function(t){var r=t[0],n=t[1],e=t[2];return r*r+n*n+e*e},e.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t},e.normalize=function(t,r){var n=r[0],e=r[1],a=r[2],i=n*n+e*e+a*a;return i>0&&(i=1/Math.sqrt(i),t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i),t},e.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},e.cross=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=n[0],s=n[1],u=n[2];return t[0]=a*u-i*s,t[1]=i*o-e*u,t[2]=e*s-a*o,t},e.lerp=function(t,r,n,e){var a=r[0],i=r[1],o=r[2];return t[0]=a+e*(n[0]-a),t[1]=i+e*(n[1]-i),t[2]=o+e*(n[2]-o),t},e.transformMat4=function(t,r,n){var e=r[0],a=r[1],i=r[2];return t[0]=n[0]*e+n[4]*a+n[8]*i+n[12],t[1]=n[1]*e+n[5]*a+n[9]*i+n[13],t[2]=n[2]*e+n[6]*a+n[10]*i+n[14],t},e.transformQuat=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=n[0],s=n[1],u=n[2],c=n[3],l=c*e+s*i-u*a,h=c*a+u*e-o*i,f=c*i+o*a-s*e,p=-o*e-s*a-u*i;return t[0]=l*c+p*-o+h*-u-f*-s,t[1]=h*c+p*-s+f*-o-l*-u,t[2]=f*c+p*-u+l*-s-h*-o,t},e.forEach=function(){var t=new Float32Array(3);return function(r,n,e,a,i,o){var s,u;for(n||(n=3),e||(e=0),u=a?Math.min(a*n+e,r.length):r.length,s=e;u>s;s+=n)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],i(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}(),e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t!==void 0&&(t.vec3=e);var a={};if(!n)var n=1e-6;a.create=function(){return new Float32Array(4)},a.clone=function(t){var r=new Float32Array(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},a.fromValues=function(t,r,n,e){var a=new Float32Array(4);return a[0]=t,a[1]=r,a[2]=n,a[3]=e,a},a.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},a.set=function(t,r,n,e,a){return t[0]=r,t[1]=n,t[2]=e,t[3]=a,t},a.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t},a.sub=a.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t[2]=r[2]-n[2],t[3]=r[3]-n[3],t},a.mul=a.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t[2]=r[2]*n[2],t[3]=r[3]*n[3],t},a.div=a.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t[2]=r[2]/n[2],t[3]=r[3]/n[3],t},a.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t[3]=Math.min(r[3],n[3]),t},a.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t[3]=Math.max(r[3],n[3]),t},a.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t},a.dist=a.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2],i=r[3]-t[3];return Math.sqrt(n*n+e*e+a*a+i*i)},a.sqrDist=a.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2],i=r[3]-t[3];return n*n+e*e+a*a+i*i},a.len=a.length=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return Math.sqrt(r*r+n*n+e*e+a*a)},a.sqrLen=a.squaredLength=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return r*r+n*n+e*e+a*a},a.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t},a.normalize=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=n*n+e*e+a*a+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=r[0]*o,t[1]=r[1]*o,t[2]=r[2]*o,t[3]=r[3]*o),t},a.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]},a.lerp=function(t,r,n,e){var a=r[0],i=r[1],o=r[2],s=r[3];return t[0]=a+e*(n[0]-a),t[1]=i+e*(n[1]-i),t[2]=o+e*(n[2]-o),t[3]=s+e*(n[3]-s),t},a.transformMat4=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3];return t[0]=n[0]*e+n[4]*a+n[8]*i+n[12]*o,t[1]=n[1]*e+n[5]*a+n[9]*i+n[13]*o,t[2]=n[2]*e+n[6]*a+n[10]*i+n[14]*o,t[3]=n[3]*e+n[7]*a+n[11]*i+n[15]*o,t},a.transformQuat=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=n[0],s=n[1],u=n[2],c=n[3],l=c*e+s*i-u*a,h=c*a+u*e-o*i,f=c*i+o*a-s*e,p=-o*e-s*a-u*i;return t[0]=l*c+p*-o+h*-u-f*-s,t[1]=h*c+p*-s+f*-o-l*-u,t[2]=f*c+p*-u+l*-s-h*-o,t},a.forEach=function(){var t=new Float32Array(4);return function(r,n,e,a,i,o){var s,u;for(n||(n=4),e||(e=0),u=a?Math.min(a*n+e,r.length):r.length,s=e;u>s;s+=n)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],i(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}(),a.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.vec4=a);var i={},o=new Float32Array([1,0,0,1]);if(!n)var n=1e-6;i.create=function(){return new Float32Array(o)},i.clone=function(t){var r=new Float32Array(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},i.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},i.transpose=function(t,r){if(t===r){var n=r[1];t[1]=r[2],t[2]=n}else t[0]=r[0],t[1]=r[2],t[2]=r[1],t[3]=r[3];return t},i.invert=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=n*i-a*e;return o?(o=1/o,t[0]=i*o,t[1]=-e*o,t[2]=-a*o,t[3]=n*o,t):null},i.adjoint=function(t,r){var n=r[0];return t[0]=r[3],t[1]=-r[1],t[2]=-r[2],t[3]=n,t},i.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},i.mul=i.multiply=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=e*s+a*c,t[1]=e*u+a*l,t[2]=i*s+o*c,t[3]=i*u+o*l,t},i.rotate=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=Math.sin(n),u=Math.cos(n);return t[0]=e*u+a*s,t[1]=e*-s+a*u,t[2]=i*u+o*s,t[3]=i*-s+o*u,t},i.scale=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=n[0],u=n[1];return t[0]=e*s,t[1]=a*u,t[2]=i*s,t[3]=o*u,t},i.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.mat2=i);var s={},u=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!n)var n=1e-6;s.create=function(){return new Float32Array(u)},s.clone=function(t){var r=new Float32Array(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},s.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.transpose=function(t,r){if(t===r){var n=r[1],e=r[2],a=r[5];t[1]=r[3],t[2]=r[6],t[3]=n,t[5]=r[7],t[6]=e,t[7]=a}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t},s.invert=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=r[4],s=r[5],u=r[6],c=r[7],l=r[8],h=l*o-s*c,f=-l*i+s*u,p=c*i-o*u,v=n*h+e*f+a*p;return v?(v=1/v,t[0]=h*v,t[1]=(-l*e+a*c)*v,t[2]=(s*e-a*o)*v,t[3]=f*v,t[4]=(l*n-a*u)*v,t[5]=(-s*n+a*i)*v,t[6]=p*v,t[7]=(-c*n+e*u)*v,t[8]=(o*n-e*i)*v,t):null},s.adjoint=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=r[4],s=r[5],u=r[6],c=r[7],l=r[8];return t[0]=o*l-s*c,t[1]=a*c-e*l,t[2]=e*s-a*o,t[3]=s*u-i*l,t[4]=n*l-a*u,t[5]=a*i-n*s,t[6]=i*c-o*u,t[7]=e*u-n*c,t[8]=n*o-e*i,t},s.determinant=function(t){var r=t[0],n=t[1],e=t[2],a=t[3],i=t[4],o=t[5],s=t[6],u=t[7],c=t[8];return r*(c*i-o*u)+n*(-c*a+o*s)+e*(u*a-i*s)},s.mul=s.multiply=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=r[4],u=r[5],c=r[6],l=r[7],h=r[8],f=n[0],p=n[1],v=n[2],d=n[3],m=n[4],g=n[5],y=n[6],b=n[7],q=n[8];return t[0]=f*e+p*o+v*c,t[1]=f*a+p*s+v*l,t[2]=f*i+p*u+v*h,t[3]=d*e+m*o+g*c,t[4]=d*a+m*s+g*l,t[5]=d*i+m*u+g*h,t[6]=y*e+b*o+q*c,t[7]=y*a+b*s+q*l,t[8]=y*i+b*u+q*h,t},s.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t!==void 0&&(t.mat3=s);var c={},l=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!n)var n=1e-6;c.create=function(){return new Float32Array(l)},c.clone=function(t){var r=new Float32Array(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},c.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.transpose=function(t,r){if(t===r){var n=r[1],e=r[2],a=r[3],i=r[6],o=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=n,t[6]=r[9],t[7]=r[13],t[8]=e,t[9]=i,t[11]=r[14],t[12]=a,t[13]=o,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},c.invert=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=r[4],s=r[5],u=r[6],c=r[7],l=r[8],h=r[9],f=r[10],p=r[11],v=r[12],d=r[13],m=r[14],g=r[15],y=n*s-e*o,b=n*u-a*o,q=n*c-i*o,w=e*u-a*s,C=e*c-i*s,M=a*c-i*u,S=l*d-h*v,x=l*m-f*v,E=l*g-p*v,B=h*m-f*d,P=h*g-p*d,A=f*g-p*m,j=y*A-b*P+q*B+w*E-C*x+M*S;return j?(j=1/j,t[0]=(s*A-u*P+c*B)*j,t[1]=(a*P-e*A-i*B)*j,t[2]=(d*M-m*C+g*w)*j,t[3]=(f*C-h*M-p*w)*j,t[4]=(u*E-o*A-c*x)*j,t[5]=(n*A-a*E+i*x)*j,t[6]=(m*q-v*M-g*b)*j,t[7]=(l*M-f*q+p*b)*j,t[8]=(o*P-s*E+c*S)*j,t[9]=(e*E-n*P-i*S)*j,t[10]=(v*C-d*q+g*y)*j,t[11]=(h*q-l*C-p*y)*j,t[12]=(s*x-o*B-u*S)*j,t[13]=(n*B-e*x+a*S)*j,t[14]=(d*b-v*w-m*y)*j,t[15]=(l*w-h*b+f*y)*j,t):null},c.adjoint=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=r[4],s=r[5],u=r[6],c=r[7],l=r[8],h=r[9],f=r[10],p=r[11],v=r[12],d=r[13],m=r[14],g=r[15];return t[0]=s*(f*g-p*m)-h*(u*g-c*m)+d*(u*p-c*f),t[1]=-(e*(f*g-p*m)-h*(a*g-i*m)+d*(a*p-i*f)),t[2]=e*(u*g-c*m)-s*(a*g-i*m)+d*(a*c-i*u),t[3]=-(e*(u*p-c*f)-s*(a*p-i*f)+h*(a*c-i*u)),t[4]=-(o*(f*g-p*m)-l*(u*g-c*m)+v*(u*p-c*f)),t[5]=n*(f*g-p*m)-l*(a*g-i*m)+v*(a*p-i*f),t[6]=-(n*(u*g-c*m)-o*(a*g-i*m)+v*(a*c-i*u)),t[7]=n*(u*p-c*f)-o*(a*p-i*f)+l*(a*c-i*u),t[8]=o*(h*g-p*d)-l*(s*g-c*d)+v*(s*p-c*h),t[9]=-(n*(h*g-p*d)-l*(e*g-i*d)+v*(e*p-i*h)),t[10]=n*(s*g-c*d)-o*(e*g-i*d)+v*(e*c-i*s),t[11]=-(n*(s*p-c*h)-o*(e*p-i*h)+l*(e*c-i*s)),t[12]=-(o*(h*m-f*d)-l*(s*m-u*d)+v*(s*f-u*h)),t[13]=n*(h*m-f*d)-l*(e*m-a*d)+v*(e*f-a*h),t[14]=-(n*(s*m-u*d)-o*(e*m-a*d)+v*(e*u-a*s)),t[15]=n*(s*f-u*h)-o*(e*f-a*h)+l*(e*u-a*s),t},c.determinant=function(t){var r=t[0],n=t[1],e=t[2],a=t[3],i=t[4],o=t[5],s=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11],p=t[12],v=t[13],d=t[14],m=t[15],g=r*o-n*i,y=r*s-e*i,b=r*u-a*i,q=n*s-e*o,w=n*u-a*o,C=e*u-a*s,M=c*v-l*p,S=c*d-h*p,x=c*m-f*p,E=l*d-h*v,B=l*m-f*v,P=h*m-f*d;return g*P-y*B+b*E+q*x-w*S+C*M},c.mul=c.multiply=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=r[4],u=r[5],c=r[6],l=r[7],h=r[8],f=r[9],p=r[10],v=r[11],d=r[12],m=r[13],g=r[14],y=r[15],b=n[0],q=n[1],w=n[2],C=n[3];return t[0]=b*e+q*s+w*h+C*d,t[1]=b*a+q*u+w*f+C*m,t[2]=b*i+q*c+w*p+C*g,t[3]=b*o+q*l+w*v+C*y,b=n[4],q=n[5],w=n[6],C=n[7],t[4]=b*e+q*s+w*h+C*d,t[5]=b*a+q*u+w*f+C*m,t[6]=b*i+q*c+w*p+C*g,t[7]=b*o+q*l+w*v+C*y,b=n[8],q=n[9],w=n[10],C=n[11],t[8]=b*e+q*s+w*h+C*d,t[9]=b*a+q*u+w*f+C*m,t[10]=b*i+q*c+w*p+C*g,t[11]=b*o+q*l+w*v+C*y,b=n[12],q=n[13],w=n[14],C=n[15],t[12]=b*e+q*s+w*h+C*d,t[13]=b*a+q*u+w*f+C*m,t[14]=b*i+q*c+w*p+C*g,t[15]=b*o+q*l+w*v+C*y,t},c.translate=function(t,r,n){var e,a,i,o,s,u,c,l,h,f,p,v,d=n[0],m=n[1],g=n[2];return r===t?(t[12]=r[0]*d+r[4]*m+r[8]*g+r[12],t[13]=r[1]*d+r[5]*m+r[9]*g+r[13],t[14]=r[2]*d+r[6]*m+r[10]*g+r[14],t[15]=r[3]*d+r[7]*m+r[11]*g+r[15]):(e=r[0],a=r[1],i=r[2],o=r[3],s=r[4],u=r[5],c=r[6],l=r[7],h=r[8],f=r[9],p=r[10],v=r[11],t[0]=e,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=h,t[9]=f,t[10]=p,t[11]=v,t[12]=e*d+s*m+h*g+r[12],t[13]=a*d+u*m+f*g+r[13],t[14]=i*d+c*m+p*g+r[14],t[15]=o*d+l*m+v*g+r[15]),t},c.scale=function(t,r,n){var e=n[0],a=n[1],i=n[2];return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=r[7]*a,t[8]=r[8]*i,t[9]=r[9]*i,t[10]=r[10]*i,t[11]=r[11]*i,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},c.rotate=function(t,r,e,a){var i,o,s,u,c,l,h,f,p,v,d,m,g,y,b,q,w,C,M,S,x,E,B,P,A=a[0],j=a[1],k=a[2],F=Math.sqrt(A*A+j*j+k*k);return n>Math.abs(F)?null:(F=1/F,A*=F,j*=F,k*=F,i=Math.sin(e),o=Math.cos(e),s=1-o,u=r[0],c=r[1],l=r[2],h=r[3],f=r[4],p=r[5],v=r[6],d=r[7],m=r[8],g=r[9],y=r[10],b=r[11],q=A*A*s+o,w=j*A*s+k*i,C=k*A*s-j*i,M=A*j*s-k*i,S=j*j*s+o,x=k*j*s+A*i,E=A*k*s+j*i,B=j*k*s-A*i,P=k*k*s+o,t[0]=u*q+f*w+m*C,t[1]=c*q+p*w+g*C,t[2]=l*q+v*w+y*C,t[3]=h*q+d*w+b*C,t[4]=u*M+f*S+m*x,t[5]=c*M+p*S+g*x,t[6]=l*M+v*S+y*x,t[7]=h*M+d*S+b*x,t[8]=u*E+f*B+m*P,t[9]=c*E+p*B+g*P,t[10]=l*E+v*B+y*P,t[11]=h*E+d*B+b*P,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},c.rotateX=function(t,r,n){var e=Math.sin(n),a=Math.cos(n),i=r[4],o=r[5],s=r[6],u=r[7],c=r[8],l=r[9],h=r[10],f=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=i*a+c*e,t[5]=o*a+l*e,t[6]=s*a+h*e,t[7]=u*a+f*e,t[8]=c*a-i*e,t[9]=l*a-o*e,t[10]=h*a-s*e,t[11]=f*a-u*e,t},c.rotateY=function(t,r,n){var e=Math.sin(n),a=Math.cos(n),i=r[0],o=r[1],s=r[2],u=r[3],c=r[8],l=r[9],h=r[10],f=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=i*a-c*e,t[1]=o*a-l*e,t[2]=s*a-h*e,t[3]=u*a-f*e,t[8]=i*e+c*a,t[9]=o*e+l*a,t[10]=s*e+h*a,t[11]=u*e+f*a,t},c.rotateZ=function(t,r,n){var e=Math.sin(n),a=Math.cos(n),i=r[0],o=r[1],s=r[2],u=r[3],c=r[4],l=r[5],h=r[6],f=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=i*a+c*e,t[1]=o*a+l*e,t[2]=s*a+h*e,t[3]=u*a+f*e,t[4]=c*a-i*e,t[5]=l*a-o*e,t[6]=h*a-s*e,t[7]=f*a-u*e,t},c.fromRotationTranslation=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=e+e,u=a+a,c=i+i,l=e*s,h=e*u,f=e*c,p=a*u,v=a*c,d=i*c,m=o*s,g=o*u,y=o*c;return t[0]=1-(p+d),t[1]=h+y,t[2]=f-g,t[3]=0,t[4]=h-y,t[5]=1-(l+d),t[6]=v+m,t[7]=0,t[8]=f+g,t[9]=v-m,t[10]=1-(l+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},c.frustum=function(t,r,n,e,a,i,o){var s=1/(n-r),u=1/(a-e),c=1/(i-o);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*u,t[6]=0,t[7]=0,t[8]=(n+r)*s,t[9]=(a+e)*u,t[10]=(o+i)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*i*c,t[15]=0,t},c.perspective=function(t,r,n,e,a){var i=1/Math.tan(r/2),o=1/(e-a);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+e)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*e*o,t[15]=0,t},c.ortho=function(t,r,n,e,a,i,o){var s=1/(r-n),u=1/(e-a),c=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(r+n)*s,t[13]=(a+e)*u,t[14]=(o+i)*c,t[15]=1,t},c.lookAt=function(t,r,e,a){var i,o,s,u,l,h,f,p,v,d,m=r[0],g=r[1],y=r[2],b=a[0],q=a[1],w=a[2],C=e[0],M=e[1],S=e[2];return n>Math.abs(m-C)&&n>Math.abs(g-M)&&n>Math.abs(y-S)?c.identity(t):(f=m-C,p=g-M,v=y-S,d=1/Math.sqrt(f*f+p*p+v*v),f*=d,p*=d,v*=d,i=q*v-w*p,o=w*f-b*v,s=b*p-q*f,d=Math.sqrt(i*i+o*o+s*s),d?(d=1/d,i*=d,o*=d,s*=d):(i=0,o=0,s=0),u=p*s-v*o,l=v*i-f*s,h=f*o-p*i,d=Math.sqrt(u*u+l*l+h*h),d?(d=1/d,u*=d,l*=d,h*=d):(u=0,l=0,h=0),t[0]=i,t[1]=u,t[2]=f,t[3]=0,t[4]=o,t[5]=l,t[6]=p,t[7]=0,t[8]=s,t[9]=h,t[10]=v,t[11]=0,t[12]=-(i*m+o*g+s*y),t[13]=-(u*m+l*g+h*y),t[14]=-(f*m+p*g+v*y),t[15]=1,t)},c.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t!==void 0&&(t.mat4=c);var h={},f=new Float32Array([0,0,0,1]);if(!n)var n=1e-6;h.create=function(){return new Float32Array(f)},h.clone=a.clone,h.fromValues=a.fromValues,h.copy=a.copy,h.set=a.set,h.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.setAxisAngle=function(t,r,n){n=.5*n;var e=Math.sin(n);return t[0]=e*r[0],t[1]=e*r[1],t[2]=e*r[2],t[3]=Math.cos(n),t},h.add=a.add,h.mul=h.multiply=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=e*l+o*s+a*c-i*u,t[1]=a*l+o*u+i*s-e*c,t[2]=i*l+o*c+e*u-a*s,t[3]=o*l-e*s-a*u-i*c,t},h.scale=a.scale,h.rotateX=function(t,r,n){n*=.5;var e=r[0],a=r[1],i=r[2],o=r[3],s=Math.sin(n),u=Math.cos(n);return t[0]=e*u+o*s,t[1]=a*u+i*s,t[2]=i*u-a*s,t[3]=o*u-e*s,t},h.rotateY=function(t,r,n){n*=.5;var e=r[0],a=r[1],i=r[2],o=r[3],s=Math.sin(n),u=Math.cos(n);return t[0]=e*u-i*s,t[1]=a*u+o*s,t[2]=i*u+e*s,t[3]=o*u-a*s,t},h.rotateZ=function(t,r,n){n*=.5;var e=r[0],a=r[1],i=r[2],o=r[3],s=Math.sin(n),u=Math.cos(n);return t[0]=e*u+a*s,t[1]=a*u-e*s,t[2]=i*u+o*s,t[3]=o*u-i*s,t},h.calculateW=function(t,r){var n=r[0],e=r[1],a=r[2];return t[0]=n,t[1]=e,t[2]=a,t[3]=-Math.sqrt(Math.abs(1-n*n-e*e-a*a)),t},h.dot=a.dot,h.lerp=a.lerp,h.slerp=function(t,r,n,e){var a,i,o,s,u=r[0],c=r[1],l=r[2],h=r[3],f=n[0],p=n[1],v=n[2],d=r[3],m=u*f+c*p+l*v+h*d;return Math.abs(m)>=1?(t!==r&&(t[0]=u,t[1]=c,t[2]=l,t[3]=h),t):(a=Math.acos(m),i=Math.sqrt(1-m*m),.001>Math.abs(i)?(t[0]=.5*u+.5*f,t[1]=.5*c+.5*p,t[2]=.5*l+.5*v,t[3]=.5*h+.5*d,t):(o=Math.sin((1-e)*a)/i,s=Math.sin(e*a)/i,t[0]=u*o+f*s,t[1]=c*o+p*s,t[2]=l*o+v*s,t[3]=h*o+d*s,t))},h.invert=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=n*n+e*e+a*a+i*i,s=o?1/o:0;return t[0]=-n*s,t[1]=-e*s,t[2]=-a*s,t[3]=i*s,t},h.conjugate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t},h.len=h.length=a.length,h.sqrLen=h.squaredLength=a.squaredLength,h.normalize=a.normalize,h.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.quat=h)}(r.exports)})()})()},{}],16:[function(t,r,n){n.vec2={getX:function(t){return t[0]},getY:function(t){return t[1]},crossLength:function(t,r){return t[0]*r[1]-t[1]*r[0]},rotate:function(t,r,n){var e=Math.cos(n),a=Math.sin(n);t[0]=e*r[0]-a*r[1],t[1]=a*r[0]+e*r[1]}}},{}],6:[function(t,r,n){function e(t,r,n){n=n||{},this.restLength=n.restLength||1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=r}function a(t){t=t||{},this.id=++a._idCounter,this.shape=t.shape,this.mass=t.mass||0,this.invMass=this.mass>0?1/this.mass:0,this.inertia=t.inertia||this.mass,this.invInertia=this.invMass,this.position=t.position||o.create(),this.velocity=t.velocity||o.create(),this.vlambda=o.create(),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=t.force||o.create(),this.angularForce=t.angularForce||0,this.motionState=0==this.mass?a.MotionState.STATIC:a.MotionState.DYNAMIC}var i=t("gl-matrix"),o=i.vec2;n.Body=a,n.Spring=e,a._idCounter=0,a.MotionState={DYNAMIC:1,STATIC:2,KINEMATIC:4};var s=o.create();a.prototype.applyForce=function(t,r){var n=s;o.sub(n,r,this.position),o.add(this.force,this.force,t);var e=o.crossLength(n,t);this.angularForce+=e}},{"gl-matrix":15}],7:[function(t,r,n){var e=t("gl-matrix"),a=t("../gl-matrix-extensions"),i=a.vec2,o=e.vec2,s=e.mat2,u=o.create();s.create();var c=o.create(),l=o.fromValues(0,1);n.checkCircleCircle=function(t,r,n){o.sub(u,t.position,r.position);var e=t.shape.radius,a=r.shape.radius;(e+a)*(e+a)>o.sqrLen(u)&&(n.push(t),n.push(r))},n.checkCirclePlane=function(t,r,n){o.sub(u,t.position,r.position),i.rotate(c,l,r.angle),o.dot(u,c)<=t.shape.radius&&(n.push(t),n.push(r))},n.checkCircleParticle=function(t,r,n){n.push(t),n.push(r)},n.nearphaseCircleCircle=function(t,r,n,e){var a=e.length?e.pop():new p2.ContactEquation(t,r);a.bi=t,a.bj=r,o.sub(a.ni,r.position,t.position),o.normalize(a.ni,a.ni),o.scale(a.ri,a.ni,t.shape.radius),o.scale(a.rj,a.ni,-r.shape.radius),n.push(a)},n.nearphaseCircleParticle=function(){};var h=(s.create(),o.create()),f=o.create();n.nearphaseCirclePlane=function(t,r,n,e){var a=e.length?e.pop():new p2.ContactEquation(r,t);a.bi=r,a.bj=t;var s=h,u=f;i.rotate(a.ni,l,r.angle),o.scale(a.rj,a.ni,-t.shape.radius),o.sub(s,t.position,r.position);var c=o.dot(a.ni,s);o.scale(u,a.ni,c),o.sub(a.ri,s,u),n.push(a)},n.Broadphase=function(){},n.Broadphase.prototype.getCollisionPairs=function(){throw Error("getCollisionPairs must be implemented in a subclass!")}},{"../gl-matrix-extensions":16,"gl-matrix":15}],8:[function(t,r,n){function e(t,r){a.call(this,t,r,0,1e6),this.penetration=0,this.ri=o.create(),this.penetrationVec=o.create(),this.rj=o.create(),this.ni=o.create(),this.rixn=o.create(),this.rjxn=o.create(),this.rixw=o.create(),this.rjxw=o.create(),this.relVel=o.create(),this.relForce=o.create()}var a=t("./Equation").Equation,i=t("gl-matrix"),o=i.vec2,s=t("../gl-matrix-extensions"),u=s.vec2;n.ContactEquation=e,e.prototype=new a,e.prototype.constructor=e,e.prototype.computeB=function(t,r,n){var e=this.bi,a=this.bj,i=this.ri,s=this.rj,c=e.position,l=a.position,h=e.velocity,f=e.angularVelocity,p=e.force,v=e.angularForce,d=a.velocity,m=a.angularVelocity,g=a.force,y=a.angularForce,b=(this.relVel,this.relForce,this.penetrationVec),q=e.invMass,w=a.invMass,C=e.invInertia,M=a.invInertia,S=this.ni,x=this.rixn=u.crossLength(i,S),E=this.rjxn=u.crossLength(s,S);o.set(b,0,0),o.add(b,l,s),o.sub(b,b,c),o.sub(b,b,i);var B=o.dot(S,b),P=o.dot(d,S)-o.dot(h,S)+m*E-f*x,A=o.dot(g,S)*w-o.dot(p,S)*q+M*y*E-C*v*x,j=-B*t-P*r-n*A;return j},e.prototype.computeC=function(t){var r=this.bi,n=this.bj,e=this.rixn,a=this.rjxn,i=r.invMass,o=n.invMass,s=i+o+t,u=r.invInertia,c=n.invInertia;return s+=u*e*e,s+=c*a*a};var c=o.create();e.prototype.computeGWlambda=function(){var t=this.bi,r=this.bj,n=c,e=0;return o.sub(n,r.vlambda,t.vlambda),e+=o.dot(n,this.ni),e-=t.wlambda*this.rixn,e+=r.wlambda*this.rjxn};var l=o.create();e.prototype.addToWlambda=function(t){var r=this.bi,n=this.bj,e=this.rixn,a=this.rjxn,i=r.invMass,s=n.invMass,u=this.ni,c=l;o.scale(c,u,i*t),o.sub(r.vlambda,r.vlambda,c),o.scale(c,u,s*t),o.add(n.vlambda,n.vlambda,c),r.wlambda-=r.invInertia*e*t,n.wlambda+=n.invInertia*a*t}},{"./Equation":3,"../gl-matrix-extensions":16,"gl-matrix":15}],9:[function(t,r,n){function e(t,r,n,e){a.call(this,t,r),e===void 0&&(e=1e6);var s=this.equations=[new i(t,r)],u=s[0];u.minForce=-e,u.maxForce=e,this.update=function(){o.subtract(u.ni,r.position,t.position),o.normalize(u.ni,u.ni),o.scale(u.ri,u.ni,.5*n),o.scale(u.rj,u.ni,.5*-n)}}var a=t("./Constraint").Constraint,i=t("./ContactEquation").ContactEquation,o=t("gl-matrix").vec2;n.DistanceConstraint=e,e.prototype=new a},{"./Constraint":2,"./ContactEquation":8,"gl-matrix":15}],11:[function(t,r,n){function e(t){o.call(this),t=t||{},this.iterations=t.iterations||10,this.h=t.timeStep||1/60,this.k=t.stiffness||1e7,this.d=t.relaxation||6,this.a=0,this.b=0,this.eps=0,this.tolerance=t.tolerance||0,this.setSpookParams(this.k,this.d),this.debug=t.debug||!1,this.arrayStep=30,this.lambda=new s(this.arrayStep),this.Bs=new s(this.arrayStep),this.invCs=new s(this.arrayStep)}var a=t("gl-matrix"),i=a.vec2,o=t("./Solver").Solver;n.GSSolver=e;var s=Float32Array||Array;e.prototype=new o,e.prototype.setSpookParams=function(t,r){var n=this.h;this.k=t,this.d=r,this.a=4/(n*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(n*n*t*(1+4*r))},e.prototype.solve=function(t,r,n){var e=(this.d,this.k,0),a=this.iterations,o=this.tolerance*this.tolerance,u=this.a,c=this.b,l=this.eps,h=this.equations,f=h.length,p=r.bodies,v=r.bodies.length,d=t;f>this.lambda.length&&(this.lambda=new s(f+this.arrayStep),this.Bs=new s(f+this.arrayStep),this.invCs=new s(f+this.arrayStep));for(var m=this.invCs,g=this.Bs,y=this.lambda,b=0;b!==f;b++){var q=h[b];y[b]=0,g[b]=q.computeB(u,c,d),m[b]=1/q.computeC(l)}var w,q,C,M,S,x,E;if(0!==f){var b,B,P,A,j;for(b=0;b!==v;b++){var c=p[b],k=c.vlambda;i.set(k,0,0),c.wlambda=0}for(e=0;e!==a;e++){for(S=0,B=0;B!==f;B++)q=h[B],A=q.maxForce,P=q.minForce,w=g[B],C=m[B],E=y[B],x=q.computeGWlambda(l),M=C*(w-x-l*E),j=E+M,P>j?M=P-E:j>A&&(M=A-E),y[B]+=M,S+=Math.abs(M),q.addToWlambda(M);if(o>=S*S)break}for(b=0;b!==v;b++){var c=p[b],F=c.velocity;i.add(F,F,c.vlambda),c.angularVelocity+=c.wlambda}}errorTot=S,n()}},{"./Solver":4,"gl-matrix":15}],10:[function(t,r,n){var e=t("../objects/Shape").Circle,a=t("../objects/Shape").Plane,i=t("../objects/Shape").Particle,o=t("../collision/Broadphase"),s=o.Broadphase,u=t("gl-matrix");u.vec2,n.GridBroadphase=function(t,r,n,u,c,l){s.apply(this),c=c||10,l=l||10;var h=(r-t)/c,f=(u-n)/l;this.getCollisionPairs=function(s){for(var p=[],v=s.collidingBodies,d=d=v.length,m=[],g=c*l,y=0;g>y;y++)m.push([]);for(var b=c/(r-t),q=l/(u-n),y=0;y!==d;y++){var w=v[y],C=w.shape;if(void 0!==C)if(C instanceof e)for(var M=w.position[0],S=w.position[1],x=C.radius,E=Math.floor(b*(M-x-t)),B=Math.floor(q*(S-x-n)),P=Math.floor(b*(M+x-t)),A=Math.floor(q*(S+x-n)),j=E;P>=j;j++)for(var k=B;A>=k;k++){var F=j,_=k;F*(l-1)+_>=0&&g>F*(l-1)+_&&m[F*(l-1)+_].push(w)}else{if(!(C instanceof a))throw Error("Shape not supported in GridBroadphase!");if(0==w.angle)for(var S=w.position[1],j=0;j!==g&&S>n+f*(j-1);j++)for(var k=0;c>k;k++){var F=k,_=Math.floor(q*(f*j-n));m[F*(l-1)+_].push(w)}else if(w.angle==.5*Math.PI)for(var M=w.position[0],j=0;j!==g&&M>t+h*(j-1);j++)for(var k=0;l>k;k++){var _=k,F=Math.floor(b*(h*j-t));m[F*(l-1)+_].push(w)}else for(var j=0;j!==g;j++)m[j].push(w)}}for(var y=0;y!==g;y++)for(var I=m[y],j=0,T=I.length;j!==T;j++)for(var w=I[j],C=w.shape,k=0;k!==j;k++){var G=I[k],N=G.shape;C instanceof e?N instanceof e?o.checkCircleCircle(w,G,p):N instanceof i?o.checkCircleParticle(w,G,p):N instanceof a&&o.checkCirclePlane(w,G,p):C instanceof i?N instanceof e&&o.checkCircleParticle(G,w,p):C instanceof a&&N instanceof e&&o.checkCirclePlane(G,w,p)}return p}},n.GridBroadphase.prototype=new s},{"../objects/Shape":1,"../collision/Broadphase":7,"gl-matrix":15}],12:[function(t,r,n){var e=t("../objects/Shape").Circle,a=t("../objects/Shape").Plane,i=t("../collision/Broadphase"),o=i.Broadphase,s=t("gl-matrix");s.vec2,n.NaiveBroadphase=function(){o.apply(this),this.getCollisionPairs=function(t){for(var r=t.collidingBodies,n=[],o=0,s=r.length;o!==s;o++){var u=r[o],c=u.shape;if(void 0!==c)for(var l=0;l!==o;l++){var h=r[l],f=h.shape;void 0!==f&&(c instanceof e?f instanceof e?i.checkCircleCircle(u,h,n):f instanceof Particle?i.checkCircleParticle(u,h,n):f instanceof a&&i.checkCirclePlane(u,h,n):c instanceof Particle?f instanceof e&&i.checkCircleParticle(h,u,n):c instanceof a&&f instanceof e&&i.checkCirclePlane(h,u,n))}}return n}},n.NaiveBroadphase.prototype=new o},{"../objects/Shape":1,"../collision/Broadphase":7,"gl-matrix":15}],13:[function(t,r,n){function e(t,r,n){function e(t){var r=a._workers.indexOf(this),n=a._workerIslandGroups[r];
n.applyResult(t.data),n.reset(),a._workerData[r]=t.data,a._numWorking--,0==a._numWorking&&a._stepDoneCallback()}c.call(this),r=r||2,n=n||"p2.js";var a=this;this.subsolver=t,this.numIslands=0,this._nodePool=[],this._workers=[],this._workerData=[],this._workerBodies=[],this._workerIslandGroups=[],this._numWorking=0,this._stepDoneCallback=function(){};for(var i=new Blob([['importScripts("'+n+'");',"var id = 0; // Worker id","var dt = 1/60; // Solve timestep","var islandGroup = new p2.IslandGroup();","var solver;","this.onmessage = function(e){","    var that=this;",'    if(typeof(e.data.id)!="undefined"){',"        id = parseInt(e.data.id);","        dt = e.data.timeStep;","        solver = new p2.GSSolver(); // Todo: user picked solver","        solver.setSpookParams(1e10,3);","        solver.iterations = 20;","        return;","    } else {","        // Parse islands and solve","        var array = e.data;","        islandGroup.fromArray(array);","        islandGroup.solve(dt,solver,function(){","            islandGroup.resultToArray(array);","            that.postMessage(array,[array.buffer]);","            islandGroup.reset();","        });","    }","};"].join("\n")],{type:"text/javascript"}),o=window.URL.createObjectURL(i),s=0;r>s;s++){var l=new Worker(o);l.onmessage=e,l.postMessage({id:s,timeStep:1/60});var h=new Float32Array(100);this._workers.push(l),this._workerData.push(h),this._workerIslandGroups.push(new u)}}function a(t){for(var r=t.length,n=0;n!==r;n++){var e=t[n];if(!(e.visited||e.body.motionState&p))return e}return!1}function i(t,r){var n=[];for(n.push(t),t.visited=!0,r(t);n.length;)for(var e,i=n.pop();e=a(i.children);)e.visited=!0,r(e),n.push(e)}function o(t,r){return r>t.length?new Float32Array(r+s.ARRAY_CHUNK):t}function s(){this.equations=[],this.bodies=[],this._contactEquationPool=[],this._bodyPool=[]}function u(){this.islands=[],this._islandPool=[]}var c=t("./Solver").Solver,l=t("../constraints/ContactEquation").ContactEquation,h=t("gl-matrix").vec2,f=t("../objects/Body").Body,p=f.MotionState.STATIC;n.ParallelIslandSolver=e,n.Island=s,n.IslandGroup=u,e.prototype=new c,e.prototype.solve=function(t,r,n){function e(t){E.push(t.body);for(var r=t.eqs.length,n=0;n!==r;n++){var e=t.eqs[n];-1===x.indexOf(e)&&x.push(e)}}var u=[],c=r.bodies,l=this.equations,h=l.length,f=c.length,p=(this.subsolver,this._workers),v=this._workerData,d=this._workerIslandGroups;this._stepDoneCallback=n;for(var m=0;m!==f;m++)this._nodePool.length?u.push(this._nodePool.pop()):u.push({body:c[m],children:[],eqs:[],visited:!1});for(var m=0;m!==f;m++){var g=u[m];g.body=c[m],g.children.length=0,g.eqs.length=0,g.visited=!1}for(var y=0;y!==h;y++){var b=l[y],m=c.indexOf(b.bi),q=c.indexOf(b.bj),w=u[m],C=u[q];w.children.push(C),w.eqs.push(b),C.children.push(w),C.eqs.push(b)}for(var M,S=0,x=[],E=[],m=0;d.length>m;m++)d[m].reset();for(var B=[];M=a(u);){var P=new s;x.length=0,E.length=0,i(M,e);for(var A=x.length,m=0;m!==A;m++){var b=x[m];P.equations.push(b)}S++,B.push(P)}this.numIslands=S;for(var j=[],k=[],m=0;p.length>m;m++)j[m]=0,k.push([]);for(;B.length;){for(var P=B.pop(),F=1/0,_=0,m=0;p.length>m;m++){var I=d[m].numEquations();F>I&&(F=I,_=m)}d[_].islands.push(P)}for(var m=0;m!==p.length;m++){var T=d[m];if(T.islands.length){var G=T.storageSize();v[m]=o(v[m],G),T.toArray(v[m]),this._numWorking++,p[m].postMessage(v[m],[v[m].buffer])}}},s.ARRAY_CHUNK=0,s.EquationTypes={CONTACT:1},s.getEquationTypes=function(){var t=[];for(var r in s.EquationTypes)t.push(s.EquationTypes[r]);return t},s.NUMBERS_PER_BODY=12,s.NUMBERS_PER_EQUATION={1:11},s.prototype.reset=function(){for(;this.bodies.length;)this._bodyPool.push(this.bodies.pop());for(;this.equations.length;)this._contactEquationPool.push(this.equations.pop())},s.prototype.fromArray=function(t,r){r=r||0,this.reset();for(var n=r,e=t[n++],a=t[n++],i={},o=0;a>o;o++){var u=this._bodyPool.pop()||new f;u.id=t[n++],h.set(u.position,t[n++],t[n++]),h.set(u.velocity,t[n++],t[n++]),u.angle=t[n++],u.angularVelocity=t[n++],u.mass=t[n++],u.inertia=t[n++],0>u.mass&&(u.mass=0),0>u.inertia&&(u.inertia=0),h.set(u.force,t[n++],t[n++]),u.angularForce=t[n++],u.invMass=u.mass>0?1/u.mass:0,u.invInertia=u.inertia>0?1/u.inertia:0,this.bodies.push(u),i[u.id+""]=u}var c=s.getEquationTypes();if(n>t.length)throw Error("Trying to read element "+n+" of an array of length "+t.length+" ("+a+" bodies, "+e+" eqs)");for(var o=0;e>o;o++){var p=t[n++];if(-1===c.indexOf(p))throw Error("Equation "+o+" (out of "+e+") type not recognized: "+p);var v,d=t[n++],m=t[n++],g=t[n++],y=t[n++];switch(p){case s.EquationTypes.CONTACT:v=this._contactEquationPool.pop()||new l,h.set(v.ri,t[n++],t[n++]),h.set(v.rj,t[n++],t[n++]),h.set(v.ni,t[n++],t[n++]);break;default:throw Error("Equation type not recognized: "+p)}if(v.bi=i[d+""],v.bj=i[m+""],!v.bi)throw Error("Body "+d+" not found");if(!v.bj)throw Error("Body "+m+" not found");v.minForce=g,v.maxForce=y,this.equations.push(v)}return n},s.prototype.toArray=function(t,r){var n=r,e=this.getBodies(),a=e.length,i=this.equations.length;t[n++]=i,t[n++]=a;for(var o=0;a>o;o++){var u=e[o],c=u.position,h=u.velocity;t[n++]=u.id,t[n++]=c[0],t[n++]=c[1],t[n++]=h[0],t[n++]=h[1],t[n++]=u.angle,t[n++]=u.angularVelocity,t[n++]=u.mass,t[n++]=u.inertia,t[n++]=u.force[0],t[n++]=u.force[1],t[n++]=u.angularForce}for(var o=0;i>o;o++){var f,p=this.equations[o];if(!(p instanceof l))throw Error("Equation type not recognized");switch(f=s.EquationTypes.CONTACT,t[n++]=f,t[n++]=p.bi.id,t[n++]=p.bj.id,t[n++]=p.minForce,t[n++]=p.maxForce,f){case s.EquationTypes.CONTACT:t[n++]=p.ri[0],t[n++]=p.ri[1],t[n++]=p.rj[0],t[n++]=p.rj[1],t[n++]=p.ni[0],t[n++]=p.ni[1];break;default:throw Error("Equation type not recognized: "+f)}}return n},s.prototype.storageSize=function(){var t=2;t+=s.NUMBERS_PER_BODY*this.getBodies().length;for(var r=this.equations,n=r.length,e=0;e!==n;e++){var a=r[e];if(!(a instanceof l))throw Error("Equation type not recognized!");t+=s.NUMBERS_PER_EQUATION[s.EquationTypes.CONTACT]}return t},s.prototype.getBodies=function(){for(var t=[],r=[],n=this.equations,e=0;e!==n.length;e++){var a=n[e];-1===r.indexOf(a.bi.id)&&(t.push(a.bi),r.push(a.bi.id)),-1===r.indexOf(a.bj.id)&&(t.push(a.bj),r.push(a.bj.id))}return t},u.prototype.reset=function(){for(;this.islands.length;){var t=this.islands.pop();t.reset(),this._islandPool.push(t)}},u.prototype.numEquations=function(){for(var t=this.islands,r=t.length,n=0,e=0;e!==r;e++)n+=t[e].equations.length;return n},u.prototype.storageSize=function(){for(var t=this.islands,r=1,n=0;t.length>n;n++){var e=t[n].storageSize();r+=e}return r},u.prototype.toArray=function(t){var r=this.islands,n=0;t[n++]=this.islands.length;for(var e=0;r.length>e;e++){var a=r[e];n=a.toArray(t,n)}},u.prototype.fromArray=function(t){var r=this.islands;this.reset();for(var n=0,e=t[n++];e>r.length;)this.islands.push(this._islandPool.pop()||new s);for(var a=0;e>a;a++){var i=this.islands[a];n=i.fromArray(t,n)}},u.prototype.solve=function(t,r,n){var e=this.islands,a=e.length,i=[];r.removeAllEquations();for(var o=0;o!==a;o++){for(var s=e[o],u=s.equations.length,c=0;c!==u;c++)r.addEquation(s.equations[c]);for(var l=s.getBodies(),h=l.length,c=0;c!==h;c++)i.push(l[c])}r.solve(t,{bodies:i},n)},u.prototype.resultToArray=function(t){for(var r=this.islands,n=r.length,e=0,a=0;a!==n;a++)for(var i=r[a].getBodies(),o=i.length,s=0;s!==o;s++){var u=i[s],c=u.vlambda;t[e++]=c[0],t[e++]=c[1],t[e++]=u.wlambda}},u.prototype.applyResult=function(t){for(var r=this.islands,n=r.length,e=0,a=0;a!==n;a++)for(var i=r[a].getBodies(),o=i.length,s=0;s!==o;s++){var u=i[s],c=u.velocity,l=t[e++],f=t[e++],p=t[e++];h.set(u.vlambda,l,f),h.add(c,c,u.vlambda),u.wlambda=p,u.angularVelocity+=p}}},{"./Solver":4,"../constraints/ContactEquation":8,"../objects/Body":6,"gl-matrix":15}],14:[function(t,r,n){function e(){return performance.now?performance.now():performance.webkitNow?performance.webkitNow():(new Date).getTime()}function a(t){t=t||{},this.springs=[],this.bodies=[],this.solver=t.solver||new i,this.contacts=[],this.oldContacts=[],this.collidingBodies=[],this.gravity=t.gravity||u.fromValues(0,-9.78),this.doProfiling=t.doProfiling||!1,this.lastStepTime=0,this.broadphase=t.broadphase||new o,this.constraints=[],this._constraintIdCounter=0,this._bodyIdCounter=0}var i=t("../solver/GSSolver").GSSolver,o=t("../collision/NaiveBroadphase").NaiveBroadphase,s=t("gl-matrix"),u=s.vec2,c=t("../objects/Shape").Circle,l=t("../objects/Shape").Plane,h=t("../objects/Shape").Particle,f=t("../collision/Broadphase");f.Broadphase,n.World=a,a.prototype.addConstraint=function(t){this.constraints.push(t),t.id=this._constraintIdCounter++},a.prototype.removeConstraint=function(t){var r=this.constraints.indexOf(t);-1!==r&&this.constraints.splice(r,1)};var p=u.create(),v=u.create(),d=u.create(),m=u.create(),g=u.create(),y=u.create();a.prototype.step=function(t,r){var n,a,i=this,o=this.doProfiling,s=this.springs.length,b=this.springs,q=this.bodies,w=(this.collidingBodies,this.gravity),C=this.solver,M=this.bodies.length,S=this.broadphase,x=this.constraints;o&&(n=e());for(var E=0;E!==M;E++){var B=q[E].force;u.add(B,B,w)}for(var E=0;E!==s;E++){var P=b[E],A=P.stiffness,j=P.damping,k=P.restLength,F=P.bodyA,_=P.bodyB,I=p,T=v,G=d,N=m;u.sub(I,F.position,_.position),u.sub(G,F.velocity,_.velocity);var D=u.len(I);u.normalize(T,I),u.scale(N,T,A*(D-k)+j*u.dot(G,T)),u.sub(F.force,F.force,N),u.add(_.force,_.force,N)}for(var O=S.getCollisionPairs(this),V=this.contacts.concat(this.oldContacts),L=this.contacts=[],E=0,z=O.length;E!==z;E+=2){var R=O[E],W=O[E+1],U=R.shape,Y=W.shape;U instanceof c?Y instanceof c?f.nearphaseCircleCircle(R,W,L,V):Y instanceof h?f.nearphaseCircleParticle(R,W,L,V):Y instanceof l&&f.nearphaseCirclePlane(R,W,L,V):U instanceof h?Y instanceof c&&f.nearphaseCircleParticle(W,R,L,V):U instanceof l&&Y instanceof c&&f.nearphaseCirclePlane(W,R,L,V)}this.oldContacts=V;for(var E=0,Q=L.length;E!==Q;E++)C.addEquation(L[E]);var K=x.length;for(E=0;E!==K;E++){var X=x[E];X.update();for(var H=0,Z=X.equations.length;H!==Z;H++){var J=X.equations[H];C.addEquation(J)}}C.solve(t,this,function(){C.removeAllEquations();for(var s=g,c=y,l=0;l!==M;l++){var h=q[l];if(h.mass>0){var f=1/h.mass,p=h.force,v=h.position,d=h.velocity;h.angularVelocity+=h.angularForce*h.invInertia*t,h.angle+=h.angularVelocity*t,u.scale(s,p,t*f),u.add(d,s,d),u.scale(c,d,t),u.add(v,v,c)}}for(var l=0;l!==M;l++){var m=q[l];u.set(m.force,0,0),m.angularForce=0}o&&(a=e(),i.lastStepTime=a-n),r()})},a.prototype.addSpring=function(t){this.springs.push(t)},a.prototype.removeSpring=function(t){var r=this.springs.indexOf(t);-1===r&&this.springs.splice(r,1)},a.prototype.addBody=function(t){this.bodies.push(t),this.collidingBodies.push(t)},a.prototype.removeBody=function(t){var r=this.bodies.indexOf(t);-1===r&&this.bodies.splice(r,1)}},{"../solver/GSSolver":11,"../collision/NaiveBroadphase":12,"../objects/Shape":1,"../collision/Broadphase":7,"gl-matrix":15}]},{},[5])(5)});