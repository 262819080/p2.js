!function(a){if("function"==typeof bootstrap)bootstrap("p2",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeP2=a}else"undefined"!=typeof window?window.p2=a():self.p2=a()}(function(){var a;return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b,c){c.Shape=function(){},c.Particle=function(){p2.Shape.apply(this)},c.Circle=function(a){p2.Shape.apply(this),this.radius=a||1},c.Plane=function(){p2.Shape.apply(this)}},{}],2:[function(a,b,c){function d(a,b){this.equations=[],this.bodyA=a,this.bodyB=b}c.Constraint=d,d.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")}},{}],3:[function(a,b,c){function d(a,b,c,d){this.id=-1,this.minForce="undefined"==typeof c?-1e6:c,this.maxForce="undefined"==typeof d?1e6:d,this.bi=a,this.bj=b}c.Equation=d,d.prototype.constructor=d},{}],4:[function(a,b,c){function d(){this.equations=[]}c.Solver=d,d.prototype.solve=function(a,b,c){return c()},d.prototype.addEquation=function(a){this.equations.push(a)},d.prototype.removeEquation=function(a){var b=this.equations.indexOf(a);-1!=b&&this.equations.splice(b,1)},d.prototype.removeAllEquations=function(){this.equations=[]}},{}],5:[function(a,b,c){c.Body=a("./objects/Body").Body,c.Broadphase=a("./collision/Broadphase").Broadphase,c.Circle=a("./objects/Shape").Circle,c.Constraint=a("./constraints/Constraint").Constraint,c.ContactEquation=a("./constraints/ContactEquation").ContactEquation,c.DistanceConstraint=a("./constraints/DistanceConstraint").DistanceConstraint,c.Equation=a("./constraints/Equation").Equation,c.GridBroadphase=a("./collision/GridBroadphase").GridBroadphase,c.GSSolver=a("./solver/GSSolver").GSSolver,c.NaiveBroadphase=a("./collision/NaiveBroadphase").NaiveBroadphase,c.Plane=a("./objects/Shape").Plane,c.ParallelIslandSolver=a("./solver/ParallelIslandSolver").ParallelIslandSolver,c.Island=a("./solver/ParallelIslandSolver").Island,c.IslandGroup=a("./solver/ParallelIslandSolver").IslandGroup,c.Shape=a("./objects/Shape").Shape,c.Solver=a("./solver/Solver").Solver,c.Spring=a("./objects/Body").Spring,c.World=a("./world/World").World;var d=a("gl-matrix");c.vec2=d.vec2,c.mat2=d.mat2},{"./objects/Body":6,"./collision/Broadphase":7,"./objects/Shape":1,"./constraints/Constraint":2,"./constraints/ContactEquation":8,"./constraints/DistanceConstraint":9,"./constraints/Equation":3,"./collision/GridBroadphase":10,"./solver/GSSolver":11,"./collision/NaiveBroadphase":12,"./solver/ParallelIslandSolver":13,"./solver/Solver":4,"./world/World":14,"gl-matrix":15}],15:[function(b,c,d){!function(){!function(){"use strict";var b={};"undefined"==typeof d?"function"==typeof a&&"object"==typeof a.amd&&a.amd?(b.exports={},a(function(){return b.exports})):b.exports=window:b.exports=d,function(a){var b={};if(!c)var c=1e-6;b.create=function(){return new Float32Array(2)},b.clone=function(a){var b=new Float32Array(2);return b[0]=a[0],b[1]=a[1],b},b.fromValues=function(a,b){var c=new Float32Array(2);return c[0]=a,c[1]=b,c},b.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},b.set=function(a,b,c){return a[0]=b,a[1]=c,a},b.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},b.sub=b.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},b.mul=b.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},b.div=b.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},b.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},b.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},b.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},b.dist=b.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},b.sqrDist=b.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},b.len=b.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},b.sqrLen=b.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},b.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},b.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},b.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},b.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},b.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},b.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=d*c[0]+e*c[1],a[1]=d*c[2]+e*c[3],a},b.forEach=function(){var a=new Float32Array(2);return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof a&&(a.vec2=b);var d={};if(!c)var c=1e-6;d.create=function(){return new Float32Array(3)},d.clone=function(a){var b=new Float32Array(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},d.fromValues=function(a,b,c){var d=new Float32Array(3);return d[0]=a,d[1]=b,d[2]=c,d},d.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},d.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},d.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},d.sub=d.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},d.mul=d.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},d.div=d.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},d.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},d.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},d.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},d.dist=d.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},d.sqrDist=d.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},d.len=d.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},d.sqrLen=d.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},d.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},d.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},d.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},d.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},d.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},d.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12],a[1]=c[1]*d+c[5]*e+c[9]*f+c[13],a[2]=c[2]*d+c[6]*e+c[10]*f+c[14],a},d.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},d.forEach=function(){var a=new Float32Array(3);return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),d.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},"undefined"!=typeof a&&(a.vec3=d);var e={};if(!c)var c=1e-6;e.create=function(){return new Float32Array(4)},e.clone=function(a){var b=new Float32Array(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,d){var e=new Float32Array(4);return e[0]=a,e[1]=b,e[2]=c,e[3]=d,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.sub=e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.mul=e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.div=e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.dist=e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.sqrDist=e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.len=e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.sqrLen=e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=b[0]*g,a[1]=b[1]*g,a[2]=b[2]*g,a[3]=b[3]*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.forEach=function(){var a=new Float32Array(4);return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.vec4=e);var f={},g=new Float32Array([1,0,0,1]);if(!c)var c=1e-6;f.create=function(){return new Float32Array(g)},f.clone=function(a){var b=new Float32Array(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},f.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},f.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},f.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},f.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},f.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},f.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},f.mul=f.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+e*j,a[1]=d*i+e*k,a[2]=f*h+g*j,a[3]=f*i+g*k,a},f.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=d*-h+e*i,a[2]=f*i+g*h,a[3]=f*-h+g*i,a},f.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*i,a[2]=f*h,a[3]=g*i,a},f.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.mat2=f);var h={},i=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!c)var c=1e-6;h.create=function(){return new Float32Array(i)},h.clone=function(a){var b=new Float32Array(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},h.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},h.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},h.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},h.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},h.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},h.mul=h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},h.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},"undefined"!=typeof a&&(a.mat3=h);var j={},k=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!c)var c=1e-6;j.create=function(){return new Float32Array(k)},j.clone=function(a){var b=new Float32Array(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},j.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},j.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},j.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},j.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},j.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},j.mul=j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},j.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},j.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},j.rotate=function(a,b,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<c?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},j.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},j.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},j.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},j.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},j.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*g*f*j,a[15]=0,a},j.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},j.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},j.lookAt=function(a,b,d,e){var f,g,h,i,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];return Math.abs(q-w)<c&&Math.abs(r-x)<c&&Math.abs(s-y)<c?j.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,f=u*o-v*n,g=v*m-t*o,h=t*n-u*m,p=Math.sqrt(f*f+g*g+h*h),p?(p=1/p,f*=p,g*=p,h*=p):(f=0,g=0,h=0),i=n*h-o*g,k=o*f-m*h,l=m*g-n*f,p=Math.sqrt(i*i+k*k+l*l),p?(p=1/p,i*=p,k*=p,l*=p):(i=0,k=0,l=0),a[0]=f,a[1]=i,a[2]=m,a[3]=0,a[4]=g,a[5]=k,a[6]=n,a[7]=0,a[8]=h,a[9]=l,a[10]=o,a[11]=0,a[12]=-(f*q+g*r+h*s),a[13]=-(i*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},j.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},"undefined"!=typeof a&&(a.mat4=j);var l={},m=new Float32Array([0,0,0,1]);if(!c)var c=1e-6;l.create=function(){return new Float32Array(m)},l.clone=e.clone,l.fromValues=e.fromValues,l.copy=e.copy,l.set=e.set,l.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},l.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},l.add=e.add,l.mul=l.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},l.scale=e.scale,l.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},l.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},l.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},l.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},l.dot=e.dot,l.lerp=e.lerp,l.slerp=function(a,b,c,d){var e,f,g,h,i=b[0],j=b[1],k=b[2],l=b[3],m=c[0],n=c[1],o=c[2],p=b[3],q=i*m+j*n+k*o+l*p;return Math.abs(q)>=1?(a!==b&&(a[0]=i,a[1]=j,a[2]=k,a[3]=l),a):(e=Math.acos(q),f=Math.sqrt(1-q*q),Math.abs(f)<.001?(a[0]=.5*i+.5*m,a[1]=.5*j+.5*n,a[2]=.5*k+.5*o,a[3]=.5*l+.5*p,a):(g=Math.sin((1-d)*e)/f,h=Math.sin(d*e)/f,a[0]=i*g+m*h,a[1]=j*g+n*h,a[2]=k*g+o*h,a[3]=l*g+p*h,a))},l.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},l.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},l.len=l.length=e.length,l.sqrLen=l.squaredLength=e.squaredLength,l.normalize=e.normalize,l.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.quat=l)}(b.exports)}()}()},{}],16:[function(a,b,c){c.vec2={getX:function(a){return a[0]},getY:function(a){return a[1]},crossLength:function(a,b){return a[0]*b[1]-a[1]*b[0]},rotate:function(a,b,c){var d=Math.cos(c),e=Math.sin(c);a[0]=d*b[0]-e*b[1],a[1]=e*b[0]+d*b[1]}}},{}],6:[function(a,b,c){function d(a,b,c){c=c||{},this.restLength=c.restLength||1,this.stiffness=c.stiffness||100,this.damping=c.damping||1,this.bodyA=a,this.bodyB=b}function e(a){a=a||{},this.id=++e._idCounter,this.shape=a.shape,this.mass=a.mass||0,this.invMass=this.mass>0?1/this.mass:0,this.inertia=a.inertia||this.mass,this.invInertia=this.invMass,this.position=a.position||g.create(),this.velocity=a.velocity||g.create(),this.vlambda=g.create(),this.wlambda=0,this.angle=a.angle||0,this.angularVelocity=a.angularVelocity||0,this.force=a.force||g.create(),this.angularForce=a.angularForce||0,this.motionState=0==this.mass?e.MotionState.STATIC:e.MotionState.DYNAMIC}var f=a("gl-matrix"),g=f.vec2;c.Body=e,c.Spring=d,e._idCounter=0,e.MotionState={DYNAMIC:1,STATIC:2,KINEMATIC:4};var h=g.create();e.prototype.applyForce=function(a,b){var c=h;g.sub(c,b,this.position),g.add(this.force,this.force,a);var d=g.crossLength(c,a);this.angularForce+=d}},{"gl-matrix":15}],7:[function(a,b,c){var d=a("gl-matrix"),e=a("../gl-matrix-extensions"),f=e.vec2,g=d.vec2,h=d.mat2,i=g.create();h.create();var j=g.create(),k=g.fromValues(0,1);c.checkCircleCircle=function(a,b,c){g.sub(i,a.position,b.position);var d=a.shape.radius,e=b.shape.radius;g.sqrLen(i)<(d+e)*(d+e)&&(c.push(a),c.push(b))},c.checkCirclePlane=function(a,b,c){g.sub(i,a.position,b.position),f.rotate(j,k,b.angle),g.dot(i,j)<=a.shape.radius&&(c.push(a),c.push(b))},c.checkCircleParticle=function(a,b,c){c.push(a),c.push(b)},c.nearphaseCircleCircle=function(a,b,c,d){var e=d.length?d.pop():new p2.ContactEquation(a,b);e.bi=a,e.bj=b,g.sub(e.ni,b.position,a.position),g.normalize(e.ni,e.ni),g.scale(e.ri,e.ni,a.shape.radius),g.scale(e.rj,e.ni,-b.shape.radius),c.push(e)},c.nearphaseCircleParticle=function(){};var l=(h.create(),g.create()),m=g.create();c.nearphaseCirclePlane=function(a,b,c,d){var e=d.length?d.pop():new p2.ContactEquation(b,a);e.bi=b,e.bj=a;var h=l,i=m;f.rotate(e.ni,k,b.angle),g.scale(e.rj,e.ni,-a.shape.radius),g.sub(h,a.position,b.position);var j=g.dot(e.ni,h);g.scale(i,e.ni,j),g.sub(e.ri,h,i),c.push(e)},c.Broadphase=function(){},c.Broadphase.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!")}},{"../gl-matrix-extensions":16,"gl-matrix":15}],10:[function(a,b,c){var d=a("../objects/Shape").Circle,e=a("../objects/Shape").Plane,f=a("../objects/Shape").Particle,g=a("../collision/Broadphase"),h=g.Broadphase,i=a("gl-matrix");i.vec2,c.GridBroadphase=function(a,b,c,i,j,k){h.apply(this),j=j||10,k=k||10;var l=(b-a)/j,m=(i-c)/k;this.getCollisionPairs=function(h){for(var n=[],o=h.collidingBodies,p=p=o.length,q=[],r=j*k,s=0;r>s;s++)q.push([]);for(var t=j/(b-a),u=k/(i-c),s=0;s!==p;s++){var v=o[s],w=v.shape;if(void 0!==w)if(w instanceof d)for(var x=v.position[0],y=v.position[1],z=w.radius,A=Math.floor(t*(x-z-a)),B=Math.floor(u*(y-z-c)),C=Math.floor(t*(x+z-a)),D=Math.floor(u*(y+z-c)),E=A;C>=E;E++)for(var F=B;D>=F;F++){var G=E,H=F;G*(k-1)+H>=0&&r>G*(k-1)+H&&q[G*(k-1)+H].push(v)}else{if(!(w instanceof e))throw new Error("Shape not supported in GridBroadphase!");if(0==v.angle)for(var y=v.position[1],E=0;E!==r&&y>c+m*(E-1);E++)for(var F=0;j>F;F++){var G=F,H=Math.floor(u*(m*E-c));q[G*(k-1)+H].push(v)}else if(v.angle==.5*Math.PI)for(var x=v.position[0],E=0;E!==r&&x>a+l*(E-1);E++)for(var F=0;k>F;F++){var H=F,G=Math.floor(t*(l*E-a));q[G*(k-1)+H].push(v)}else for(var E=0;E!==r;E++)q[E].push(v)}}for(var s=0;s!==r;s++)for(var I=q[s],E=0,J=I.length;E!==J;E++)for(var v=I[E],w=v.shape,F=0;F!==E;F++){var K=I[F],L=K.shape;w instanceof d?L instanceof d?g.checkCircleCircle(v,K,n):L instanceof f?g.checkCircleParticle(v,K,n):L instanceof e&&g.checkCirclePlane(v,K,n):w instanceof f?L instanceof d&&g.checkCircleParticle(K,v,n):w instanceof e&&L instanceof d&&g.checkCirclePlane(K,v,n)}return n}},c.GridBroadphase.prototype=new h},{"../objects/Shape":1,"../collision/Broadphase":7,"gl-matrix":15}],8:[function(a,b,c){function d(a,b){e.call(this,a,b,0,1e6),this.penetration=0,this.ri=g.create(),this.penetrationVec=g.create(),this.rj=g.create(),this.ni=g.create(),this.rixn=g.create(),this.rjxn=g.create(),this.rixw=g.create(),this.rjxw=g.create(),this.relVel=g.create(),this.relForce=g.create()}var e=a("./Equation").Equation,f=a("gl-matrix"),g=f.vec2,h=a("../gl-matrix-extensions"),i=h.vec2;c.ContactEquation=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeB=function(a,b,c){var d=this.bi,e=this.bj,f=this.ri,h=this.rj,j=d.position,k=e.position,l=d.velocity,m=d.angularVelocity,n=d.force,o=d.angularForce,p=e.velocity,q=e.angularVelocity,r=e.force,s=e.angularForce,t=(this.relVel,this.relForce,this.penetrationVec),u=d.invMass,v=e.invMass,w=d.invInertia,x=e.invInertia,y=this.ni,z=this.rixn=i.crossLength(f,y),A=this.rjxn=i.crossLength(h,y);g.set(t,0,0),g.add(t,k,h),g.sub(t,t,j),g.sub(t,t,f);var B=g.dot(y,t),C=g.dot(p,y)-g.dot(l,y)+q*A-m*z,D=g.dot(r,y)*v-g.dot(n,y)*u+x*s*A-w*o*z,E=-B*a-C*b-c*D;return E},d.prototype.computeC=function(a){var b=this.bi,c=this.bj,d=this.rixn,e=this.rjxn,f=b.invMass,g=c.invMass,h=f+g+a,i=b.invInertia,j=c.invInertia;return h+=i*d*d,h+=j*e*e};var j=g.create();d.prototype.computeGWlambda=function(){var a=this.bi,b=this.bj,c=j,d=0;return g.sub(c,b.vlambda,a.vlambda),d+=g.dot(c,this.ni),d-=a.wlambda*this.rixn,d+=b.wlambda*this.rjxn};var k=g.create();d.prototype.addToWlambda=function(a){var b=this.bi,c=this.bj,d=this.rixn,e=this.rjxn,f=b.invMass,h=c.invMass,i=this.ni,j=k;g.scale(j,i,f*a),g.sub(b.vlambda,b.vlambda,j),g.scale(j,i,h*a),g.add(c.vlambda,c.vlambda,j),b.wlambda-=b.invInertia*d*a,c.wlambda+=c.invInertia*e*a}},{"./Equation":3,"../gl-matrix-extensions":16,"gl-matrix":15}],9:[function(a,b,c){function d(a,b,c,d){e.call(this,a,b),"undefined"==typeof d&&(d=1e6);var h=this.equations=[new f(a,b)],i=h[0];i.minForce=-d,i.maxForce=d,this.update=function(){g.subtract(i.ni,b.position,a.position),g.normalize(i.ni,i.ni),g.scale(i.ri,i.ni,.5*c),g.scale(i.rj,i.ni,.5*-c)}}var e=a("./Constraint").Constraint,f=a("./ContactEquation").ContactEquation,g=a("gl-matrix").vec2;c.DistanceConstraint=d,d.prototype=new e},{"./Constraint":2,"./ContactEquation":8,"gl-matrix":15}],11:[function(a,b,c){function d(a){g.call(this),a=a||{},this.iterations=a.iterations||10,this.h=a.timeStep||1/60,this.k=a.stiffness||1e7,this.d=a.relaxation||6,this.a=0,this.b=0,this.eps=0,this.tolerance=a.tolerance||0,this.setSpookParams(this.k,this.d),this.debug=a.debug||!1,this.arrayStep=30,this.lambda=new h(this.arrayStep),this.Bs=new h(this.arrayStep),this.invCs=new h(this.arrayStep)}var e=a("gl-matrix"),f=e.vec2,g=a("./Solver").Solver;c.GSSolver=d;var h=Float32Array||Array;d.prototype=new g,d.prototype.setSpookParams=function(a,b){var c=this.h;this.k=a,this.d=b,this.a=4/(c*(1+4*b)),this.b=4*b/(1+4*b),this.eps=4/(c*c*a*(1+4*b))},d.prototype.solve=function(a,b,c){var d=(this.d,this.k,0),e=this.iterations,g=this.tolerance*this.tolerance,i=this.a,j=this.b,k=this.eps,l=this.equations,m=l.length,n=b.bodies,o=b.bodies.length,p=a;this.lambda.length<m&&(this.lambda=new h(m+this.arrayStep),this.Bs=new h(m+this.arrayStep),this.invCs=new h(m+this.arrayStep));for(var q=this.invCs,r=this.Bs,s=this.lambda,t=0;t!==m;t++){var u=l[t];s[t]=0,r[t]=u.computeB(i,j,p),q[t]=1/u.computeC(k)}var v,u,w,x,y,z,A;if(0!==m){var t,B,C,D,E;for(t=0;t!==o;t++){var j=n[t],F=j.vlambda;f.set(F,0,0),j.wlambda=0}for(d=0;d!==e;d++){for(y=0,B=0;B!==m;B++)u=l[B],D=u.maxForce,C=u.minForce,v=r[B],w=q[B],A=s[B],z=u.computeGWlambda(k),x=w*(v-z-k*A),E=A+x,C>E?x=C-A:E>D&&(x=D-A),s[B]+=x,y+=Math.abs(x),u.addToWlambda(x);if(g>=y*y)break}for(t=0;t!==o;t++){var j=n[t],G=j.velocity;f.add(G,G,j.vlambda),j.angularVelocity+=j.wlambda}}errorTot=y,c()}},{"./Solver":4,"gl-matrix":15}],12:[function(a,b,c){var d=a("../objects/Shape").Circle,e=a("../objects/Shape").Plane,f=a("../collision/Broadphase"),g=f.Broadphase,h=a("gl-matrix");h.vec2,c.NaiveBroadphase=function(){g.apply(this),this.getCollisionPairs=function(a){for(var b=a.collidingBodies,c=[],g=0,h=b.length;g!==h;g++){var i=b[g],j=i.shape;if(void 0!==j)for(var k=0;k!==g;k++){var l=b[k],m=l.shape;void 0!==m&&(j instanceof d?m instanceof d?f.checkCircleCircle(i,l,c):m instanceof Particle?f.checkCircleParticle(i,l,c):m instanceof e&&f.checkCirclePlane(i,l,c):j instanceof Particle?m instanceof d&&f.checkCircleParticle(l,i,c):j instanceof e&&m instanceof d&&f.checkCirclePlane(l,i,c))}}return c}},c.NaiveBroadphase.prototype=new g},{"../objects/Shape":1,"../collision/Broadphase":7,"gl-matrix":15}],13:[function(a,b,c){function d(a,b,c){function d(a){var b=e._workers.indexOf(this),c=e._workerIslandGroups[b];
c.applyResult(a.data),c.reset(),e._workerData[b]=a.data,e._numWorking--,0==e._numWorking&&e._stepDoneCallback()}j.call(this),b=b||2,c=c||"p2.js";var e=this;this.subsolver=a,this.numIslands=0,this._nodePool=[],this._workers=[],this._workerData=[],this._workerBodies=[],this._workerIslandGroups=[],this._numWorking=0,this._stepDoneCallback=function(){};for(var f=new Blob([['importScripts("'+c+'");',"var id = 0; // Worker id","var dt = 1/60; // Solve timestep","var islandGroup = new p2.IslandGroup();","var solver;","this.onmessage = function(e){","    var that=this;",'    if(typeof(e.data.id)!="undefined"){',"        id = parseInt(e.data.id);","        dt = e.data.timeStep;","        solver = new p2.GSSolver(); // Todo: user picked solver","        solver.setSpookParams(1e10,3);","        solver.iterations = 20;","        return;","    } else {","        // Parse islands and solve","        var array = e.data;","        islandGroup.fromArray(array);","        islandGroup.solve(dt,solver,function(){","            islandGroup.resultToArray(array);","            that.postMessage(array,[array.buffer]);","            islandGroup.reset();","        });","    }","};"].join("\n")],{type:"text/javascript"}),g=window.URL.createObjectURL(f),h=0;b>h;h++){var k=new Worker(g);k.onmessage=d,k.postMessage({id:h,timeStep:1/60});var l=new Float32Array(100);this._workers.push(k),this._workerData.push(l),this._workerIslandGroups.push(new i)}}function e(a){for(var b=a.length,c=0;c!==b;c++){var d=a[c];if(!(d.visited||d.body.motionState&n))return d}return!1}function f(a,b){var c=[];for(c.push(a),a.visited=!0,b(a);c.length;)for(var d,f=c.pop();d=e(f.children);)d.visited=!0,b(d),c.push(d)}function g(a,b){return a.length<b?new Float32Array(b+h.ARRAY_CHUNK):a}function h(){this.equations=[],this.bodies=[],this._contactEquationPool=[],this._bodyPool=[]}function i(){this.islands=[],this._islandPool=[]}var j=a("./Solver").Solver,k=a("../constraints/ContactEquation").ContactEquation,l=a("gl-matrix").vec2,m=a("../objects/Body").Body,n=m.MotionState.STATIC;c.ParallelIslandSolver=d,c.Island=h,c.IslandGroup=i,d.prototype=new j,d.prototype.solve=function(a,b,c){function d(a){A.push(a.body);for(var b=a.eqs.length,c=0;c!==b;c++){var d=a.eqs[c];-1===z.indexOf(d)&&z.push(d)}}var i=[],j=b.bodies,k=this.equations,l=k.length,m=j.length,n=(this.subsolver,this._workers),o=this._workerData,p=this._workerIslandGroups;this._stepDoneCallback=c;for(var q=0;q!==m;q++)this._nodePool.length?i.push(this._nodePool.pop()):i.push({body:j[q],children:[],eqs:[],visited:!1});for(var q=0;q!==m;q++){var r=i[q];r.body=j[q],r.children.length=0,r.eqs.length=0,r.visited=!1}for(var s=0;s!==l;s++){var t=k[s],q=j.indexOf(t.bi),u=j.indexOf(t.bj),v=i[q],w=i[u];v.children.push(w),v.eqs.push(t),w.children.push(v),w.eqs.push(t)}for(var x,y=0,z=[],A=[],q=0;q<p.length;q++)p[q].reset();for(var B=[];x=e(i);){var C=new h;z.length=0,A.length=0,f(x,d);for(var D=z.length,q=0;q!==D;q++){var t=z[q];C.equations.push(t)}y++,B.push(C)}this.numIslands=y;for(var E=[],F=[],q=0;q<n.length;q++)E[q]=0,F.push([]);for(;B.length;){for(var C=B.pop(),G=1/0,H=0,q=0;q<n.length;q++){var I=p[q].numEquations();G>I&&(G=I,H=q)}p[H].islands.push(C)}for(var q=0;q!==n.length;q++){var J=p[q];if(J.islands.length){var K=J.storageSize();o[q]=g(o[q],K),J.toArray(o[q]),this._numWorking++,n[q].postMessage(o[q],[o[q].buffer])}}},h.ARRAY_CHUNK=0,h.EquationTypes={CONTACT:1},h.getEquationTypes=function(){var a=[];for(var b in h.EquationTypes)a.push(h.EquationTypes[b]);return a},h.NUMBERS_PER_BODY=12,h.NUMBERS_PER_EQUATION={1:11},h.prototype.reset=function(){for(;this.bodies.length;)this._bodyPool.push(this.bodies.pop());for(;this.equations.length;)this._contactEquationPool.push(this.equations.pop())},h.prototype.fromArray=function(a,b){b=b||0,this.reset();for(var c=b,d=a[c++],e=a[c++],f={},g=0;e>g;g++){var i=this._bodyPool.pop()||new m;i.id=a[c++],l.set(i.position,a[c++],a[c++]),l.set(i.velocity,a[c++],a[c++]),i.angle=a[c++],i.angularVelocity=a[c++],i.mass=a[c++],i.inertia=a[c++],i.mass<0&&(i.mass=0),i.inertia<0&&(i.inertia=0),l.set(i.force,a[c++],a[c++]),i.angularForce=a[c++],i.invMass=i.mass>0?1/i.mass:0,i.invInertia=i.inertia>0?1/i.inertia:0,this.bodies.push(i),f[i.id+""]=i}var j=h.getEquationTypes();if(c>a.length)throw new Error("Trying to read element "+c+" of an array of length "+a.length);for(var g=0;d>g;g++){var n=a[c++];if(-1===j.indexOf(n))throw new Error("Equation "+g+" (out of "+d+") type not recognized: "+n);var o,p=a[c++],q=a[c++],r=a[c++],s=a[c++];switch(n){case h.EquationTypes.CONTACT:o=this._contactEquationPool.pop()||new k,l.set(o.ri,a[c++],a[c++]),l.set(o.rj,a[c++],a[c++]),l.set(o.ni,a[c++],a[c++]);break;default:throw new Error("Equation type not recognized: "+n)}if(o.bi=f[p+""],o.bj=f[q+""],!o.bi)throw new Error("Body "+p+" not found");if(!o.bj)throw new Error("Body "+q+" not found");o.minForce=r,o.maxForce=s,this.equations.push(o)}return c},h.prototype.toArray=function(a,b){var c=b,d=this.getBodies(),e=d.length,f=this.equations.length;a[c++]=f,a[c++]=e;for(var g=0;e>g;g++){var i=d[g],j=i.position,l=i.velocity;a[c++]=i.id,a[c++]=j[0],a[c++]=j[1],a[c++]=l[0],a[c++]=l[1],a[c++]=i.angle,a[c++]=i.angularVelocity,a[c++]=i.mass,a[c++]=i.inertia,a[c++]=i.force[0],a[c++]=i.force[1],a[c++]=i.angularForce}for(var g=0;f>g;g++){var m,n=this.equations[g];if(!(n instanceof k))throw new Error("Equation type not recognized");switch(m=h.EquationTypes.CONTACT,a[c++]=m,a[c++]=n.bi.id,a[c++]=n.bj.id,a[c++]=n.minForce,a[c++]=n.maxForce,m){case h.EquationTypes.CONTACT:a[c++]=n.ri[0],a[c++]=n.ri[1],a[c++]=n.rj[0],a[c++]=n.rj[1],a[c++]=n.ni[0],a[c++]=n.ni[1];break;default:throw new Error("Equation type not recognized: "+m)}}return c},h.prototype.storageSize=function(){var a=2;a+=h.NUMBERS_PER_BODY*this.getBodies().length;for(var b=this.equations,c=b.length,d=0;d!==c;d++){var e=b[d];if(!(e instanceof k))throw new Error("Equation type not recognized!");a+=h.NUMBERS_PER_EQUATION[h.EquationTypes.CONTACT]}return a},h.prototype.getBodies=function(){for(var a=[],b=[],c=this.equations,d=0;d!==c.length;d++){var e=c[d];-1===b.indexOf(e.bi.id)&&(a.push(e.bi),b.push(e.bi.id)),-1===b.indexOf(e.bj.id)&&(a.push(e.bj),b.push(e.bj.id))}return a},i.prototype.reset=function(){for(;this.islands.length;){var a=this.islands.pop();a.reset(),this._islandPool.push(a)}},i.prototype.numEquations=function(){for(var a=this.islands,b=a.length,c=0,d=0;d!==b;d++)c+=a[d].equations.length;return c},i.prototype.storageSize=function(){for(var a=this.islands,b=1,c=0;c<a.length;c++)b+=a[c].storageSize();return b},i.prototype.toArray=function(a){var b=this.islands,c=0;a[c++]=this.islands.length;for(var d=0;d<b.length;d++){var e=b[d];c+=e.toArray(a,c)}},i.prototype.fromArray=function(a){var b=this.islands;this.reset();for(var c=0,d=a[c++];b.length<d;)this.islands.push(this._islandPool.pop()||new h);for(var e=0;d>e;e++){var f=this.islands[e];c=f.fromArray(a,c)}},i.prototype.solve=function(a,b,c){var d=this.islands,e=d.length,f=[];b.removeAllEquations();for(var g=0;g!==e;g++){for(var h=d[g],i=h.equations.length,j=0;j!==i;j++)b.addEquation(h.equations[j]);for(var k=h.getBodies(),l=k.length,j=0;j!==l;j++)f.push(k[j])}b.solve(a,{bodies:f},c)},i.prototype.resultToArray=function(a){for(var b=this.islands,c=b.length,d=0,e=0;e!==c;e++)for(var f=b[e].getBodies(),g=f.length,h=0;h!==g;h++){var i=f[h],j=i.vlambda;a[d++]=j[0],a[d++]=j[1],a[d++]=i.wlambda}},i.prototype.applyResult=function(a){for(var b=this.islands,c=b.length,d=0,e="",f=0;f!==c;f++)for(var g=b[f].getBodies(),h=g.length,i=0;i!==h;i++){var j=g[i],k=j.velocity,m=a[d++],n=a[d++],o=a[d++];e+=j.id+" ("+m+" "+n+") "+o+"\n",l.set(j.vlambda,m,n),l.add(k,k,j.vlambda),j.wlambda=o,j.angularVelocity+=o}}},{"./Solver":4,"../constraints/ContactEquation":8,"../objects/Body":6,"gl-matrix":15}],14:[function(a,b,c){function d(){return performance.now?performance.now():performance.webkitNow?performance.webkitNow():(new Date).getTime()}function e(a){a=a||{},this.springs=[],this.bodies=[],this.solver=a.solver||new f,this.contacts=[],this.oldContacts=[],this.collidingBodies=[],this.gravity=a.gravity||i.fromValues(0,-9.78),this.doProfiling=a.doProfiling||!1,this.lastStepTime=0,this.broadphase=a.broadphase||new g,this.constraints=[],this._constraintIdCounter=0,this._bodyIdCounter=0}var f=a("../solver/GSSolver").GSSolver,g=a("../collision/NaiveBroadphase").NaiveBroadphase,h=a("gl-matrix"),i=h.vec2,j=a("../objects/Shape").Circle,k=a("../objects/Shape").Plane,l=a("../objects/Shape").Particle,m=a("../collision/Broadphase");m.Broadphase,c.World=e,e.prototype.addConstraint=function(a){this.constraints.push(a),a.id=this._constraintIdCounter++},e.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);-1!==b&&this.constraints.splice(b,1)};var n=i.create(),o=i.create(),p=i.create(),q=i.create(),r=i.create(),s=i.create();e.prototype.step=function(a,b){var c,e,f=this.doProfiling,g=this.springs.length,h=this.springs,t=this.bodies,u=(this.collidingBodies,this.gravity),v=this.solver,w=this.bodies.length,x=this.broadphase,y=this.constraints;f&&(c=d());for(var z=0;z!==w;z++){var A=t[z].force;i.add(A,A,u)}for(var z=0;z!==g;z++){var B=h[z],C=B.stiffness,D=B.damping,E=B.restLength,F=B.bodyA,G=B.bodyB,H=n,I=o,J=p,K=q;i.sub(H,F.position,G.position),i.sub(J,F.velocity,G.velocity);var L=i.len(H);i.normalize(I,H),i.scale(K,I,C*(L-E)+D*i.dot(J,I)),i.sub(F.force,F.force,K),i.add(G.force,G.force,K)}for(var M=x.getCollisionPairs(this),N=this.contacts.concat(this.oldContacts),O=this.contacts=[],z=0,P=M.length;z!==P;z+=2){var Q=M[z],R=M[z+1],S=Q.shape,T=R.shape;S instanceof j?T instanceof j?m.nearphaseCircleCircle(Q,R,O,N):T instanceof l?m.nearphaseCircleParticle(Q,R,O,N):T instanceof k&&m.nearphaseCirclePlane(Q,R,O,N):S instanceof l?T instanceof j&&m.nearphaseCircleParticle(R,Q,O,N):S instanceof k&&T instanceof j&&m.nearphaseCirclePlane(R,Q,O,N)}this.oldContacts=N;for(var z=0,U=O.length;z!==U;z++)v.addEquation(O[z]);var V=y.length;for(z=0;z!==V;z++){var W=y[z];W.update();for(var X=0,Y=W.equations.length;X!==Y;X++){var Z=W.equations[X];v.addEquation(Z)}}v.solve(a,this,function(){v.removeAllEquations();for(var g=r,h=s,j=0;j!==w;j++){var k=t[j];if(k.mass>0){var l=1/k.mass,m=k.force,n=k.position,o=k.velocity;k.angularVelocity+=k.angularForce*k.invInertia*a,k.angle+=k.angularVelocity*a,i.scale(g,m,a*l),i.add(o,g,o),i.scale(h,o,a),i.add(n,n,h)}}for(var j=0;j!==w;j++){var p=t[j];i.set(p.force,0,0),p.angularForce=0}f&&(e=d(),this.lastStepTime=e-c),b()})},e.prototype.addSpring=function(a){this.springs.push(a)},e.prototype.removeSpring=function(a){var b=this.springs.indexOf(a);-1===b&&this.springs.splice(b,1)},e.prototype.addBody=function(a){this.bodies.push(a),this.collidingBodies.push(a)},e.prototype.removeBody=function(a){var b=this.bodies.indexOf(a);-1===b&&this.bodies.splice(b,1)}},{"../solver/GSSolver":11,"../collision/NaiveBroadphase":12,"../objects/Shape":1,"../collision/Broadphase":7,"gl-matrix":15}]},{},[5])(5)});