(function(t){if("function"==typeof bootstrap)bootstrap("p2",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeP2=t}else"undefined"!=typeof window?window.p2=t():global.p2=t()})(function(){var t;return function(t,r,n){function e(n,i){if(!r[n]){if(!t[n]){var o="function"==typeof require&&require;if(!i&&o)return o(n,!0);if(a)return a(n,!0);throw Error("Cannot find module '"+n+"'")}var s=r[n]={exports:{}};t[n][0].call(s.exports,function(r){var a=t[n][1][r];return e(a?a:r)},s,s.exports)}return r[n].exports}for(var a="function"==typeof require&&require,i=0;n.length>i;i++)e(n[i]);return e}({1:[function(t,r,n){n.Shape=function(){},n.Particle=function(){p2.Shape.apply(this)},n.Circle=function(t){p2.Shape.apply(this),this.radius=t||1},n.Plane=function(){p2.Shape.apply(this)}},{}],2:[function(t,r,n){function e(t,r,n,e){this.id=-1,this.minForce=n===void 0?-1e6:n,this.maxForce=e===void 0?1e6:e,this.bi=t,this.bj=r}n.Equation=e,e.prototype.constructor=e},{}],3:[function(t,r,n){function e(){this.equations=[]}n.Solver=e,e.prototype.solve=function(){return 0},e.prototype.addEquation=function(t){this.equations.push(t)},e.prototype.removeEquation=function(t){var r=this.equations.indexOf(t);-1!=r&&this.equations.splice(r,1)},e.prototype.removeAllEquations=function(){this.equations=[]}},{}],4:[function(t,r,n){n.Body=t("./objects/Body").Body,n.Broadphase=t("./collision/Broadphase").Broadphase,n.Circle=t("./objects/Shape").Circle,n.ContactEquation=t("./constraints/ContactEquation").ContactEquation,n.Equation=t("./constraints/Equation").Equation,n.GridBroadphase=t("./collision/GridBroadphase").GridBroadphase,n.GSSolver=t("./solver/GSSolver").GSSolver,n.NaiveBroadphase=t("./collision/NaiveBroadphase").NaiveBroadphase,n.Plane=t("./objects/Shape").Plane,n.Shape=t("./objects/Shape").Shape,n.Solver=t("./solver/Solver").Solver,n.Spring=t("./objects/Body").Spring,n.World=t("./world/World").World;var e=t("gl-matrix");n.vec2=e.vec2,n.mat2=e.mat2},{"./objects/Body":5,"./objects/Shape":1,"./collision/Broadphase":6,"./constraints/ContactEquation":7,"./constraints/Equation":2,"./solver/GSSolver":8,"./collision/NaiveBroadphase":9,"./collision/GridBroadphase":10,"./solver/Solver":3,"./world/World":11,"gl-matrix":12}],13:[function(t,r,n){n.vec2={getX:function(t){return t[0]},getY:function(t){return t[1]},crossLength:function(t,r){return t[0]*r[1]-t[1]*r[0]},rotate:function(t,r,n){var e=Math.cos(n),a=Math.sin(n);t[0]=e*r[0]-a*r[1],t[1]=a*r[0]+e*r[1]}}},{}],12:[function(r,n,e){(function(){(function(){"use strict";var r={};e===void 0?"function"==typeof t&&"object"==typeof t.amd&&t.amd?(r.exports={},t(function(){return r.exports})):r.exports=window:r.exports=e,function(t){var r={};if(!n)var n=1e-6;r.create=function(){return new Float32Array(2)},r.clone=function(t){var r=new Float32Array(2);return r[0]=t[0],r[1]=t[1],r},r.fromValues=function(t,r){var n=new Float32Array(2);return n[0]=t,n[1]=r,n},r.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t},r.set=function(t,r,n){return t[0]=r,t[1]=n,t},r.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t},r.sub=r.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t},r.mul=r.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t},r.div=r.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t},r.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t},r.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t},r.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t},r.dist=r.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return Math.sqrt(n*n+e*e)},r.sqrDist=r.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return n*n+e*e},r.len=r.length=function(t){var r=t[0],n=t[1];return Math.sqrt(r*r+n*n)},r.sqrLen=r.squaredLength=function(t){var r=t[0],n=t[1];return r*r+n*n},r.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t},r.normalize=function(t,r){var n=r[0],e=r[1],a=n*n+e*e;return a>0&&(a=1/Math.sqrt(a),t[0]=r[0]*a,t[1]=r[1]*a),t},r.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]},r.cross=function(t,r,n){var e=r[0]*n[1]-r[1]*n[0];return t[0]=t[1]=0,t[2]=e,t},r.lerp=function(t,r,n,e){var a=r[0],i=r[1];return t[0]=a+e*(n[0]-a),t[1]=i+e*(n[1]-i),t},r.transformMat2=function(t,r,n){var e=r[0],a=r[1];return t[0]=e*n[0]+a*n[1],t[1]=e*n[2]+a*n[3],t},r.forEach=function(){var t=new Float32Array(2);return function(r,n,e,a,i,o){var s,c;for(n||(n=2),e||(e=0),c=a?Math.min(a*n+e,r.length):r.length,s=e;c>s;s+=n)t[0]=r[s],t[1]=r[s+1],i(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}(),r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},t!==void 0&&(t.vec2=r);var e={};if(!n)var n=1e-6;e.create=function(){return new Float32Array(3)},e.clone=function(t){var r=new Float32Array(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},e.fromValues=function(t,r,n){var e=new Float32Array(3);return e[0]=t,e[1]=r,e[2]=n,e},e.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},e.set=function(t,r,n,e){return t[0]=r,t[1]=n,t[2]=e,t},e.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t},e.sub=e.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t[2]=r[2]-n[2],t},e.mul=e.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t[2]=r[2]*n[2],t},e.div=e.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t[2]=r[2]/n[2],t},e.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t},e.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t},e.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t},e.dist=e.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2];return Math.sqrt(n*n+e*e+a*a)},e.sqrDist=e.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2];return n*n+e*e+a*a},e.len=e.length=function(t){var r=t[0],n=t[1],e=t[2];return Math.sqrt(r*r+n*n+e*e)},e.sqrLen=e.squaredLength=function(t){var r=t[0],n=t[1],e=t[2];return r*r+n*n+e*e},e.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t},e.normalize=function(t,r){var n=r[0],e=r[1],a=r[2],i=n*n+e*e+a*a;return i>0&&(i=1/Math.sqrt(i),t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i),t},e.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},e.cross=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=n[0],s=n[1],c=n[2];return t[0]=a*c-i*s,t[1]=i*o-e*c,t[2]=e*s-a*o,t},e.lerp=function(t,r,n,e){var a=r[0],i=r[1],o=r[2];return t[0]=a+e*(n[0]-a),t[1]=i+e*(n[1]-i),t[2]=o+e*(n[2]-o),t},e.transformMat4=function(t,r,n){var e=r[0],a=r[1],i=r[2];return t[0]=n[0]*e+n[4]*a+n[8]*i+n[12],t[1]=n[1]*e+n[5]*a+n[9]*i+n[13],t[2]=n[2]*e+n[6]*a+n[10]*i+n[14],t},e.transformQuat=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=n[0],s=n[1],c=n[2],u=n[3],l=u*e+s*i-c*a,h=u*a+c*e-o*i,f=u*i+o*a-s*e,v=-o*e-s*a-c*i;return t[0]=l*u+v*-o+h*-c-f*-s,t[1]=h*u+v*-s+f*-o-l*-c,t[2]=f*u+v*-c+l*-s-h*-o,t},e.forEach=function(){var t=new Float32Array(3);return function(r,n,e,a,i,o){var s,c;for(n||(n=3),e||(e=0),c=a?Math.min(a*n+e,r.length):r.length,s=e;c>s;s+=n)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],i(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}(),e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t!==void 0&&(t.vec3=e);var a={};if(!n)var n=1e-6;a.create=function(){return new Float32Array(4)},a.clone=function(t){var r=new Float32Array(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},a.fromValues=function(t,r,n,e){var a=new Float32Array(4);return a[0]=t,a[1]=r,a[2]=n,a[3]=e,a},a.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},a.set=function(t,r,n,e,a){return t[0]=r,t[1]=n,t[2]=e,t[3]=a,t},a.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t},a.sub=a.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t[2]=r[2]-n[2],t[3]=r[3]-n[3],t},a.mul=a.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t[2]=r[2]*n[2],t[3]=r[3]*n[3],t},a.div=a.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t[2]=r[2]/n[2],t[3]=r[3]/n[3],t},a.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t[3]=Math.min(r[3],n[3]),t},a.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t[3]=Math.max(r[3],n[3]),t},a.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t},a.dist=a.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2],i=r[3]-t[3];return Math.sqrt(n*n+e*e+a*a+i*i)},a.sqrDist=a.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2],i=r[3]-t[3];return n*n+e*e+a*a+i*i},a.len=a.length=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return Math.sqrt(r*r+n*n+e*e+a*a)},a.sqrLen=a.squaredLength=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return r*r+n*n+e*e+a*a},a.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t},a.normalize=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=n*n+e*e+a*a+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=r[0]*o,t[1]=r[1]*o,t[2]=r[2]*o,t[3]=r[3]*o),t},a.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]},a.lerp=function(t,r,n,e){var a=r[0],i=r[1],o=r[2],s=r[3];return t[0]=a+e*(n[0]-a),t[1]=i+e*(n[1]-i),t[2]=o+e*(n[2]-o),t[3]=s+e*(n[3]-s),t},a.transformMat4=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3];return t[0]=n[0]*e+n[4]*a+n[8]*i+n[12]*o,t[1]=n[1]*e+n[5]*a+n[9]*i+n[13]*o,t[2]=n[2]*e+n[6]*a+n[10]*i+n[14]*o,t[3]=n[3]*e+n[7]*a+n[11]*i+n[15]*o,t},a.transformQuat=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=n[0],s=n[1],c=n[2],u=n[3],l=u*e+s*i-c*a,h=u*a+c*e-o*i,f=u*i+o*a-s*e,v=-o*e-s*a-c*i;return t[0]=l*u+v*-o+h*-c-f*-s,t[1]=h*u+v*-s+f*-o-l*-c,t[2]=f*u+v*-c+l*-s-h*-o,t},a.forEach=function(){var t=new Float32Array(4);return function(r,n,e,a,i,o){var s,c;for(n||(n=4),e||(e=0),c=a?Math.min(a*n+e,r.length):r.length,s=e;c>s;s+=n)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],i(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}(),a.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.vec4=a);var i={},o=new Float32Array([1,0,0,1]);if(!n)var n=1e-6;i.create=function(){return new Float32Array(o)},i.clone=function(t){var r=new Float32Array(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},i.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},i.transpose=function(t,r){if(t===r){var n=r[1];t[1]=r[2],t[2]=n}else t[0]=r[0],t[1]=r[2],t[2]=r[1],t[3]=r[3];return t},i.invert=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=n*i-a*e;return o?(o=1/o,t[0]=i*o,t[1]=-e*o,t[2]=-a*o,t[3]=n*o,t):null},i.adjoint=function(t,r){var n=r[0];return t[0]=r[3],t[1]=-r[1],t[2]=-r[2],t[3]=n,t},i.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},i.mul=i.multiply=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=n[0],c=n[1],u=n[2],l=n[3];return t[0]=e*s+a*u,t[1]=e*c+a*l,t[2]=i*s+o*u,t[3]=i*c+o*l,t},i.rotate=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=Math.sin(n),c=Math.cos(n);return t[0]=e*c+a*s,t[1]=e*-s+a*c,t[2]=i*c+o*s,t[3]=i*-s+o*c,t},i.scale=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=n[0],c=n[1];return t[0]=e*s,t[1]=a*c,t[2]=i*s,t[3]=o*c,t},i.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.mat2=i);var s={},c=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!n)var n=1e-6;s.create=function(){return new Float32Array(c)},s.clone=function(t){var r=new Float32Array(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},s.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.transpose=function(t,r){if(t===r){var n=r[1],e=r[2],a=r[5];t[1]=r[3],t[2]=r[6],t[3]=n,t[5]=r[7],t[6]=e,t[7]=a}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t},s.invert=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=r[4],s=r[5],c=r[6],u=r[7],l=r[8],h=l*o-s*u,f=-l*i+s*c,v=u*i-o*c,p=n*h+e*f+a*v;return p?(p=1/p,t[0]=h*p,t[1]=(-l*e+a*u)*p,t[2]=(s*e-a*o)*p,t[3]=f*p,t[4]=(l*n-a*c)*p,t[5]=(-s*n+a*i)*p,t[6]=v*p,t[7]=(-u*n+e*c)*p,t[8]=(o*n-e*i)*p,t):null},s.adjoint=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=r[4],s=r[5],c=r[6],u=r[7],l=r[8];return t[0]=o*l-s*u,t[1]=a*u-e*l,t[2]=e*s-a*o,t[3]=s*c-i*l,t[4]=n*l-a*c,t[5]=a*i-n*s,t[6]=i*u-o*c,t[7]=e*c-n*u,t[8]=n*o-e*i,t},s.determinant=function(t){var r=t[0],n=t[1],e=t[2],a=t[3],i=t[4],o=t[5],s=t[6],c=t[7],u=t[8];return r*(u*i-o*c)+n*(-u*a+o*s)+e*(c*a-i*s)},s.mul=s.multiply=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=r[4],c=r[5],u=r[6],l=r[7],h=r[8],f=n[0],v=n[1],p=n[2],d=n[3],m=n[4],y=n[5],g=n[6],b=n[7],M=n[8];return t[0]=f*e+v*o+p*u,t[1]=f*a+v*s+p*l,t[2]=f*i+v*c+p*h,t[3]=d*e+m*o+y*u,t[4]=d*a+m*s+y*l,t[5]=d*i+m*c+y*h,t[6]=g*e+b*o+M*u,t[7]=g*a+b*s+M*l,t[8]=g*i+b*c+M*h,t},s.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t!==void 0&&(t.mat3=s);var u={},l=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!n)var n=1e-6;u.create=function(){return new Float32Array(l)},u.clone=function(t){var r=new Float32Array(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},u.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.transpose=function(t,r){if(t===r){var n=r[1],e=r[2],a=r[3],i=r[6],o=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=n,t[6]=r[9],t[7]=r[13],t[8]=e,t[9]=i,t[11]=r[14],t[12]=a,t[13]=o,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},u.invert=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=r[4],s=r[5],c=r[6],u=r[7],l=r[8],h=r[9],f=r[10],v=r[11],p=r[12],d=r[13],m=r[14],y=r[15],g=n*s-e*o,b=n*c-a*o,M=n*u-i*o,x=e*c-a*s,w=e*u-i*s,q=a*u-i*c,C=l*d-h*p,S=l*m-f*p,B=l*y-v*p,j=h*m-f*d,P=h*y-v*d,F=f*y-v*m,A=g*F-b*P+M*j+x*B-w*S+q*C;return A?(A=1/A,t[0]=(s*F-c*P+u*j)*A,t[1]=(a*P-e*F-i*j)*A,t[2]=(d*q-m*w+y*x)*A,t[3]=(f*w-h*q-v*x)*A,t[4]=(c*B-o*F-u*S)*A,t[5]=(n*F-a*B+i*S)*A,t[6]=(m*M-p*q-y*b)*A,t[7]=(l*q-f*M+v*b)*A,t[8]=(o*P-s*B+u*C)*A,t[9]=(e*B-n*P-i*C)*A,t[10]=(p*w-d*M+y*g)*A,t[11]=(h*M-l*w-v*g)*A,t[12]=(s*S-o*j-c*C)*A,t[13]=(n*j-e*S+a*C)*A,t[14]=(d*b-p*x-m*g)*A,t[15]=(l*x-h*b+f*g)*A,t):null},u.adjoint=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=r[4],s=r[5],c=r[6],u=r[7],l=r[8],h=r[9],f=r[10],v=r[11],p=r[12],d=r[13],m=r[14],y=r[15];return t[0]=s*(f*y-v*m)-h*(c*y-u*m)+d*(c*v-u*f),t[1]=-(e*(f*y-v*m)-h*(a*y-i*m)+d*(a*v-i*f)),t[2]=e*(c*y-u*m)-s*(a*y-i*m)+d*(a*u-i*c),t[3]=-(e*(c*v-u*f)-s*(a*v-i*f)+h*(a*u-i*c)),t[4]=-(o*(f*y-v*m)-l*(c*y-u*m)+p*(c*v-u*f)),t[5]=n*(f*y-v*m)-l*(a*y-i*m)+p*(a*v-i*f),t[6]=-(n*(c*y-u*m)-o*(a*y-i*m)+p*(a*u-i*c)),t[7]=n*(c*v-u*f)-o*(a*v-i*f)+l*(a*u-i*c),t[8]=o*(h*y-v*d)-l*(s*y-u*d)+p*(s*v-u*h),t[9]=-(n*(h*y-v*d)-l*(e*y-i*d)+p*(e*v-i*h)),t[10]=n*(s*y-u*d)-o*(e*y-i*d)+p*(e*u-i*s),t[11]=-(n*(s*v-u*h)-o*(e*v-i*h)+l*(e*u-i*s)),t[12]=-(o*(h*m-f*d)-l*(s*m-c*d)+p*(s*f-c*h)),t[13]=n*(h*m-f*d)-l*(e*m-a*d)+p*(e*f-a*h),t[14]=-(n*(s*m-c*d)-o*(e*m-a*d)+p*(e*c-a*s)),t[15]=n*(s*f-c*h)-o*(e*f-a*h)+l*(e*c-a*s),t},u.determinant=function(t){var r=t[0],n=t[1],e=t[2],a=t[3],i=t[4],o=t[5],s=t[6],c=t[7],u=t[8],l=t[9],h=t[10],f=t[11],v=t[12],p=t[13],d=t[14],m=t[15],y=r*o-n*i,g=r*s-e*i,b=r*c-a*i,M=n*s-e*o,x=n*c-a*o,w=e*c-a*s,q=u*p-l*v,C=u*d-h*v,S=u*m-f*v,B=l*d-h*p,j=l*m-f*p,P=h*m-f*d;return y*P-g*j+b*B+M*S-x*C+w*q},u.mul=u.multiply=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=r[4],c=r[5],u=r[6],l=r[7],h=r[8],f=r[9],v=r[10],p=r[11],d=r[12],m=r[13],y=r[14],g=r[15],b=n[0],M=n[1],x=n[2],w=n[3];return t[0]=b*e+M*s+x*h+w*d,t[1]=b*a+M*c+x*f+w*m,t[2]=b*i+M*u+x*v+w*y,t[3]=b*o+M*l+x*p+w*g,b=n[4],M=n[5],x=n[6],w=n[7],t[4]=b*e+M*s+x*h+w*d,t[5]=b*a+M*c+x*f+w*m,t[6]=b*i+M*u+x*v+w*y,t[7]=b*o+M*l+x*p+w*g,b=n[8],M=n[9],x=n[10],w=n[11],t[8]=b*e+M*s+x*h+w*d,t[9]=b*a+M*c+x*f+w*m,t[10]=b*i+M*u+x*v+w*y,t[11]=b*o+M*l+x*p+w*g,b=n[12],M=n[13],x=n[14],w=n[15],t[12]=b*e+M*s+x*h+w*d,t[13]=b*a+M*c+x*f+w*m,t[14]=b*i+M*u+x*v+w*y,t[15]=b*o+M*l+x*p+w*g,t},u.translate=function(t,r,n){var e,a,i,o,s,c,u,l,h,f,v,p,d=n[0],m=n[1],y=n[2];return r===t?(t[12]=r[0]*d+r[4]*m+r[8]*y+r[12],t[13]=r[1]*d+r[5]*m+r[9]*y+r[13],t[14]=r[2]*d+r[6]*m+r[10]*y+r[14],t[15]=r[3]*d+r[7]*m+r[11]*y+r[15]):(e=r[0],a=r[1],i=r[2],o=r[3],s=r[4],c=r[5],u=r[6],l=r[7],h=r[8],f=r[9],v=r[10],p=r[11],t[0]=e,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=c,t[6]=u,t[7]=l,t[8]=h,t[9]=f,t[10]=v,t[11]=p,t[12]=e*d+s*m+h*y+r[12],t[13]=a*d+c*m+f*y+r[13],t[14]=i*d+u*m+v*y+r[14],t[15]=o*d+l*m+p*y+r[15]),t},u.scale=function(t,r,n){var e=n[0],a=n[1],i=n[2];return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=r[7]*a,t[8]=r[8]*i,t[9]=r[9]*i,t[10]=r[10]*i,t[11]=r[11]*i,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},u.rotate=function(t,r,e,a){var i,o,s,c,u,l,h,f,v,p,d,m,y,g,b,M,x,w,q,C,S,B,j,P,F=a[0],A=a[1],E=a[2],k=Math.sqrt(F*F+A*A+E*E);return n>Math.abs(k)?null:(k=1/k,F*=k,A*=k,E*=k,i=Math.sin(e),o=Math.cos(e),s=1-o,c=r[0],u=r[1],l=r[2],h=r[3],f=r[4],v=r[5],p=r[6],d=r[7],m=r[8],y=r[9],g=r[10],b=r[11],M=F*F*s+o,x=A*F*s+E*i,w=E*F*s-A*i,q=F*A*s-E*i,C=A*A*s+o,S=E*A*s+F*i,B=F*E*s+A*i,j=A*E*s-F*i,P=E*E*s+o,t[0]=c*M+f*x+m*w,t[1]=u*M+v*x+y*w,t[2]=l*M+p*x+g*w,t[3]=h*M+d*x+b*w,t[4]=c*q+f*C+m*S,t[5]=u*q+v*C+y*S,t[6]=l*q+p*C+g*S,t[7]=h*q+d*C+b*S,t[8]=c*B+f*j+m*P,t[9]=u*B+v*j+y*P,t[10]=l*B+p*j+g*P,t[11]=h*B+d*j+b*P,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},u.rotateX=function(t,r,n){var e=Math.sin(n),a=Math.cos(n),i=r[4],o=r[5],s=r[6],c=r[7],u=r[8],l=r[9],h=r[10],f=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=i*a+u*e,t[5]=o*a+l*e,t[6]=s*a+h*e,t[7]=c*a+f*e,t[8]=u*a-i*e,t[9]=l*a-o*e,t[10]=h*a-s*e,t[11]=f*a-c*e,t},u.rotateY=function(t,r,n){var e=Math.sin(n),a=Math.cos(n),i=r[0],o=r[1],s=r[2],c=r[3],u=r[8],l=r[9],h=r[10],f=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=i*a-u*e,t[1]=o*a-l*e,t[2]=s*a-h*e,t[3]=c*a-f*e,t[8]=i*e+u*a,t[9]=o*e+l*a,t[10]=s*e+h*a,t[11]=c*e+f*a,t},u.rotateZ=function(t,r,n){var e=Math.sin(n),a=Math.cos(n),i=r[0],o=r[1],s=r[2],c=r[3],u=r[4],l=r[5],h=r[6],f=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=i*a+u*e,t[1]=o*a+l*e,t[2]=s*a+h*e,t[3]=c*a+f*e,t[4]=u*a-i*e,t[5]=l*a-o*e,t[6]=h*a-s*e,t[7]=f*a-c*e,t},u.fromRotationTranslation=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=e+e,c=a+a,u=i+i,l=e*s,h=e*c,f=e*u,v=a*c,p=a*u,d=i*u,m=o*s,y=o*c,g=o*u;return t[0]=1-(v+d),t[1]=h+g,t[2]=f-y,t[3]=0,t[4]=h-g,t[5]=1-(l+d),t[6]=p+m,t[7]=0,t[8]=f+y,t[9]=p-m,t[10]=1-(l+v),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},u.frustum=function(t,r,n,e,a,i,o){var s=1/(n-r),c=1/(a-e),u=1/(i-o);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*c,t[6]=0,t[7]=0,t[8]=(n+r)*s,t[9]=(a+e)*c,t[10]=(o+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*i*u,t[15]=0,t},u.perspective=function(t,r,n,e,a){var i=1/Math.tan(r/2),o=1/(e-a);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+e)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*e*o,t[15]=0,t},u.ortho=function(t,r,n,e,a,i,o){var s=1/(r-n),c=1/(e-a),u=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(r+n)*s,t[13]=(a+e)*c,t[14]=(o+i)*u,t[15]=1,t},u.lookAt=function(t,r,e,a){var i,o,s,c,l,h,f,v,p,d,m=r[0],y=r[1],g=r[2],b=a[0],M=a[1],x=a[2],w=e[0],q=e[1],C=e[2];return n>Math.abs(m-w)&&n>Math.abs(y-q)&&n>Math.abs(g-C)?u.identity(t):(f=m-w,v=y-q,p=g-C,d=1/Math.sqrt(f*f+v*v+p*p),f*=d,v*=d,p*=d,i=M*p-x*v,o=x*f-b*p,s=b*v-M*f,d=Math.sqrt(i*i+o*o+s*s),d?(d=1/d,i*=d,o*=d,s*=d):(i=0,o=0,s=0),c=v*s-p*o,l=p*i-f*s,h=f*o-v*i,d=Math.sqrt(c*c+l*l+h*h),d?(d=1/d,c*=d,l*=d,h*=d):(c=0,l=0,h=0),t[0]=i,t[1]=c,t[2]=f,t[3]=0,t[4]=o,t[5]=l,t[6]=v,t[7]=0,t[8]=s,t[9]=h,t[10]=p,t[11]=0,t[12]=-(i*m+o*y+s*g),t[13]=-(c*m+l*y+h*g),t[14]=-(f*m+v*y+p*g),t[15]=1,t)},u.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t!==void 0&&(t.mat4=u);var h={},f=new Float32Array([0,0,0,1]);if(!n)var n=1e-6;h.create=function(){return new Float32Array(f)},h.clone=a.clone,h.fromValues=a.fromValues,h.copy=a.copy,h.set=a.set,h.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.setAxisAngle=function(t,r,n){n=.5*n;var e=Math.sin(n);return t[0]=e*r[0],t[1]=e*r[1],t[2]=e*r[2],t[3]=Math.cos(n),t},h.add=a.add,h.mul=h.multiply=function(t,r,n){var e=r[0],a=r[1],i=r[2],o=r[3],s=n[0],c=n[1],u=n[2],l=n[3];return t[0]=e*l+o*s+a*u-i*c,t[1]=a*l+o*c+i*s-e*u,t[2]=i*l+o*u+e*c-a*s,t[3]=o*l-e*s-a*c-i*u,t},h.scale=a.scale,h.rotateX=function(t,r,n){n*=.5;var e=r[0],a=r[1],i=r[2],o=r[3],s=Math.sin(n),c=Math.cos(n);return t[0]=e*c+o*s,t[1]=a*c+i*s,t[2]=i*c-a*s,t[3]=o*c-e*s,t},h.rotateY=function(t,r,n){n*=.5;var e=r[0],a=r[1],i=r[2],o=r[3],s=Math.sin(n),c=Math.cos(n);return t[0]=e*c-i*s,t[1]=a*c+o*s,t[2]=i*c+e*s,t[3]=o*c-a*s,t},h.rotateZ=function(t,r,n){n*=.5;var e=r[0],a=r[1],i=r[2],o=r[3],s=Math.sin(n),c=Math.cos(n);return t[0]=e*c+a*s,t[1]=a*c-e*s,t[2]=i*c+o*s,t[3]=o*c-i*s,t},h.calculateW=function(t,r){var n=r[0],e=r[1],a=r[2];return t[0]=n,t[1]=e,t[2]=a,t[3]=-Math.sqrt(Math.abs(1-n*n-e*e-a*a)),t},h.dot=a.dot,h.lerp=a.lerp,h.slerp=function(t,r,n,e){var a,i,o,s,c=r[0],u=r[1],l=r[2],h=r[3],f=n[0],v=n[1],p=n[2],d=r[3],m=c*f+u*v+l*p+h*d;return Math.abs(m)>=1?(t!==r&&(t[0]=c,t[1]=u,t[2]=l,t[3]=h),t):(a=Math.acos(m),i=Math.sqrt(1-m*m),.001>Math.abs(i)?(t[0]=.5*c+.5*f,t[1]=.5*u+.5*v,t[2]=.5*l+.5*p,t[3]=.5*h+.5*d,t):(o=Math.sin((1-e)*a)/i,s=Math.sin(e*a)/i,t[0]=c*o+f*s,t[1]=u*o+v*s,t[2]=l*o+p*s,t[3]=h*o+d*s,t))},h.invert=function(t,r){var n=r[0],e=r[1],a=r[2],i=r[3],o=n*n+e*e+a*a+i*i,s=o?1/o:0;return t[0]=-n*s,t[1]=-e*s,t[2]=-a*s,t[3]=i*s,t},h.conjugate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t},h.len=h.length=a.length,h.sqrLen=h.squaredLength=a.squaredLength,h.normalize=a.normalize,h.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.quat=h)}(r.exports)})()})()},{}],5:[function(t,r,n){function e(t,r,n){n=n||{},this.restLength=n.restLength||1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=r}function a(t){t=t||{},this.shape=t.shape,this.mass=t.mass||0,this.invMass=this.mass>0?1/this.mass:0,this.inertia=t.inertia||this.mass,this.invInertia=this.invMass,this.position=t.position||o.create(),this.velocity=t.velocity||o.create(),this.vlambda=o.create(),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=t.force||o.create(),this.angularForce=t.angularForce||0}var i=t("gl-matrix"),o=i.vec2;n.Body=a,n.Spring=e;var s=o.create();a.prototype.applyForce=function(t,r){var n=s;o.sub(n,r,this.position),o.add(this.force,this.force,t);var e=o.crossLength(n,t);this.angularForce+=e}},{"gl-matrix":12}],6:[function(t,r,n){var e=t("gl-matrix"),a=t("../gl-matrix-extensions"),i=a.vec2,o=e.vec2,s=e.mat2,c=o.create();s.create();var u=o.create(),l=o.fromValues(0,1);n.checkCircleCircle=function(t,r,n){o.sub(c,t.position,r.position);var e=t.shape.radius,a=r.shape.radius;(e+a)*(e+a)>o.sqrLen(c)&&(n.push(t),n.push(r))},n.checkCirclePlane=function(t,r,n){o.sub(c,t.position,r.position),i.rotate(u,l,r.angle),o.dot(c,u)<=t.shape.radius&&(n.push(t),n.push(r))},n.checkCircleParticle=function(t,r,n){n.push(t),n.push(r)},n.nearphaseCircleCircle=function(t,r,n,e){var a=e.length?e.pop():new p2.ContactEquation(t,r);a.bi=t,a.bj=r,o.sub(a.ni,r.position,t.position),o.normalize(a.ni,a.ni),o.scale(a.ri,a.ni,t.shape.radius),o.scale(a.rj,a.ni,-r.shape.radius),n.push(a)},n.nearphaseCircleParticle=function(){};var h=(s.create(),o.create()),f=o.create();n.nearphaseCirclePlane=function(t,r,n,e){var a=e.length?e.pop():new p2.ContactEquation(r,t);a.bi=r,a.bj=t;var s=h,c=f;i.rotate(a.ni,l,r.angle),o.scale(a.rj,a.ni,-t.shape.radius),o.sub(s,t.position,r.position);var u=o.dot(a.ni,s);o.scale(c,a.ni,u),o.sub(a.ri,s,c),n.push(a)},n.Broadphase=function(){},n.Broadphase.prototype.getCollisionPairs=function(){throw Error("getCollisionPairs must be implemented in a subclass!")}},{"../gl-matrix-extensions":13,"gl-matrix":12}],9:[function(t,r,n){var e=(t("../objects/Shape").Circle,t("../objects/Shape").Plane,t("../collision/Broadphase")),a=e.Broadphase,i=t("gl-matrix");i.vec2,n.NaiveBroadphase=function(){a.apply(this),this.getCollisionPairs=function(t){for(var r=t.collidingBodies,n=[],a=0,i=r.length;a!==i;a++){var o=r[a],s=o.shape;if(void 0!==s)for(var c=0;c!==a;c++){var u=r[c],l=u.shape;void 0!==l&&(s instanceof e.Circle?l instanceof e.Circle?e.checkCircleCircle(o,u,n):l instanceof e.Particle?e.checkCircleParticle(o,u,n):l instanceof e.Plane&&e.checkCirclePlane(o,u,n):s instanceof e.Particle?l instanceof e.Circle&&e.checkCircleParticle(u,o,n):s instanceof e.Plane&&l instanceof e.Circle&&e.checkCirclePlane(u,o,n))}}return n}},n.NaiveBroadphase.prototype=new a},{"../objects/Shape":1,"../collision/Broadphase":6,"gl-matrix":12}],7:[function(t,r,n){function e(t,r){a.call(this,t,r,0,1e6),this.penetration=0,this.ri=o.create(),this.penetrationVec=o.create(),this.rj=o.create(),this.ni=o.create(),this.rixn=o.create(),this.rjxn=o.create(),this.rixw=o.create(),this.rjxw=o.create(),this.relVel=o.create(),this.relForce=o.create()}var a=t("./Equation").Equation,i=t("gl-matrix"),o=i.vec2,s=t("../gl-matrix-extensions"),c=s.vec2;n.ContactEquation=e,e.prototype=new a,e.prototype.constructor=e,e.prototype.computeB=function(t,r,n){var e=this.bi,a=this.bj,i=this.ri,s=this.rj,u=e.position,l=a.position,h=e.velocity,f=e.angularVelocity,v=e.force,p=e.angularForce,d=a.velocity,m=a.angularVelocity,y=a.force,g=a.angularForce,b=(this.relVel,this.relForce,this.penetrationVec),M=e.invMass,x=a.invMass,w=e.invInertia,q=a.invInertia,C=this.ni,S=this.rixn=c.crossLength(i,C),B=this.rjxn=c.crossLength(s,C);o.set(b,0,0),o.add(b,l,s),o.sub(b,b,u),o.sub(b,b,i);var j=o.dot(C,b),P=o.dot(d,C)-o.dot(h,C)+m*B-f*S,F=o.dot(y,C)*x-o.dot(v,C)*M+q*g*B-w*p*S,A=-j*t-P*r-n*F;return A},e.prototype.computeC=function(t){var r=this.bi,n=this.bj,e=this.rixn,a=this.rjxn,i=r.invMass,o=n.invMass,s=i+o+t,c=r.invInertia,u=n.invInertia;return s+=c*e*e,s+=u*a*a};var u=o.create();e.prototype.computeGWlambda=function(){var t=this.bi,r=this.bj,n=u,e=0;return o.sub(n,r.vlambda,t.vlambda),e+=o.dot(n,this.ni),e-=t.wlambda*this.rixn,e+=r.wlambda*this.rjxn};var l=o.create();e.prototype.addToWlambda=function(t){var r=this.bi,n=this.bj,e=this.rixn,a=this.rjxn,i=r.invMass,s=n.invMass,c=this.ni,u=l;o.scale(u,c,i*t),o.sub(r.vlambda,r.vlambda,u),o.scale(u,c,s*t),o.add(n.vlambda,n.vlambda,u),r.wlambda-=r.invInertia*e*t,n.wlambda+=n.invInertia*a*t}},{"./Equation":2,"../gl-matrix-extensions":13,"gl-matrix":12}],8:[function(t,r,n){function e(t){o.call(this),t=t||{},this.iterations=t.iterations||10,this.h=t.timeStep||1/60,this.k=t.stiffness||1e7,this.d=t.relaxation||6,this.a=0,this.b=0,this.eps=0,this.tolerance=t.tolerance||0,this.setSpookParams(this.k,this.d),this.debug=t.debug||!1,this.arrayStep=30,this.lambda=new s(this.arrayStep),this.Bs=new s(this.arrayStep),this.invCs=new s(this.arrayStep)}var a=t("gl-matrix"),i=a.vec2,o=t("./Solver").Solver;n.GSSolver=e;var s=Float32Array||Array;e.prototype=new o,e.prototype.setSpookParams=function(t,r){var n=this.h;this.k=t,this.d=r,this.a=4/(n*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(n*n*t*(1+4*r))},e.prototype.solve=function(t,r){var n=(this.d,this.k,0),e=this.iterations,a=this.tolerance*this.tolerance,o=this.a,c=this.b,u=this.eps,l=this.equations,h=l.length,f=r.bodies,v=r.bodies.length,p=t;h>this.lambda.length&&(this.lambda=new s(h+this.arrayStep),this.Bs=new s(h+this.arrayStep),this.invCs=new s(h+this.arrayStep));for(var d=this.invCs,m=this.Bs,y=this.lambda,g=0;g!==h;g++){var b=l[g];y[g]=0,m[g]=b.computeB(o,c,p),d[g]=1/b.computeC(u)}var M,b,x,w,q,C,S;if(0!==h){var g,B,j,P,F;for(g=0;g!==v;g++){var c=f[g],A=c.vlambda;i.set(A,0,0),c.wlambda=0}for(n=0;n!==e;n++){for(q=0,B=0;B!==h;B++)b=l[B],P=b.maxForce,j=b.minForce,M=m[B],x=d[B],S=y[B],C=b.computeGWlambda(u),w=x*(M-C-u*S),F=S+w,j>F?w=j-S:F>P&&(w=P-S),y[B]+=w,q+=Math.abs(w),b.addToWlambda(w);if(a>=q*q)break}for(g=0;g!==v;g++){var c=f[g],E=c.velocity;i.add(E,E,c.vlambda),c.angularVelocity+=c.wlambda}}return errorTot=q,n}},{"./Solver":3,"gl-matrix":12}],10:[function(t,r,n){var e=t("../objects/Shape").Circle,a=t("../objects/Shape").Plane,i=t("../objects/Shape").Particle,o=t("../collision/Broadphase"),s=o.Broadphase,c=t("gl-matrix");c.vec2,n.GridBroadphase=function(t,r,n,c,u,l){s.apply(this),u=u||10,l=l||10;var h=(r-t)/u,f=(c-n)/l;this.getCollisionPairs=function(s){for(var v=[],p=s.collidingBodies,d=d=p.length,m=[],y=u*l,g=0;y>g;g++)m.push([]);for(var b=u/(r-t),M=l/(c-n),g=0;g!==d;g++){var x=p[g],w=x.shape;if(void 0!==w)if(w instanceof e)for(var q=x.position[0],C=x.position[1],S=w.radius,B=Math.floor(b*(q-S-t)),j=Math.floor(M*(C-S-n)),P=Math.floor(b*(q+S-t)),F=Math.floor(M*(C+S-n)),A=B;P>=A;A++)for(var E=j;F>=E;E++){var k=A,V=E;k*(l-1)+V>=0&&y>k*(l-1)+V&&m[k*(l-1)+V].push(x)}else{if(!(w instanceof a))throw Error("Shape not supported in GridBroadphase!");if(0==x.angle)for(var C=x.position[1],A=0;A!==y&&C>n+f*(A-1);A++)for(var E=0;u>E;E++){var k=E,V=Math.floor(M*(f*A-n));m[k*(l-1)+V].push(x)}else if(x.angle==.5*Math.PI)for(var q=x.position[0],A=0;A!==y&&q>t+h*(A-1);A++)for(var E=0;l>E;E++){var V=E,k=Math.floor(b*(h*A-t));m[k*(l-1)+V].push(x)}else for(var A=0;A!==y;A++)m[A].push(x)}}for(var g=0;g!==y;g++)for(var G=m[g],A=0,L=G.length;A!==L;A++)for(var x=G[A],w=x.shape,E=0;E!==A;E++){var N=G[E],W=N.shape;w instanceof e?W instanceof e?o.checkCircleCircle(x,N,v):W instanceof i?o.checkCircleParticle(x,N,v):W instanceof a&&o.checkCirclePlane(x,N,v):w instanceof i?W instanceof e&&o.checkCircleParticle(N,x,v):w instanceof a&&W instanceof e&&o.checkCirclePlane(N,x,v)}return v}},n.GridBroadphase.prototype=new s},{"../objects/Shape":1,"../collision/Broadphase":6,"gl-matrix":12}],11:[function(t,r,n){function e(){return performance.now?performance.now():performance.webkitNow?performance.webkitNow():((new Date).getTime(),void 0)}function a(t){t=t||{},this.springs=[],this.bodies=[],this.solver=t.solver||new i,this.contacts=[],this.oldContacts=[],this.collidingBodies=[],this.gravity=t.gravity||c.fromValues(0,-9.78),this.doProfiling=t.doProfiling||!1,this.lastStepTime=0,this.broadphase=t.broadphase||new o}var i=t("../solver/GSSolver").GSSolver,o=t("../collision/NaiveBroadphase").NaiveBroadphase,s=t("gl-matrix"),c=s.vec2,u=t("../objects/Shape").Circle,l=t("../objects/Shape").Plane,h=t("../objects/Shape").Particle,f=t("../collision/Broadphase");f.Broadphase,n.World=a;var v=c.create(),p=c.create(),d=c.create(),m=c.create(),y=c.create(),g=c.create();a.prototype.step=function(t){var r,n,a=this.doProfiling,i=this.springs.length,o=this.springs,s=this.bodies,b=(this.collidingBodies,this.gravity),M=this.solver,x=this.bodies.length,w=this.broadphase;a&&(r=e(),vecCount=0,matCount=0);for(var q=0;q!==x;q++){var C=s[q].force;c.add(C,C,b)}for(var q=0;q!==i;q++){var S=o[q],B=S.stiffness,j=S.damping,P=S.restLength,F=S.bodyA,A=S.bodyB,E=v,k=p,V=d,G=m;c.sub(E,F.position,A.position),c.sub(V,F.velocity,A.velocity);var L=c.len(E);c.normalize(k,E),c.scale(G,k,B*(L-P)+j*c.dot(V,k)),c.sub(F.force,F.force,G),c.add(A.force,A.force,G)
}for(var N=w.getCollisionPairs(this),W=this.contacts.concat(this.oldContacts),I=this.contacts=[],q=0,z=N.length;q!==z;q+=2){var D=N[q],T=N[q+1],O=D.shape,X=T.shape;O instanceof u?X instanceof u?f.nearphaseCircleCircle(D,T,I,W):X instanceof h?f.nearphaseCircleParticle(D,T,I,W):X instanceof l&&f.nearphaseCirclePlane(D,T,I,W):O instanceof h?X instanceof u&&f.nearphaseCircleParticle(T,D,I,W):O instanceof l&&X instanceof u&&f.nearphaseCirclePlane(T,D,I,W)}this.oldContacts=W;for(var q=0,Y=I.length;q!==Y;q++)M.addEquation(I[q]);M.solve(t,this),M.removeAllEquations();for(var Q=y,Z=g,q=0;q!==x;q++){var R=s[q];if(R.mass>0){var H=1/R.mass,G=R.force,J=R.position,K=R.velocity;R.angularVelocity+=R.angularForce*R.invInertia*t,R.angle+=R.angularVelocity*t,c.scale(Q,G,t*H),c.add(K,Q,K),c.scale(Z,K,t),c.add(J,J,Z)}}for(var q=0;q!==x;q++){var D=s[q];c.set(D.force,0,0),D.angularForce=0}a&&(n=e(),this.lastStepTime=n-r,this.vecCreations=vecCount,this.matCreations=matCount)},a.prototype.addSpring=function(t){this.springs.push(t)},a.prototype.removeSpring=function(t){var r=this.springs.indexOf(t);-1===r&&this.springs.splice(r,1)},a.prototype.addBody=function(t){this.bodies.push(t),this.collidingBodies.push(t)},a.prototype.removeBody=function(t){var r=this.bodies.indexOf(t);-1===r&&this.bodies.splice(r,1)}},{"../solver/GSSolver":8,"../collision/NaiveBroadphase":9,"../objects/Shape":1,"../collision/Broadphase":6,"gl-matrix":12}]},{},[4])(4)});