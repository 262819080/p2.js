/**
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013 p2.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
(function(t){if("function"==typeof bootstrap)bootstrap("p2",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeP2=t}else"undefined"!=typeof window?window.p2=t():self.p2=t()})(function(){return function(t,e,i){function n(i,r){if(!e[i]){if(!t[i]){var a="function"==typeof require&&require;if(!r&&a)return a(i,!0);if(o)return o(i,!0);throw Error("Cannot find module '"+i+"'")}var s=e[i]={exports:{}};t[i][0].call(s.exports,function(e){var o=t[i][1][e];return n(o?o:e)},s,s.exports)}return e[i].exports}for(var o="function"==typeof require&&require,r=0;i.length>r;r++)n(i[r]);return n}({1:[function(t,e,i){i.Body=t("./objects/Body").Body,i.Broadphase=t("./collision/Broadphase").Broadphase,i.Circle=t("./objects/Shape").Circle,i.Constraint=t("./constraints/Constraint").Constraint,i.ContactEquation=t("./constraints/ContactEquation").ContactEquation,i.DistanceConstraint=t("./constraints/DistanceConstraint").DistanceConstraint,i.Equation=t("./constraints/Equation").Equation,i.EventEmitter=t("./events/EventEmitter").EventEmitter,i.GridBroadphase=t("./collision/GridBroadphase").GridBroadphase,i.GSSolver=t("./solver/GSSolver").GSSolver,i.NaiveBroadphase=t("./collision/NaiveBroadphase").NaiveBroadphase,i.Plane=t("./objects/Shape").Plane,i.IslandSolver=t("./solver/IslandSolver").IslandSolver,i.Island=t("./solver/IslandSolver").Island,i.Shape=t("./objects/Shape").Shape,i.Solver=t("./solver/Solver").Solver,i.Spring=t("./objects/Body").Spring,i.World=t("./world/World").World,i.vec2=t("./math/vec2"),i.mat2=t("./math/mat2")},{"./objects/Body":2,"./objects/Shape":3,"./collision/Broadphase":4,"./constraints/Constraint":5,"./constraints/ContactEquation":6,"./constraints/DistanceConstraint":7,"./constraints/Equation":8,"./events/EventEmitter":9,"./collision/GridBroadphase":10,"./solver/GSSolver":11,"./collision/NaiveBroadphase":12,"./solver/IslandSolver":13,"./solver/Solver":14,"./world/World":15,"./math/vec2":16,"./math/mat2":17}],3:[function(t,e,i){function n(){}function o(t){n.apply(this),this.vertices=t}i.Shape=n,i.Particle=function(){n.apply(this)},i.Circle=function(t){n.apply(this),this.radius=t||1},i.Plane=function(){n.apply(this)},i.Convex=o},{}],5:[function(t,e,i){function n(t,e){this.equations=[],this.bodyA=t,this.bodyB=e}i.Constraint=n,n.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!")}},{}],8:[function(t,e,i){function n(t,e,i,n){this.id=-1,this.minForce=i===void 0?-1e6:i,this.maxForce=n===void 0?1e6:n,this.bi=t,this.bj=e}i.Equation=n,n.prototype.constructor=n},{}],9:[function(t,e,i){var n=function(){};i.EventEmitter=n,n.prototype={constructor:n,on:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)?!0:!1},off:function(t,e){if(void 0!==this._listeners){var i=this._listeners,n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}},emit:function(t){if(void 0!==this._listeners){var e=this._listeners,i=e[t.type];if(void 0!==i){t.target=this;for(var n=0,o=i.length;o>n;n++)i[n].call(this,t)}return this}}}},{}],14:[function(t,e,i){function n(){this.equations=[]}i.Solver=n,n.prototype.solve=function(){throw Error("Solver.solve should be implemented by subclasses!")},n.prototype.addEquation=function(t){this.equations.push(t)},n.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!=e&&this.equations.splice(e,1)},n.prototype.removeAllEquations=function(){this.equations=[]}},{}],2:[function(t,e,i){function n(t,e,i){i=i||{},this.restLength=i.restLength||1,this.stiffness=i.stiffness||100,this.damping=i.damping||1,this.bodyA=t,this.bodyB=e}function o(t){t=t||{},this.id=++o._idCounter,this.shape=t.shape,this.mass=t.mass||0,this.invMass=this.mass>0?1/this.mass:0,this.inertia=t.inertia||this.mass,this.invInertia=this.invMass,this.position=r.create(),t.position&&r.copy(this.position,t.position),this.velocity=r.create(),t.velocity&&r.copy(this.velocity,t.velocity),this.vlambda=r.create(),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=r.create(),t.force&&r.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.motionState=0==this.mass?o.STATIC:o.DYNAMIC}var r=t("../math/vec2");i.Body=o,i.Spring=n,o._idCounter=0;var a=r.create();o.prototype.applyForce=function(t,e){var i=a;r.sub(i,e,this.position),r.add(this.force,this.force,t);var n=r.crossLength(i,t);this.angularForce+=n},o.DYNAMIC=1,o.STATIC=2,o.KINEMATIC=4},{"../math/vec2":16}],6:[function(t,e,i){function n(t,e){o.call(this,t,e,0,1e6),this.penetration=0,this.ri=r.create(),this.penetrationVec=r.create(),this.rj=r.create(),this.ni=r.create(),this.rixn=r.create(),this.rjxn=r.create(),this.rixw=r.create(),this.rjxw=r.create(),this.relVel=r.create(),this.relForce=r.create()}var o=t("./Equation").Equation,r=t("../math/vec2");i.ContactEquation=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.computeB=function(t,e,i){var n=this.bi,o=this.bj,a=this.ri,s=this.rj,c=n.position,h=o.position,l=n.velocity,u=n.angularVelocity,p=n.force,v=n.angularForce,d=o.velocity,f=o.angularVelocity,m=o.force,y=o.angularForce,b=(this.relVel,this.relForce,this.penetrationVec),g=n.invMass,C=o.invMass,S=n.invInertia,q=o.invInertia,B=this.ni,E=this.rixn=r.crossLength(a,B),w=this.rjxn=r.crossLength(s,B);r.set(b,0,0),r.add(b,h,s),r.sub(b,b,c),r.sub(b,b,a);var x=r.dot(B,b),j=r.dot(d,B)-r.dot(l,B)+f*w-u*E,P=r.dot(m,B)*C-r.dot(p,B)*g+q*y*w-S*v*E,M=-x*t-j*e-i*P;return M},n.prototype.computeC=function(t){var e=this.bi,i=this.bj,n=this.rixn,o=this.rjxn,r=e.invMass,a=i.invMass,s=r+a+t,c=e.invInertia,h=i.invInertia;return s+=c*n*n,s+=h*o*o};var a=r.create();n.prototype.computeGWlambda=function(){var t=this.bi,e=this.bj,i=a,n=0;return r.sub(i,e.vlambda,t.vlambda),n+=r.dot(i,this.ni),n-=t.wlambda*this.rixn,n+=e.wlambda*this.rjxn};var s=r.create();n.prototype.addToWlambda=function(t){var e=this.bi,i=this.bj,n=this.rixn,o=this.rjxn,a=e.invMass,c=i.invMass,h=this.ni,l=s;r.scale(l,h,a*t),r.sub(e.vlambda,e.vlambda,l),r.scale(l,h,c*t),r.add(i.vlambda,i.vlambda,l),e.wlambda-=e.invInertia*n*t,i.wlambda+=i.invInertia*o*t}},{"./Equation":8,"../math/vec2":16}],7:[function(t,e,i){function n(t,e,i,n){o.call(this,t,e),n===void 0&&(n=1e6);var s=this.equations=[new r(t,e)],c=s[0];c.minForce=-n,c.maxForce=n,this.update=function(){a.subtract(c.ni,e.position,t.position),a.normalize(c.ni,c.ni),a.scale(c.ri,c.ni,.5*i),a.scale(c.rj,c.ni,.5*-i)}}var o=t("./Constraint").Constraint,r=t("./ContactEquation").ContactEquation,a=t("../math/vec2");i.DistanceConstraint=n,n.prototype=Object(o.prototype)},{"./Constraint":5,"./ContactEquation":6,"../math/vec2":16}],4:[function(t,e,i){function n(t,e,i){var n,o,r=null,s=null;a.rotate(v,e,t.angle);for(var c=a.dot(t.position,e),h=1;t.shape.vertices.length>h;h++)n=t.shape.vertices[h],o=a.dot(n,v),(null===r||o>r)&&(r=o),(null===s||s>o)&&(s=o);a.set(i,s+c,r+c)}function o(t,e,i){for(var o=null,r=!1,s=0;2>s;s++)for(var c=0==s?t:e,h=1;t.shape.vertices.length>h;h++){a.subtract(d,c.shape.vertices[h],c.shape.vertices[h-1]),a.rotate(f,d,-Math.PI/2),a.normalize(f,f),n(t,f,m),n(e,f,y);var l=m,u=y;m[0]>y[0]&&(u=m,l=y);var p=u[1]-l[0];(null===o||p>o)&&(a.copy(i,f),o=p,r=p>0)}return r}function r(t,e){a.rotate(v,e,t.angle);for(var i=-1,n=1;t.shape.vertices.length>n;n++){a.subtract(d,t.shape.vertices[n],t.shape.vertices[n-1]),a.rotate(f,d,-Math.PI/2),a.normalize(f,f);var o=a.dot(f,e);(-1==i||o>maxDot)&&(i=n-1,maxDot=o)}return i}var a=t("../math/vec2"),s=t("../math/mat2"),c=a.create();s.create();var h=a.create(),l=a.fromValues(0,1);i.checkCircleCircle=function(t,e,i){a.sub(c,t.position,e.position);var n=t.shape.radius,o=e.shape.radius;(n+o)*(n+o)>a.sqrLen(c)&&(i.push(t),i.push(e))},i.checkCirclePlane=function(t,e,i){a.sub(c,t.position,e.position),a.rotate(h,l,e.angle),a.dot(c,h)<=t.shape.radius&&(i.push(t),i.push(e))},i.checkCircleParticle=function(t,e,i){i.push(t),i.push(e)},i.nearphaseCircleCircle=function(t,e,i,n){var o=n.length?n.pop():new p2.ContactEquation(t,e);o.bi=t,o.bj=e,a.sub(o.ni,e.position,t.position),a.normalize(o.ni,o.ni),a.scale(o.ri,o.ni,t.shape.radius),a.scale(o.rj,o.ni,-e.shape.radius),i.push(o)},i.nearphaseCircleParticle=function(){};var u=(s.create(),a.create()),p=a.create();i.nearphaseCirclePlane=function(t,e,i,n){var o=n.length?n.pop():new p2.ContactEquation(e,t);o.bi=e,o.bj=t;var r=u,s=p;a.rotate(o.ni,l,e.angle),a.scale(o.rj,o.ni,-t.shape.radius),a.sub(r,t.position,e.position);var c=a.dot(o.ni,r);a.scale(s,o.ni,c),a.sub(o.ri,r,s),i.push(o)};var v=a.create();i.projectConvexOntoAxis=n;var d=a.create(),f=a.create(),m=a.create(),y=a.create();i.findSeparatingAxis=o,i.nearphaseConvexConvex=function(t,e,i){var n=r(t,i),o=r(e,i);return-1==n||-1==o?!1:(a.create(),a.create(),a.create(),a.create(),a.create(),a.create(),void 0)},i.Broadphase=function(){},i.Broadphase.prototype.getCollisionPairs=function(){throw Error("getCollisionPairs must be implemented in a subclass!")}},{"../math/vec2":16,"../math/mat2":17}],11:[function(t,e,i){function n(t){r.call(this),t=t||{},this.iterations=t.iterations||10,this.h=t.timeStep||1/60,this.k=t.stiffness||1e7,this.d=t.relaxation||6,this.a=0,this.b=0,this.eps=0,this.tolerance=t.tolerance||0,this.setSpookParams(this.k,this.d),this.debug=t.debug||!1,this.arrayStep=30,this.lambda=new a(this.arrayStep),this.Bs=new a(this.arrayStep),this.invCs=new a(this.arrayStep)}var o=t("../math/vec2"),r=t("./Solver").Solver;i.GSSolver=n;var a=Float32Array||Array;n.prototype=new r,n.prototype.setSpookParams=function(t,e){var i=this.h;this.k=t,this.d=e,this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.eps=4/(i*i*t*(1+4*e))},n.prototype.solve=function(t,e){var i=(this.d,this.k,0),n=this.iterations,r=this.tolerance*this.tolerance,s=this.a,c=this.b,h=this.eps,l=this.equations,u=l.length,p=e.bodies,v=e.bodies.length,d=t;u>this.lambda.length&&(this.lambda=new a(u+this.arrayStep),this.Bs=new a(u+this.arrayStep),this.invCs=new a(u+this.arrayStep));for(var f=this.invCs,m=this.Bs,y=this.lambda,b=0;b!==u;b++){var g=l[b];y[b]=0,m[b]=g.computeB(s,c,d),f[b]=1/g.computeC(h)}var C,g,S,q,B,E,w;if(0!==u){var b,x,j,P,M;for(b=0;b!==v;b++){var c=p[b],I=c.vlambda;o.set(I,0,0),c.wlambda=0}for(i=0;i!==n;i++){for(B=0,x=0;x!==u;x++)g=l[x],P=g.maxForce,j=g.minForce,C=m[x],S=f[x],w=y[x],E=g.computeGWlambda(h),q=S*(C-E-h*w),M=w+q,j>M?q=j-w:M>P&&(q=P-w),y[x]+=q,B+=Math.abs(q),g.addToWlambda(q);if(r>=B*B)break}for(b=0;b!==v;b++){var c=p[b],k=c.velocity;o.add(k,k,c.vlambda),c.angularVelocity+=c.wlambda}}errorTot=B}},{"../math/vec2":16,"./Solver":14}],10:[function(t,e,i){var n=t("../objects/Shape").Circle,o=t("../objects/Shape").Plane,r=t("../objects/Shape").Particle,a=t("../collision/Broadphase"),s=a.Broadphase;t("../math/vec2"),i.GridBroadphase=function(t,e,i,c,h,l){s.apply(this),h=h||10,l=l||10;var u=(e-t)/h,p=(c-i)/l;this.getCollisionPairs=function(s){for(var v=[],d=s.collidingBodies,f=f=d.length,m=[],y=h*l,b=0;y>b;b++)m.push([]);for(var g=h/(e-t),C=l/(c-i),b=0;b!==f;b++){var S=d[b],q=S.shape;if(void 0!==q)if(q instanceof n)for(var B=S.position[0],E=S.position[1],w=q.radius,x=Math.floor(g*(B-w-t)),j=Math.floor(C*(E-w-i)),P=Math.floor(g*(B+w-t)),M=Math.floor(C*(E+w-i)),I=x;P>=I;I++)for(var k=j;M>=k;k++){var F=I,_=k;F*(l-1)+_>=0&&y>F*(l-1)+_&&m[F*(l-1)+_].push(S)}else{if(!(q instanceof o))throw Error("Shape not supported in GridBroadphase!");if(0==S.angle)for(var E=S.position[1],I=0;I!==y&&E>i+p*(I-1);I++)for(var k=0;h>k;k++){var F=k,_=Math.floor(C*(p*I-i));m[F*(l-1)+_].push(S)}else if(S.angle==.5*Math.PI)for(var B=S.position[0],I=0;I!==y&&B>t+u*(I-1);I++)for(var k=0;l>k;k++){var _=k,F=Math.floor(g*(u*I-t));m[F*(l-1)+_].push(S)}else for(var I=0;I!==y;I++)m[I].push(S)}}for(var b=0;b!==y;b++)for(var A=m[b],I=0,G=A.length;I!==G;I++)for(var S=A[I],q=S.shape,k=0;k!==I;k++){var O=A[k],V=O.shape;q instanceof n?V instanceof n?a.checkCircleCircle(S,O,v):V instanceof r?a.checkCircleParticle(S,O,v):V instanceof o&&a.checkCirclePlane(S,O,v):q instanceof r?V instanceof n&&a.checkCircleParticle(O,S,v):q instanceof o&&V instanceof n&&a.checkCirclePlane(O,S,v)}return v}},i.GridBroadphase.prototype=new s},{"../objects/Shape":3,"../math/vec2":16,"../collision/Broadphase":4}],12:[function(t,e,i){var n=t("../objects/Shape").Circle,o=t("../objects/Shape").Plane,r=t("../objects/Shape").Particle,a=t("../collision/Broadphase"),s=a.Broadphase;t("../math/vec2"),i.NaiveBroadphase=function(){s.apply(this),this.getCollisionPairs=function(t){for(var e=t.collidingBodies,i=[],s=0,c=e.length;s!==c;s++){var h=e[s],l=h.shape;if(void 0!==l)for(var u=0;u!==s;u++){var p=e[u],v=p.shape;void 0!==v&&(l instanceof n?v instanceof n?a.checkCircleCircle(h,p,i):v instanceof r?a.checkCircleParticle(h,p,i):v instanceof o&&a.checkCirclePlane(h,p,i):l instanceof r?v instanceof n&&a.checkCircleParticle(p,h,i):l instanceof o&&v instanceof n&&a.checkCirclePlane(p,h,i))}}return i}},i.NaiveBroadphase.prototype=new s},{"../objects/Shape":3,"../collision/Broadphase":4,"../math/vec2":16}],13:[function(t,e,i){function n(t){s.call(this),this.subsolver=t,this.numIslands=0,this._nodePool=[]}function o(t){for(var e=t.length,i=0;i!==e;i++){var n=t[i];if(!(n.visited||n.body.motionState&h))return n}return!1}function r(t,e){var i=[];for(i.push(t),t.visited=!0,e(t);i.length;)for(var n,r=i.pop();n=o(r.children);)n.visited=!0,e(n),i.push(n)}function a(){this.equations=[],this.bodies=[]}var s=t("./Solver").Solver,c=(t("../constraints/ContactEquation").ContactEquation,t("../math/vec2"),t("../objects/Body").Body),h=c.STATIC;i.IslandSolver=n,i.Island=a,n.prototype=Object(s.prototype),n.prototype.solve=function(t,e){function i(t){S.push(t.body);for(var e=t.eqs.length,i=0;i!==e;i++){var n=t.eqs[i];-1===C.indexOf(n)&&C.push(n)}}var n=[],s=e.bodies,c=this.equations,h=c.length,l=s.length;this.subsolver,this._workers,this._workerData,this._workerIslandGroups;for(var u=0;u!==l;u++)this._nodePool.length?n.push(this._nodePool.pop()):n.push({body:s[u],children:[],eqs:[],visited:!1});for(var u=0;u!==l;u++){var p=n[u];p.body=s[u],p.children.length=0,p.eqs.length=0,p.visited=!1}for(var v=0;v!==h;v++){var d=c[v],u=s.indexOf(d.bi),f=s.indexOf(d.bj),m=n[u],y=n[f];m.children.push(y),m.eqs.push(d),y.children.push(m),y.eqs.push(d)}for(var b,g=0,C=[],S=[],q=[];b=o(n);){var B=new a;C.length=0,S.length=0,r(b,i);for(var E=C.length,u=0;u!==E;u++){var d=C[u];B.equations.push(d)}g++,q.push(B)}this.numIslands=g;for(var u=0;q.length>u;u++)q[u].solve(t,this.subsolver)},a.prototype.reset=function(){this.equations.length=this.bodies.length=0},a.prototype.getBodies=function(){for(var t=[],e=[],i=this.equations,n=0;n!==i.length;n++){var o=i[n];-1===e.indexOf(o.bi.id)&&(t.push(o.bi),e.push(o.bi.id)),-1===e.indexOf(o.bj.id)&&(t.push(o.bj),e.push(o.bj.id))}return t},a.prototype.solve=function(t,e){var i=[];e.removeAllEquations();for(var n=this.equations.length,o=0;o!==n;o++)e.addEquation(this.equations[o]);for(var r=this.getBodies(),a=r.length,o=0;o!==a;o++)i.push(r[o]);e.solve(t,{bodies:i})}},{"./Solver":14,"../constraints/ContactEquation":6,"../math/vec2":16,"../objects/Body":2}],15:[function(t,e,i){function n(){return performance.now?performance.now():performance.webkitNow?performance.webkitNow():(new Date).getTime()}function o(t){u.apply(this),t=t||{},this.springs=[],this.bodies=[],this.solver=t.solver||new r,this.contacts=[],this.oldContacts=[],this.collidingBodies=[],this.gravity=t.gravity||s.fromValues(0,-9.78),this.doProfiling=t.doProfiling||!1,this.lastStepTime=0,this.broadphase=t.broadphase||new a,this.constraints=[],this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.addSpringEvent={type:"addSpring",body:null}}var r=t("../solver/GSSolver").GSSolver,a=t("../collision/NaiveBroadphase").NaiveBroadphase,s=t("../math/vec2"),c=t("../objects/Shape").Circle,h=t("../objects/Shape").Plane,l=t("../objects/Shape").Particle,u=t("../events/EventEmitter").EventEmitter,p=t("../objects/Body").Body,v=t("../collision/Broadphase");v.Broadphase,i.World=o,o.prototype=Object(u.prototype),o.prototype.addConstraint=function(t){this.constraints.push(t),t.id=this._constraintIdCounter++},o.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)};var d=s.create(),f=s.create(),m=s.create(),y=s.create(),b=s.create(),g=s.create();o.prototype.step=function(t){var e,i,o=this,r=this.doProfiling,a=this.springs.length,u=this.springs,p=this.bodies,C=(this.collidingBodies,this.gravity),S=this.solver,q=this.bodies.length,B=this.broadphase,E=this.constraints;r&&(e=n());for(var w=0;w!==q;w++){var x=p[w].force;s.add(x,x,C)}for(var w=0;w!==a;w++){var j=u[w],P=j.stiffness,M=j.damping,I=j.restLength,k=j.bodyA,F=j.bodyB,_=d,A=f,G=m,O=y;s.sub(_,k.position,F.position),s.sub(G,k.velocity,F.velocity);var V=s.len(_);s.normalize(A,_),s.scale(O,A,P*(V-I)+M*s.dot(G,A)),s.sub(k.force,k.force,O),s.add(F.force,F.force,O)}for(var N=B.getCollisionPairs(this),D=this.contacts.concat(this.oldContacts),T=this.contacts=[],w=0,L=N.length;w!==L;w+=2){var W=N[w],z=N[w+1],Y=W.shape,J=z.shape;Y instanceof c?J instanceof c?v.nearphaseCircleCircle(W,z,T,D):J instanceof l?v.nearphaseCircleParticle(W,z,T,D):J instanceof h&&v.nearphaseCirclePlane(W,z,T,D):Y instanceof l?J instanceof c&&v.nearphaseCircleParticle(z,W,T,D):Y instanceof h&&J instanceof c&&v.nearphaseCirclePlane(z,W,T,D)}this.oldContacts=D;for(var w=0,K=T.length;w!==K;w++)S.addEquation(T[w]);var X=E.length;for(w=0;w!==X;w++){var H=E[w];H.update();for(var Q=0,R=H.equations.length;Q!==R;Q++){var U=H.equations[Q];S.addEquation(U)}}S.solve(t,this),S.removeAllEquations();for(var Z=b,$=g,w=0;w!==q;w++){var te=p[w];if(te.mass>0){var ee=1/te.mass,O=te.force,ie=te.position,ne=te.velocity;te.angularVelocity+=te.angularForce*te.invInertia*t,te.angle+=te.angularVelocity*t,s.scale(Z,O,t*ee),s.add(ne,Z,ne),s.scale($,ne,t),s.add(ie,ie,$)}}for(var w=0;w!==q;w++){var W=p[w];s.set(W.force,0,0),W.angularForce=0}r&&(i=n(),o.lastStepTime=i-e),this.emit(this.postStepEvent)},o.prototype.addSpring=function(t){this.springs.push(t),this.addSpringEvent.spring=t,this.emit(this.addSpringEvent)},o.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1===e&&this.springs.splice(e,1)},o.prototype.addBody=function(t){this.bodies.push(t),this.collidingBodies.push(t),this.addBodyEvent.body=t,this.emit(this.addBodyEvent)},o.prototype.removeBody=function(t){var e=this.bodies.indexOf(t);-1===e&&this.bodies.splice(e,1)},o.prototype.toJSON=function(){function t(t){return[t[0],t[1]]}for(var e={p2:"0.1.0",bodies:[],springs:[],solver:{},gravity:t(this.gravity),broadphase:{},constraints:[]},i=0;this.bodies.length>i;i++){var n=this.bodies[i];e.bodies.push({mass:n.mass,angle:n.angle,position:t(n.position),velocity:t(n.velocity),angularVelocity:n.angularVelocity,force:t(n.force)})}return e},o.prototype.fromJSON=function(t){if(this.clear(),!t.p2)return!1;switch(t.p2){case"0.1.0":for(var e=0;t.bodies.length>e;e++){var i=t.bodies[e],n=new p({mass:i.mass,position:i.position,angle:i.angle,velocity:i.velocity,angularVelocity:i.angularVelocity,force:i.force});this.addBody(n)}break;default:return!1}return!0},o.prototype.clear=function(){for(var t=this.constraints,e=0;t.length>e;e++)this.removeConstraint(t[e]);for(var i=this.bodies,e=0;i.length>e;e++)this.removeBody(i[e]);for(var n=this.springs,e=0;n.length>e;e++)this.removeSpring(n[e])}},{"../solver/GSSolver":11,"../collision/NaiveBroadphase":12,"../math/vec2":16,"../objects/Shape":3,"../events/EventEmitter":9,"../objects/Body":2,"../collision/Broadphase":4}],16:[function(t,e){var i=t("../../node_modules/gl-matrix/src/gl-matrix/vec2").vec2;i.getX=function(t){return t[0]},i.getY=function(t){return t[1]},i.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},i.rotate=function(t,e,i){var n=Math.cos(i),o=Math.sin(i);t[0]=n*e[0]-o*e[1],t[1]=o*e[0]+n*e[1]},e.exports=i},{"../../node_modules/gl-matrix/src/gl-matrix/vec2":18}],17:[function(t,e){var i=t("../../node_modules/gl-matrix/src/gl-matrix/mat2").mat2;e.exports=i},{"../../node_modules/gl-matrix/src/gl-matrix/mat2":19}],18:[function(t,e,i){var n={};if(!o)var o=1e-6;n.create=function(){return new Float32Array(2)},n.clone=function(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e},n.fromValues=function(t,e){var i=new Float32Array(2);return i[0]=t,i[1]=e,i},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},n.set=function(t,e,i){return t[0]=e,t[1]=i,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},n.div=n.divide,n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},n.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},n.normalize=function(t,e){var i=e[0],n=e[1],o=i*i+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},n.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},n.lerp=function(t,e,i,n){var o=e[0],r=e[1];return t[0]=o+n*(i[0]-o),t[1]=r+n*(i[1]-r),t},n.transformMat2=function(t,e,i){var n=e[0],o=e[1];return t[0]=n*i[0]+o*i[1],t[1]=n*i[2]+o*i[3],t},n.forEach=function(){var t=new Float32Array(2);return function(e,i,n,o,r,a){var s,c;for(i||(i=2),n||(n=0),c=o?Math.min(o*i+n,e.length):e.length,s=n;c>s;s+=i)t[0]=e[s],t[1]=e[s+1],r(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},i!==void 0&&(i.vec2=n)},{}],19:[function(t,e,i){var n={},o=new Float32Array([1,0,0,1]);if(!r)var r=1e-6;n.create=function(){return new Float32Array(o)},n.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},n.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},n.invert=function(t,e){var i=e[0],n=e[1],o=e[2],r=e[3],a=i*r-o*n;return a?(a=1/a,t[0]=r*a,t[1]=-n*a,t[2]=-o*a,t[3]=i*a,t):null},n.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},n.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},n.multiply=function(t,e,i){var n=e[0],o=e[1],r=e[2],a=e[3],s=i[0],c=i[1],h=i[2],l=i[3];return t[0]=n*s+o*h,t[1]=n*c+o*l,t[2]=r*s+a*h,t[3]=r*c+a*l,t},n.mul=n.multiply,n.rotate=function(t,e,i){var n=e[0],o=e[1],r=e[2],a=e[3],s=Math.sin(i),c=Math.cos(i);return t[0]=n*c+o*s,t[1]=n*-s+o*c,t[2]=r*c+a*s,t[3]=r*-s+a*c,t},n.scale=function(t,e,i){var n=e[0],o=e[1],r=e[2],a=e[3],s=i[0],c=i[1];return t[0]=n*s,t[1]=o*c,t[2]=r*s,t[3]=a*c,t},n.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},i!==void 0&&(i.mat2=n)},{}]},{},[1])(1)});